!function(){"use strict";var v=function(e,i){var t,n,e=e||window.location.href;if(i){t=new RegExp("[?&]"+i+"=([^&#]*)","i");try{n=t.exec(e)[1]}catch(e){n=null}}else n=e.substring(e.indexOf("?")+1);return n};var a,c,b=(c="QD_PM",{receive:function(e,o){var i,t,n;t="message",n=function(e){var i,t,n=(i=e.data,t=Object.prototype.toString,!(!i||"[object String]"!==t.call(i)||/uc_msg|oppo_night|weibo|msfapi|axure/i.test(i))&&i);if(n){-1==n.indexOf(c)&&BJ_REPORT&&BJ_REPORT.report("PM NO Flag "+n);try{a=JSON.parse(n)}catch(e){throw new Error("PostMsg Parse Error "+n)}"function"==typeof o&&o(a)}},(i=e).addEventListener?i.addEventListener(t,n,!1):i.attachEvent("on"+t,n)},send:function(e,i){var t=a?$.extend(a,e):e,n=i||"CHAT";t.hasOwnProperty(c)&&t[c]==n||(t[c]=n),t="string"!=typeof t?JSON.stringify(t):t,window.parent.postMessage(t,"*")}}),m=document;function i(){var t={};return{type:"memory",getItem:function(e){return e in t&&t[e]},setItem:function(e,i){return t[e]=i,!0},removeItem:function(e){return e in t&&delete t[e]},clear:function(){return t={},!0}}}var u=function(e){var t=i();try{"localStorage"in e&&e.localStorage&&(e.localStorage.setItem("test","test"),e.localStorage.removeItem("test"),t=e.localStorage)}catch(e){BJ_REPORT&&BJ_REPORT.report(JSON.stringify(e))}return{type:t.type,get:function(e){return t.getItem(e)},set:function(e,i){try{return t.setItem(e,i),!0}catch(e){return!1}},remove:function(e){return t.removeItem(e)},clear:function(){return t.clear()}}}(window),e=window.parent!=window;window;function E(){this.create=function(e,i){return this.ioLink=io.connect(e,i),this},this.close=function(){this.ioLink.disconnect()},this.emitMsg=function(e,i,t,n){return this.ioLink&&this.ioLink.compress(!1).emit(e,i),t&&t.call(n),this},this.receiveMsg=function(e,i,t,n,o){t=t||this;return o?this.ioLink.once(e,function(e){n&&$.extend(e,n),i&&i.call(t,e)}):this.ioLink.on(e,function(e){n&&$.extend(e,n),i&&i.call(t,e)}),this}}var t,n,o,s,r,d,l,p,_,h,f,g,q,T,S,w,M,I={SOCKET_CHAT:"https://"+__domain.chat+".qidian.qq.com",STATUS_MANAGER:"https://webpage.qidian.qq.com/qidian/chatClient/release/status/js/report-f3afb2c93.js",QQ_FACE:"https://"+__domain.source+".com/qidian/chatClient/release/comp/img/qq/",GET_SIGT:"https://"+__domain.admin+".qidian.qq.com/webim/webImLogin/getSigT",GET_TENCENT_SCHEME:"https://"+__domain.admin+".qidian.qq.com/tp/wpaCall/getWebProtocol",UPLOAD_IMG:"https://"+__domain.admin+".qidian.qq.com/webim/pic/upload",ROUTE_CHANGE_LOADING:{QQ:"https://"+__domain.admin+".qidian.qq.com/template/blue/wpa/link.html"},GET_GRAPHIC_MSG:"https://"+__domain.admin+".qidian.qq.com/webim/innerPage/getGraphicMsg",GET_OFFLINE_MSG:"https://"+__domain.admin+".qidian.qq.com/webim/offlineMessage/getMessages",COMP_SOURCE_URL:"https://"+__domain.source+".com/qidian/chatClient/release/comp/",GET_MENU_URL:"https://"+__domain.admin+".qidian.qq.com/webim/innerPage/getNav",GET_FEEDBACK_RET:"https://"+__domain.admin+".qidian.qq.com/webim/innerPage/feedBack",ACT_RPT:"https://"+__domain.admin+".qidian.qq.com/ar/ActCap/ActRpt",GET_SERVER_TIME:"https://"+__domain.admin+".qidian.qq.com/webim/commonRequest/checkTime",GET_ADD_FRIEND_SCHEME:"https://"+__domain.admin+".qidian.qq.com/tp/wpaCall/GetAddFriendProtocol",COMMON_REQ_RPT:"https://"+__domain.admin+".qidian.qq.com/webim/commonRequest/actRpt",GET_RELATED_MESSAGE:"https://"+__domain.admin+".qidian.qq.com/webim/complete/question",ROBOT_SATISFACTION_REPORT:"https://"+__domain.admin+".qidian.qq.com/cl/robotSatisfaction/robotReport",GET_WX_MP_OPENID:"https://"+__domain.admin+".qidian.qq.com/webim/wx/getMpOpenId",CHECK_WX_VISITORID:"https://"+__domain.admin+".qidian.qq.com/webim/wx/checkVisitorId",CHECK_THIRD_VISITORID:"https://"+__domain.admin+".qidian.qq.com/webim/nonAnonymous/getVisitorId",GET_WX_MP_JSSDK_SIGNATURE:"https://"+__domain.admin+".qidian.qq.com/webim/wx/getSignature",GET_WX_MP_JSSDK_SOURCE:"https://res.wx.qq.com/open/js/jweixin-1.4.0.js",GET_SKIN_CORP_INFO:"https://"+__domain.admin+".qidian.qq.com/webim/innerPage/getPCIMInfo",GET_RECEPTION_DETAIL:"https://"+__domain.admin+".qidian.qq.com/webim/innerPage/getEmployeeInfo",GET_LEAVE_MSG_CONFIG:"https://"+__domain.admin+".qidian.qq.com/reception/leaveMessage/customerMessageConfig",SEND_LEAVE_MSG_FORM:"https://"+__domain.admin+".qidian.qq.com/reception/leaveMessage/customerMessageCreate",TEXT_TRANSLATE:"https://"+__domain.admin+".qidian.qq.com/ts/translate/textTranslate",TRANSLATE_LANG_CHANGE:"https://"+__domain.admin+".qidian.qq.com/webim/commonRequest/setTranslateLang",GET_ROAMING_LIST:"https://"+__domain.admin+".qidian.qq.com/webim/roam/getMessage",GET_MSG_INFO_DATA:"https://"+__domain.admin+".qidian.qq.com/webim/innerPage/getXmlMsgData",GET_BUSINESS_CARD_DATA:"https://"+__domain.admin+".qidian.qq.com/webim/innerPage/fetchBusinessCard"},A=((new Date).getTime(),{win:window,receptionist:{},wpaDetail:{},getSignTData:{},kfChangeTip:0,isGetSignT:0,isRegOK:0,isMobile:0,isChangeKF:0,inRegProcess:0,isRealSendMsg:1,isInIframe:e,defaultAvatar:I.COMP_SOURCE_URL+"img/default-avatar.png",imageLoadFail:I.COMP_SOURCE_URL+"img/image-load-fail.png",reSendC2bMsg:null,ioLinkStatus:null,regSuccessCallBack:null,imStatus:"open",pageStatus:"show",clickName:"click",chatSocket:new E,c2bDBsaveData:[],c2bSeqGroup:[],authConfig:{auth:0},menuDetail:{active:0,currentVersion:"",eLogo:"",eName:"",defaultConfig:{active:0}},seqs:{key:"",data:[]},getSigTData:{},originRoleValue:null,clientPingTimer:null,serverClientTimeDiff:0,htReportOpts:{flag1:21873,flag2:1},registerType:"default",routePermit:{isCorpUin:0,isNeedQQ:1},lang:"zh-cn",translate:{translateSwitch:!1,translateLang:"zh",translateAuto:!0},wxConfig:{enableVoice:!1,appid:"",openid:""},externalType:1,isShowQidianSign:1,isShowBusinessCard:1,thirdAppConfig:{enable:!1,type:"",appType:0,appId:"",openId:"",userInfo:null}}),R=A.win.navigator.userAgent.toLocaleLowerCase();function C(e){var i,t="tencentSig",n=void 0===u.type||"memory"===u.type;A.thirdAppConfig.secretKey&&(t="tencentThirdSig");var o,a,c,s,r,d={active:!1,url:""};return $.extend(d,e),s=(c=d.active)?v(d.url,"visitorId"):(o=t,null!=(a=m.cookie.match(new RegExp("(^| )"+o+"=([^;]*)(;|$)")))?unescape(a[2]):null),!c&&n&&(s?u.set(t,s):s=u.get(t)),(i=s)||(r=(Math.floor(10*Math.random())||1)+function(e,i){var t,n,o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),a=[];if(i=i||o.length,e)for(t=0;t<e;t++)a[t]=o[0|Math.random()*i];else for(a[8]=a[13]=a[18]=a[23]="-",a[14]="4",t=0;t<36;t++)a[t]||(n=0|16*Math.random(),a[t]=o[19==t?3&n|8:n]);return a.join("")}(3,10)+(new Date).getTime().toString().slice(2,13),n?u.set(t,r):function(e,i,t,n,o){o=o&&new Date(+new Date+o);var a=e+"="+escape(i)+(o?"; expires="+o.toGMTString():"")+(n?"; path="+n:"")+(t?"; domain="+t:"");a.length<4096&&(m.cookie=a)}(t,r,null,"/",31536e6),i=r),i}function y(){function e(e){var i=document.createElement("b");return i.innerHTML="\x3c!--[if IE "+e+"]><i></i><![endif]--\x3e",1===i.getElementsByTagName("i").length}function i(e,i){return""!==e?e+i.slice(0,1).toUpperCase()+i.slice(1):i}var t,n=void 0,o=null,a=e(),c=e(9),s=c?"":null,r=(t=!1,"number"==typeof window.screenX&&["webkit","moz","ms","o",""].forEach(function(e){0==t&&null!=document[i(e,"hidden")]&&(s=e,t=!0)}),t);function d(){n=!1,c?document.dispatchEvent(o):document.documentElement.visibilitychange=1}function m(){n=!0,c?document.dispatchEvent(o):document.documentElement.visibilitychange=0}a&&!r&&(document.addEventListener?(window.addEventListener("focus",d,!0),window.addEventListener("blur",m,!0)):(document.attachEvent("onfocusin",d),document.attachEvent("onfocusout",m)),void 0===document.createEvent||o?document.documentElement.visibilitychange=0:(o=document.createEvent("HTMLEvents")).initEvent("visibilitychange",!0,!0));function u(){return r?document[i(s,"hidden")]:void 0!==n?n:void 0}function l(){return r?document[i(s,"visibilityState")]:void 0!==n?n?"hidden":"visible":void 0}return{hidden:u(),isHidden:u,isPageVisibilitySupport:r,visibilityState:l(),visibilitychange:function(i){if("function"==typeof i){if(r||c)return document.addEventListener(s+"visibilitychange",function(e){i.call(this,e,u(),l())},!1);document.documentElement.attachEvent("onpropertychange",function(e){"visibilitychange"==event.propertyName&&i.call(this,e,u(),l())})}}}}function N(e,i){return e.test(i)}function k(e){var i=e||navigator.userAgent,t=i.split("[FBAN");if(void 0!==t[1]&&(i=t[0]),void 0!==(t=i.split("Twitter"))[1]&&(i=t[0]),this.apple={phone:N(o,i),ipod:N(s,i),tablet:!N(o,i)&&N(r,i),device:N(o,i)||N(s,i)||N(r,i)},this.amazon={phone:N(p,i),tablet:!N(p,i)&&N(_,i),device:N(p,i)||N(_,i)},this.android={phone:N(p,i)||N(d,i),tablet:!N(p,i)&&!N(d,i)&&(N(_,i)||N(l,i)),device:N(p,i)||N(_,i)||N(d,i)||N(l,i)},this.windows={phone:N(h,i),tablet:N(f,i),device:N(h,i)||N(f,i)},this.other={blackberry:N(g,i),blackberry10:N(q,i),opera:N(T,i),firefox:N(w,i),chrome:N(S,i),device:N(g,i)||N(q,i)||N(T,i)||N(w,i)||N(S,i)},this.seven_inch=N(M,i),this.any=this.apple.device||this.android.device||this.windows.device||this.other.device||this.seven_inch,this.phone=this.apple.phone||this.android.phone||this.windows.phone,this.tablet=this.apple.tablet||this.android.tablet||this.windows.tablet,"undefined"==typeof window)return this}A.userAgent=R,t=window,o=/iPhone/i,s=/iPod/i,r=/iPad/i,d=/(?=.*\bAndroid\b)(?=.*\bMobile\b)/i,l=/Android/i,p=/(?=.*\bAndroid\b)(?=.*\bSD4930UR\b)/i,_=/(?=.*\bAndroid\b)(?=.*\b(?:KFOT|KFTT|KFJWI|KFJWA|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|KFARWI|KFASWI|KFSAWI|KFSAWA)\b)/i,h=/Windows Phone/i,f=/(?=.*\bWindows\b)(?=.*\bARM\b)/i,g=/BlackBerry/i,q=/BB10/i,T=/Opera Mini/i,S=/(CriOS|Chrome)(?=.*\bMobile\b)/i,w=/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i,M=new RegExp("(?:Nexus 7|BNTV250|Kindle Fire|Silk|GT-P1000)","i"),t.isMobile=((n=new k).Class=k,n);var O={link:"https://"+(__domain||{chat:"chat"}).chat+".qidian.qq.com",opts:{path:"/status",reconnectionDelay:2e3,reconnectionDelayMax:3e3,reconnectionAttempts:2,timeout:2e4,transports:["websocket"]}},L={statusNotice:{emit:"active_notice"},b2cMsgNum:{receive:"b2c_msg_num",emit:"b2c_msg_num ack"},invitation:{receive:"session_invitation",emit:"user_operate"},inviteAutoConf:{emit:"invite_auto_conf",receive:"invite_auto_conf"}},P=function(n){var e,i,t,o,a={},c=[],s={},r=C(),d=(e=n.location.href,i=v(e,"linkType"),t=v(e,"visitorId"),o=n.parent!=n,t&&0<t.length&&(i=1),!(!(i&&0<(""+i).length)||o)),m=y();function u(e){e&&b.send(e,"ONLINE_STATUS")}m.isPageVisibilitySupport&&m.visibilitychange(function(e,i,t){setTimeout(function(){0==i&&"visible"==t&&g()},500)});var l=new E;function p(e){switch(e.act){case"SM_INIT":if(a&&a.kfuin==e.kfuin)return;(a=e).linkType=e.linkType?1:0,c.push(a),_(a);break;case"SM_REFUSE":l.emitMsg(L.invitation.emit,{action:"refuse"});break;case"SMS_SM_FORCE_CONNECT":g();break;case"SM_INVITE_RET":l.emitMsg(L.invitation.emit,{operate:void 0})}}function _(t){l.emitMsg(L.statusNotice.emit,t,function(e){var i;0==e.errcode&&(d||(i=t,l.emitMsg(L.inviteAutoConf.emit,i),l.receiveMsg(L.inviteAutoConf.receive,function(e){u({act:"SM_INVITE_CONF",kfuin:e.body.invitationConf.kfuin,inviteRule:e.body.invitationConf})})))})}function h(){for(var e=0,i=c.length;e<i;e++)_(c[e])}function f(t){r&&$.extend(O.opts,{query:"queryId="+r}),l.create(O.link,O.opts),l.ioLink.once("connect",function(){var e,i;l.receiveMsg(L.b2cMsgNum.receive,function(e){var i=e.body,t="kfuin"+i.kfuin;l.emitMsg(L.b2cMsgNum.emit),i.number=i.msgNum||0,delete i.seq,delete i.msgNum,void 0!==i.receptionName?s[t]=i.receptionName:i.receptionName=s.hasOwnProperty(t)?s[t]:null,u({act:"SM_UNREAD",kfuin:i.kfuin,data:i})}),l.receiveMsg(L.invitation.receive,function(e){var i=e.body.kfuin;delete e.body.kfuin,u({act:"SM_MANUAL_INVITE",kfuin:i,data:e.body})}),"reconnect"==t?h():(u({act:"SM_READY"}),d&&(e=n.location.href,i=v(e,"kfuin"),u({act:"SM_INIT",visitorId:r,kfuin:i,linkType:1,isMobile:Number(isMobile)})))}),l.ioLink.once("reconnect_attempt",function(){"undefined"!=typeof WebSocket&&void 0!==WebSocket.prototype.send||(l.ioLink.io.opts.path="/polling_session",l.ioLink.io.opts.transports=["polling","websocket"])}),l.ioLink.once("reconnect",function(){h()}),l.ioLink.once("disconnect",function(e){"transport close"===e&&u({act:"DISCONNECT"})})}function g(){l.ioLink&&l.ioLink.disconnected&&f("reconnect")}return l.emitMsg=function(e,i,t,n){return this.ioLink.emit(e,i,function(){t&&t.apply(n,arguments)}),this},{start:function(){n.CURRENT_VISITORID&&(r=n.CURRENT_VISITORID),f(),b.receive(n,p)},forceConnect:g}}(window);(window.__STATUS_MANAGER=P).start()}();