<!DOCTYPE html>
<!-- saved from url=(0068)https://write.qq.com/portal/dashboard/create-novel?isshortstory=true -->
<html lang="zh-CN" xmlns:th="http://wwww.thymeleaf.org">
<head>
    <base href="http://localhost:8088/aiyue/">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta name="robots" content="all">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="description" content="作家专区是阅文集团致力于原创作家孵化、培育、创作、挖掘的网络文学平台，作家可以通过作家学院在线课程的学习，使用作家专区及作家助手移动端APP发布与管理小说、查看数据、与读者互动。">
    <meta name="keywords" content="写小说，作家学院，作家专区，原创文学，网络文学，网络小说，在线写作，作家助手，起点中文网，创世中文网，云起书院，起点女生网，起点文学网，阅文集团">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">

    <title>
      
    创建短篇故事
-阅文作家专区
    </title>
    <meta name="keywords" content="">
    <meta name="description" content="">
    <link rel="icon" href="http://author.tadu.com/public/assets/images/tadu.ico" type="image/x-icon">
    <link href="CreateMessage2_files/information300-d895d74355.css" rel="stylesheet" type="text/css">
    <link href="CreateMessage2_files/information380-b37d6e37fa.css" rel="stylesheet" type="text/css">
    <!--[if lt IE 9]>
    <script src=”http://ie7-js.googlecode.com/svn/version/2.1(beta4)/IE9.js”></script>
    <![endif]-->

    <link rel="shortcut icon" type="image/x-icon" href="https://write.qq.com/portal/public/images/favicon.ico">
    <link rel="Bookmark" type="image/x-icon" href="https://write.qq.com/portal/public/images/favicon.ico">
    <!--   <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;" name="viewport" />-->
    <link rel="stylesheet" href="CreateMessage2_files/reset.css">
    <link rel="stylesheet" href="CreateMessage2_files/index.css">
    <link rel="stylesheet" href="CreateMessage2_files/font.css">
    <link rel="stylesheet" href="CreateMessage2_files/module.css">
    <link rel="stylesheet" href="CreateMessage2_files/layout.css">
    <link rel="stylesheet" href="CreateMessage2_files/header.css">
    <link rel="stylesheet" href="CreateMessage2_files/footer.css">
    <link rel="stylesheet" href="CreateMessage2_files/dialog.css">

    
    
<link rel="stylesheet" href="CreateMessage2_files/common.css">
<link rel="stylesheet" href="CreateMessage2_files/ui.css">
<link rel="stylesheet" href="CreateMessage2_files/dashboard-common.css">
<link rel="stylesheet" href="CreateMessage2_files/dashboard-form.css">
<link rel="stylesheet" href="CreateMessage2_files/dashboard-book-create.css">


    
    <script src="CreateMessage2_files/stats.js" name="MTAH5" sid="500659219" cid="500664628"></script><script async="" src="CreateMessage2_files/yep.js"></script><script type="text/javascript" src="CreateMessage2_files/aq_common.js"></script>

    
    <script type="text/javascript">
      (function(i,s,o,g,r,a,m){i['QDAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://noah2-1252317822.file.myqcloud.com/npm/@noah-common/yep@0.0.46/dist/yep.js','yep');
      yep('set', {
        appid: 10040,
        rate: .1
      }),
      yep('custom', {
        w_darkmode: ( !!window.matchMedia ) && window.matchMedia("(prefers-color-scheme: dark)").matches ? 1 : 0
      });
    </script>

    <style>
        ::-webkit-input-placeholder { /* WebKit browsers */
            color:    #aeaeae;
        }
        :-moz-placeholder { /* Mozilla Firefox 4 to 18 */
            color:    #aeaeae;
        }
        ::-moz-placeholder { /* Mozilla Firefox 19+ */
            color:    #aeaeae;
        }
        :-ms-input-placeholder { /* Internet Explorer 10+ */
            color:    #aeaeae;
        }
    </style>
  </head>
  <body style="zoom: 1;">
    
    


<div class="g-header">
    <div class="header" id="j-siteHeader">
  <!--<div class="box-center cf">
    &lt;!&ndash; 未登录 &ndash;&gt;
    <div class="no-login">

    </div>
    &lt;!&ndash; 图标列表，包含用户信息 &ndash;&gt;
    <div class="icon-list j-slideDownList">
      <ul>

        <li>
          <a class="icon-font" href="https://write.qq.com/portal/dashboard"><cite class="icon-hover-tip down">工作台</cite></a>
        </li>

        <li>
          <a class="icon-font" href="javascript:"></a>
          <div class="slide-down-wrap list">
            <cite><span><i></i></span></cite>
            <dl>
              <dd onclick="tucao()"><a href="javascript:;">意见反馈</a></dd>
              <dd><a href="https://write.qq.com/contentv2/about/help_center.html" target="_blank">帮助中心</a></dd>
              <dd><a href="https://write.qq.com/portal/version" target="_blank">更新说明</a></dd>
            </dl>
          </div>
        </li>

        <li class="j-notify">

          <a class="icon-font" href="https://write.qq.com/portal/dashboard/authorConsult">
            
            <cite class="icon-hover-tip down">通知</cite>
          </a>
        </li>
        <li class="user-info">
          <a class="avatar-box" href="javascript:" id="j-avatarBox">
            <img class="avatar" src="CreateMessage2_files/photo_default.png" onerror="javascript:this.src=&#39;https://ccstatic-1252317822.file.myqcloud.com/portraitimg/2019-09-19/5d82ecf354f0d.png&#39;;">
          </a>
          <div class="slide-down-wrap user-detail">
            <cite><span><i></i></span></cite>
            <div class="detail-wrap">
              <div class="level-info">
                <h3>
                  <i>原创作家</i>

                  <em>普通</em>
                </h3>

              </div>
              <div class="menu-list">
                <dl>
                  <dd><a href="https://write.qq.com/portal/dashboard/books" target="_blank">作品管理</a></dd>
                  <dd><a href="https://write.qq.com/portal/booknovels/chaptertmp/CBID/17958922108504204" target="_blank">立即写作</a></dd>
                </dl>
                <dl>
                  <dd><a href="https://write.qq.com/portal/collect">我收藏的文章</a></dd>
                  <dd><a href="https://write.qq.com/portal/mycolumn">我关注的专栏</a></dd>
                </dl>
                <dl>
                  <dd><a href="https://write.qq.com/portal/dashboard/authorInfo" target="_blank"><span>完整度 50%</span>个人资料</a></dd>
                  <dd><a href="https://write.qq.com/portal/mod-vip-password" target="_blank">修改 VIP 密码</a></dd>
                  <dd><a href="javascript:" id="logout">退出登录</a></dd>
                </dl>
              </div>

            </div>
          </div>
        </li>

      </ul>
    </div>-->
    <!-- logo -->
    <!--<div class="logo">
      <h1 title="阅文作家专区"><a href="https://write.qq.com/"></a></h1>

      <div class="nav-item j-slideDownList">
        <ul>
          <li>

            <div class="slide-down-wrap list">
              <cite><span><i></i></span></cite>
              <dl>
                <dd><a href="https://write.qq.com/">首页</a></dd>
                <dd><a href="https://write.qq.com/portal/article">文章</a></dd>
                <dd><a href="https://write.qq.com/portal/spcolumn">专栏</a></dd>
                <dd><a href="https://write.qq.com/portal/news">资讯</a></dd>
              </dl>
            </div>
          </li>
        </ul>
      </div>
    </div>-->
  </div>
</div>
<script src="CreateMessage2_files/ywlogin_v1.js"></script>
<script>
  yw.setParams({
    "appId": "34",
    "areaId": "1006",
    "popup_close":1,
    "ticket":1,
    // 可选回调页面
    "returnUrl": "/public/logout.html" ,
    "autoshow": 1 ,
    "unionshow":11111,
    "auto":1,
    "autotime":7
  });
  var logoutEl = document.getElementById("logout");
  if (logoutEl) {
    if (logoutEl.addEventListener) {
      logoutEl.addEventListener("click", function() {
        yw.logout(function(){
          location.href = '/public/logout.html';
        });
      });
    } else {
      logoutEl.attachEvent("onclick", function() {
        yw.logout(function(){
          location.href = '/public/logout.html';
        });
      });
    }
  }
</script>
    <script src="CreateMessage2_files/jquery.js"></script>
    <script src="CreateMessage2_files/all.js"></script>

</div>
<div class="g-row mt24 work-create">
    <div class="g-col g-col-2 g-side">
        <div class="g-side-con">
<!--
<div class="g-nav g-section-bg">
    <ul>
        <li data-event-id="1">
            &lt;!&ndash; 高亮添加这个class &ndash;&gt;
            <a href="javascript:void(0)"><em class="icon-font"></em><em class="icon-font active"></em>工作台</a>
        </li>
        <li data-event-id="2">
            <a href="javascript:void(0)"><em class="icon-font"></em><em class="icon-font active"></em>作品管理</a>
        </li>
        &lt;!&ndash;<li data-event-id="3">
            <a href="https://write.qq.com/booknovelsvip/takeindex.html"><em class="icon-font"></em><em class="icon-font active"></em>数据中心</a>
        </li>
        <li data-event-id="4">
            <a href="https://write.qq.com/income/index.html"><em class="icon-font"></em><em class="icon-font active"></em>稿酬收入</a>
        </li>
        <li data-event-id="5">
            <a href="https://write.qq.com/labor.html"><em class="icon-font"></em><em class="icon-font active"></em>劳务收入</a>
        </li>
        <li data-event-id="6" class="sidebar-interactive">
            <a href="https://write.qq.com/portal/dashboard/interactive-manage"><em class="icon-font"></em><em class="icon-font active"></em>互动管理</a>
            <div class="interactive-guide">
                <p class="interactive-guide-txt"><em class="interactive-guide-star icon-font"></em>新版<span class="c-primary">评论管理</span>全新上线，快来看看</p>
                <div class="interactive-guide-footer"><a href="https://write.qq.com/portal/dashboard/interactive-manage" class="ui-button ui-button-primary">去看看</a></div>
            </div>
        </li>
        <li data-event-id="7">
            <a href="https://write.qq.com/portal/dashboard/exchange">
                <em class="icon-font"></em><em class="icon-font active"></em>积分兑换
                
            </a>
        </li>
        <li data-event-id="8">
            <a href="https://write.qq.com/portal/dashboard/authorConsult"><em class="icon-font"></em><em class="icon-font active"></em>作家咨询</a>
        </li>&ndash;&gt;
        
    </ul>
</div>
        </div>-->

        <div class="g-col g-col-10">
            <div class="g-section-bg g-body-h1">
                <div class="g-body-h2">


                    <div class="g-title-h2 mb24">
                        <h2 class="g-h2">创建作品</h2>
                    </div>
                    <div class="wc-progress _step2">
                        <div class="wcp-item _one">
                            <div class="wcp-status">
                                <i class="wcp-icon _num">1</i>
                                <i class="wcp-icon _numbg">1</i>
                                <i class="wcp-icon _finished"><em class="icon-font input-vertified"></em></i>
                            </div>
                            <p class="wcp-txt">选择类型</p>
                        </div>
                        <div class="wcp-item _two">
                            <div class="wcp-status">
                                <i class="wcp-icon _num">2</i>
                                <i class="wcp-icon _numbg">2</i>
                                <i class="wcp-icon _finished"><em class="icon-font input-vertified"></em></i>
                            </div>
                            <p class="wcp-txt">完善作品信息</p>
                        </div>
                        <div class="wcp-item _three">
                            <div class="wcp-status">
                                <i class="wcp-icon _num">3</i>
                                <i class="wcp-icon _numbg">3</i>
                                <i class="wcp-icon _finished"><em class="icon-font input-vertified"></em></i>
                            </div>
                            <p class="wcp-txt">创建成功</p>
                        </div>
                        <div id="content">
                                <!-- 创建作品 -->
                                <div class="cj_box clearfix" x>
                                    <div class="imgCover_l">
                                        <div class="cover_img" id="preview">
                                            <img src="CreateMessage2_files/default_book.png" data-src="" id="imghead">
                                            <span>书封选填</span>
                                        </div>
                                        <div class="upload_btn">上传书封</div>
                                    </div>
                                    <div class="pdctNow selectMenu ">
                                        <div class="block bName">
                                            <span class="title">书名：</span>
                                            <input type="text" style="width: 300px;" name="bookName" id="bookName" placeholder="15字以内，请勿添加特殊符号" maxlength="15" >
                                            <span class="hint hidden"></span>
                                        </div>

                                        <!--                 征文活动-->

                                        <div class="block channel" hidden>
                                            <span class="title">频道：</span>
                                            <div class="opt  radio_checked  " data-id="0">
                                                <span class="radio"></span> 网文男频
                                            </div>
                                            <div class="opt  " data-id="1">
                                                <span class="radio"></span> 网文女频
                                            </div>
                                            <div class="opt  " data-id="2">
                                                <span class="radio"></span> 其他
                                            </div>
                                            <input type="hidden" id="channelVal" value="0">
                                            <span class="hint hidden"></span>
                                        </div>


                                        <div class="block classify">
                                            <span class="title">分类：</span>
                                            <div class="pdMenu">
                                                <div class="certificate city" id="type">
                                                    <span><em class="ctem" data-id="" >请选择</em><i></i></span>

                                                    <ul class="hidden" >
                                                        <li data-id="99" data-parentid="0" th:each="c1:${types}">
                                                            <em th:text="${c1.tname}" onclick="setTid(this)" th:id="${c1.tid}"></em>
                                                        </li>
                                                        <!--<li data-id="4" data-parentid="1" class="hidden" th:each="c2:${types}">
                                                            <em th:text="${c2.tname}"></em>
                                                        </li>
                                                        <li data-id="10" data-parentid="2" class="hidden" th:each="c3:${types}">
                                                            <em th:text="${c3.tname}"></em>
                                                        </li>-->
                                                        <!--<li data-id="99" data-parentid="0">
                                                            <em>经管理财</em>
                                                        </li>
                                                        <li data-id="4" data-parentid="1" class="hidden">
                                                            <em>现代都市</em>
                                                        </li>
                                                        <li data-id="10" data-parentid="2" class="hidden">
                                                            <em>纪实传记</em>
                                                        </li>-->
                                                        <!--<li data-id="32" data-parentid="79" class="hidden">
                                                            <em>经管理财</em>
                                                        </li>
                                                        <li data-id="81" data-parentid="79" class="hidden">
                                                            <em>现代都市</em>
                                                        </li>
                                                        <li data-id="82" data-parentid="79" class="hidden">
                                                            <em>纪实传记</em>
                                                        </li>
                                                        <li data-id="83" data-parentid="79" class="hidden">
                                                            <em>青春文学</em>
                                                        </li>
                                                        <li data-id="84" data-parentid="79" class="hidden">
                                                            <em>历史风云</em>
                                                        </li>
                                                        <li data-id="85" data-parentid="79" class="hidden">
                                                            <em>悬疑灵异</em>
                                                        </li>
                                                        <li data-id="86" data-parentid="79" class="hidden">
                                                            <em>铁血军事</em>
                                                        </li>
                                                        <li data-id="87" data-parentid="79" class="hidden">
                                                            <em>生活休闲</em>
                                                        </li>
                                                        <li data-id="88" data-parentid="79" class="hidden">
                                                            <em>励志成功</em>
                                                        </li>
                                                        <li data-id="89" data-parentid="79" class="hidden">
                                                            <em>童话寓言</em>
                                                        </li>
                                                        <li data-id="90" data-parentid="79" class="hidden">
                                                            <em>外国名著</em>
                                                        </li>
                                                        <li data-id="91" data-parentid="79" class="hidden">
                                                            <em>古典名著</em>
                                                        </li>
                                                        <li data-id="92" data-parentid="79" class="hidden">
                                                            <em>职场商战</em>
                                                        </li>
                                                        <li data-id="93" data-parentid="79" class="hidden">
                                                            <em>当代文学</em>
                                                        </li>
                                                        <li data-id="102" data-parentid="79" class="hidden">
                                                            <em>影视娱乐</em>
                                                        </li>
                                                        <li data-id="103" data-parentid="98">
                                                            <em>现代都市</em>
                                                        </li>
                                                        <li data-id="104" data-parentid="122" class="hidden">
                                                            <em>现代言情</em>
                                                        </li>
                                                        <li data-id="105" data-parentid="122" class="hidden">
                                                            <em>浪漫青春</em>
                                                        </li>
                                                        <li data-id="107" data-parentid="98">
                                                            <em>西方奇幻</em>
                                                        </li>
                                                        <li data-id="108" data-parentid="98">
                                                            <em>历史架空</em>
                                                        </li>
                                                        <li data-id="109" data-parentid="98">
                                                            <em>武侠仙侠</em>
                                                        </li>
                                                        <li data-id="111" data-parentid="98">
                                                            <em>科幻末世</em>
                                                        </li>
                                                        <li data-id="112" data-parentid="98">
                                                            <em>游戏竞技</em>
                                                        </li>
                                                        <li data-id="113" data-parentid="98">
                                                            <em>军事战争</em>
                                                        </li>
                                                        <li data-id="115" data-parentid="79" class="hidden">
                                                            <em>官场沉浮</em>
                                                        </li>
                                                        <li data-id="121" data-parentid="79" class="hidden">
                                                            <em>教育教辅</em>
                                                        </li>
                                                        <li data-id="128" data-parentid="98">
                                                            <em>灵异悬疑</em>
                                                        </li>
                                                        <li data-id="129" data-parentid="122" class="hidden">
                                                            <em>古代言情</em>
                                                        </li>
                                                        <li data-id="133" data-parentid="122" class="hidden">
                                                            <em>幻想言情</em>
                                                        </li>
                                                        <li data-id="135" data-parentid="98">
                                                            <em>脑洞创意</em>
                                                        </li>
                                                        <li data-id="138" data-parentid="79" class="hidden">
                                                            <em>两性伦理</em>
                                                        </li>
                                                        <li data-id="139" data-parentid="79" class="hidden">
                                                            <em>言情小说</em>
                                                        </li>
                                                        <li data-id="271" data-parentid="270" class="hidden">
                                                            <em>异能 • 幻想</em>
                                                        </li>-->
                                                    </ul>
                                                </div>

                                            </div>
                                            <span class="hint hidden"></span>
                                        </div>


                                        <div class="block bookIntro">
                                            <span class="title">作品简介：</span>
                                            <div class="mtext" style="width: 300px;height: 200px">
                                                <textarea name="textarea" maxlength="400" placeholder="字数限制20-400字之间，生动有趣的简介，更容易让读者接受" id="textarea" class="scroll"></textarea>
                                            </div>
                                            <span class="hint hidden"></span>
                                        </div>

                                        <div class="block">
                                            <span class="title"></span>
                                            <a href="javascript:void(0);" class="link_block" id="submit" onclick="CreateMessage()">创建作品</a>
                                            <a href="javascript:history.go(-1)" class="link_block" id="fanhui">返回</a>
                                        </div>

                                        <ul class="explain">
                                            <li>
                                                说明：
                                            </li>
                                            <li>
                                                1、创建作品请按要求填写相关信息，如有疑问可联系客服进行咨询。
                                            </li>
                                            <li>
                                                2、书名应与简介、正文相符，涉及恶意抄袭、色情暴力、政治反动等违禁内容的作品将被删除。
                                            </li>
                                            <li>
                                                3、上传作品的相关内容必须符合塔读要求，不符合收录标准的作品将被禁阅或删除。
                                            </li>
                                            <li>
                                                4、新创建作品的审核周期为48小时，节假日顺延。
                                            </li>
                                        </ul>

                                        <!-- 创建成功 -->
                                        <div class="cj_succBox hidden">
                                            <div class="cj_succlogo"></div>
                                            <h4>作品创建成功</h4>
                                            <p>
                                                新建作品后，请尽快上传新章节，章节上传满1000字之后将会进行 <br>
                                                审核后台，编辑将会在2个工作日内进行审核。请注意：根据国家相关法律法规 <br>
                                                要求，切勿上传任何色情、暴力、政治反动等违禁内容。一旦出现，我们将根据法规进行审核处理。
                                            </p>
                                            <a href="javascript:;" id="to_drafts_btn" class="link_block">继续上传内容</a>
                                        </div>
                                    </div>
                                </div>
                                <!-- foot -->
                               <!-- <div class="footer">
                                    Copyright© 2008-2020 www.tadu.com All Rights Reserved 版权所有 北京易天新动网络技术有限公司<br>
                                    <a href="http://www.beian.miit.gov.cn/" style="color:#999">
                                        京ICP备09017823号-5
                                    </a>
                                </div>-->
                                <div class="book_imgBox hidden">
                                    <h4>上传书封<a href="javascript:;" class="imgclose_btn"></a></h4>
                                    <div class="clearfix img_con">
                                        <div class="img_file">
                                            <img id="imgSelect" src="CreateMessage2_files/def_imgfile.png" alt="">
                                            <form id="fileupload" action="http://author.tadu.com/api/v1/imgUrl" method="post" enctype="multipart/form-data" target="disIframe">
                                                <input type="file" id="file" name="file" ref="file">
                                            </form>
                                            <div class="link_block">上传书封</div>
                                        </div>
                                        <p>
                                            1.规格600*800像素,小于500K的jpg图片；<br>
                                            2.禁止上传任何有黄色、暴力、血腥、恐怖、广告宣传或者不适合公众欣赏的封面，一经发现即做禁书处理；<br>
                                            3.作品封面由用户个人制作并上传，基于此产生的法律责任本站不承担连带责任。
                                        </p>
                                    </div>
                                </div>
                                <!-- 弹窗 380 开始-->
                                <div class="boxshadow_bg hidden"></div>
                                <!-- 选择提示 -->
                                <div class="popup_box">
                                    <a href="javascript:;" class="popup_close"></a>
                                    <div class="popup_title">消息提示</div>
                                    <p></p>
                                    <div class="btn">
                                        <!-- sure为单独确认关闭窗口 -->
                                        <span class="sure_btn">确定</span>
                                        <!-- 以下为选择按钮 -->
                                        <span class="confirm">确定</span>
                                        <span class="cancel">取消</span>
                                    </div>
                                </div>
                                <!-- toast -->
                                <div class="submitted hidden">
                                    <i class="success"></i>
                                    <span></span>
                                </div>
                                <!-- 弹窗 380 结束-->
                            <script type="text/javascript" src="js/jquery-3.4.1.js"></script>
                            <script>
                                var tid;
                                function setTid(obj){
                                    tid = obj.id;
                                    console.log(tid);
                                }
                                function CreateMessage() {
                                    var mename = $('#bookName').val();
                                    var typeid = tid;
                                    var synopsis = $('#textarea').val();
                                    var surface = document.getElementById('file').files[0];
                                    let fd = new FormData();
                                    fd.append("typeid",typeid);
                                    fd.append("mename",mename);
                                    fd.append("surface",surface);
                                    fd.append("synopsis",synopsis);

                                    fd.toString();
                                    $.ajax({
                                        url: "http://localhost:8088/aiyue/writerQ/addMessage",
                                        data:fd,
                                        type:"psot",
                                        // async:false,
                                        processData: false,
                                        contentType: false,
                                        success: function (arg) {
                                            console.log(arg);
                                            window.location = "http://localhost:8088/aiyue/CreateMessage3.html";
                                        },
                                        error:function(err){
                                            console.log(err);
                                            alert("意料之外的错误");
                                        }
                                    });
                                }

                            </script>
                                <!-- toast -->
                                <div class="submitted hidden">
                                    <i class="success"></i>
                                    <span></span>
                                </div>
                                <!-- 弹窗 380 结束-->--&gt;
                                <!--<a href="javascript:void(0);" class="feedback" onclick="feedBack()"></a>-->

                            </div>
                    </div>
                </div>
            </div>
        </div>

        <script charset="utf-8" src="CreateMessage2_files/UrlChangeTracker.js"></script><script src="CreateMessage2_files/hm.js"></script><script src="CreateMessage2_files/tucao-2bdbbe6f09.js"></script>

        <script type="text/javascript">
            //baidu统计

            var _hmt = _hmt || [];
            (function() {
                var hm = document.createElement("script");
                hm.src = "https://hm.baidu.com/hm.js?a17f25b8813e0e44cf2ae448a50328ec";
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(hm, s);
            })();
            //end

            //吐槽
            function feedBack() {
                $.ajax({
                    url: "/qq/feedback",
                    type: "get",
                    success: function(res) {
                        if (res.data.login) {
                            var nickname = res.data.nickname;
                            var avatar = res.data.avatar;
                            var openid = res.data.openid;
                            var custom = res.data.custom;
                            var data = {
                                    // nickname,avatar,openid 必填
                                    "nickname": nickname,
                                    "avatar": avatar,
                                    "openid": openid,
                                    "clientInfo":"author-web",
                                    "customInfo": custom
                                },
                                productId = 52620;// 作者专区ID

                            Tucao.request(productId, data);
                        } else {
                            window.location.href = 'https://support.qq.com/product/52620';
//                    window.open('https://support.qq.com/product/52620','_blank');
                        }
                    }
                })
            }

        </script></div>
    <script>
        var classifyUrl = '/api/v1/classify'; //请求三级分类 后台传入url地址
    </script>
    <script src="CreateMessage2_files/jquery-1-22e85f4f06.12.4.min.js"></script>
    <script src="CreateMessage2_files/lazyload300-8ed982d92e.js"></script>
    <script src="CreateMessage2_files/information_new300-08ea1dd576.js"></script>
    <script src="CreateMessage2_files/infcommon300-bb58a2d1c3.js"></script>

<script>
    $(".g-nav li").on("click", function() {
        var $this = $(this);
        var cauthorid = "17752236906517001";
        var eventID = $this.data("event-id");
        dataReport({
            pageid: "ZQ_common",
            eventid: "ZQ_E0" + eventID,
            cauthorid: cauthorid
        });
    });

    function showReviewManageGuide() {
        $.ajax({
            dataType: 'json',
            contentType: "application/json",
            url: '/portal/domesticsite?service=guideservice&action=isGuide&type=69&t=' + Date.now(),
            success: function(res) {
                if (res.returnCode == 200 && !res.result) {
                    $(".interactive-guide").show();
                }
            }
        });
    }
    $.ajax({
        dataType: 'json',
        contentType: "application/json",
        url: '/ccauthorweb/reviewmanager/getGrayLevelControl?t=' + Date.now(),
        success: function(res) {
            if (res.returnCode == 2000 && res.result == 1) {
                showReviewManageGuide();
            }
        }
    });
</script>


        </div>
    </div>
</div>

<!-- 公用js -->
<script src="CreateMessage2_files/jquery.js"></script>
<script src="CreateMessage2_files/jquery.cookie.js"></script>



<script src="CreateMessage2_files/util.js"></script>
<script src="CreateMessage2_files/dialog.js"></script>
<script src="CreateMessage2_files/ajax.js"></script>
<script src="CreateMessage2_files/header.js"></script>
<script src="CreateMessage2_files/common.js"></script>
<script src="CreateMessage2_files/qrcode.min.js"></script>
<script src="CreateMessage2_files/browser.js"></script>
<script src="CreateMessage2_files/tucao.js"></script>
<script>
  function tucao() {
    var cauthorid = '17752236906517001'
    if (cauthorid == null || cauthorid == '') {
      window.location.href = '/public/login.html?artidx=-100';
    } else {
      var _browser = CS.browser;

      var data = {
        "nickname": '原创作家',
        "avatar": "https://ccstatic-1252317822.file.myqcloud.com/writer/p1/contentv2/photo_default.png",
        "openid": '17752236906517001',
        "os": _browser.detectOS(),
        "clientInfo": _browser.browserType(),
        "clientVersion": _browser.browserType(),
        "customInfo": '原创作家' + '17752236906517001'
      };
      var productId = 1924;
      Tucao.request(productId, data);
    }
  }

</script>
<script>
  function getCookie(name) {
    var arr,reg=new RegExp("(^| )"+name+"=([^;]*)(;|$)");

    if(arr=document.cookie.match(reg))
      return unescape(arr[2]);
    else
      return '';
  }
  $(document).ready(function() {
    $(document).ajaxSend(function(event, jqxhr, settings) {
      jqxhr.setRequestHeader('X-TOKEN', getCookie("pubtoken"));
    });
  });
</script>
<script src="CreateMessage2_files/data-report.js"></script>


<script src="CreateMessage2_files/jquery.js"></script>
<script src="CreateMessage2_files/all.js"></script>
<script src="CreateMessage2_files/underscore.js"></script>
<script src="CreateMessage2_files/jquery.validate.min.js"></script>
<script type="text/template" id="siteSelectTpl">
    <div class="write-form-li">
        <label class="write-form-label">发布平台</label>
        <div class="write-form-cell">
            <div class="write-input line-rcs lrc-item">
            <% _.each(data, function (item) { %>
                <input type="radio" id="site<%= item.site %>" name="site" value="<%= item.site %>">
                <label for="site<%= item.site %>" class="ui-radio"></label>
                <label class="radio-txt mr24" for="site<%= item.site %>"><%= item.name %></label>
            <% }); %>
            <p class="input-error"></p>
            </div>
        </div>
    </div>
</script>
<script type="text/template" id="nameInputTpl">
    <div class="write-form-li">
        <label class="write-form-label" for="title">作品名称</label>
        <div class="write-form-cell">
            <div class="write-input">
                <div class="ui-input j-check">

                    <input name="title" placeholder="请填写">
                    <em class="icon-font input-vertified icon_check_circle">&#xe90b;</em>
                </div>
                <p class="input-caution">15字以内，请勿添加书名号等特殊符号</p>
                <p class="input-error">请填写作品名称</p>
            </div>
        </div>
    </div>
</script>
<script type="text/template" id="catSelectTpl">
    <div class="write-form-li" id="catFormLi">
        <label class="write-form-label">作品类型</label>
        <div class="write-form-cell">
            <div class="write-input">
                <div class="_twocolumn">
                    <div class="ui-input" >
                        <select id="catSelect" name="category">
                            <option value=""></option>
                            <% _.each(data, function (item) { %>
                                <option
                                    value="<%= item.categoryid %>"
                                    <% if(selectedID == item.categoryid){ %>
                                    selected
                                    <% } %>
                                ><%= item.categoryname %></option>
                            <% }); %>
                        </select>
                    </div>
                    <div class="ui-input">
                        <select id="subcatSelect" name="subcategory">
                            <option></option>
                        </select>
                    </div>
                </div>
                <p class="input-caution"></p>
                <p class="input-error">请选择作品类型</p>
            </div>
        </div>
    </div>
</script>
<script type="text/template" id="shortStoryCatSelectTpl">
    <div class="write-form-li shortstory-cat" id="catFormLi">
        <label class="write-form-label">作品类型</label>
        <div class="write-form-cell">
            <div class="write-input">
                <div class="">
                    <div class="ui-input dn" >
                        <select id="catSelect" name="category" class="form-ignore">
                            <% _.each(data, function (item) { %>
                                <option value="<%= item.categoryid %>"><%= item.categoryname %></option>
                            <% }); %>
                        </select>
                    </div>
                    <div class="ui-input">
                        <select id="subcatSelect" name="subcategory">
                            <option value=""></option>
                            <% _.each(data[0].subcategoryList, function (item) { %>
                                <option value="<%= item.subcategoryid %>"><%= item.subcategoryname %></option>
                            <% }); %>
                        </select>
                    </div>
                </div>
                <p class="input-caution"><%= data[0].categorydesc %></p>
                <p class="input-error">请选择作品类型</p>
            </div>
        </div>
    </div>
</script>
<script type="text/template" id="actarticleSelectTpl">
    <div class="g-hr mt24 mb24"></div>
    <div class="write-form-li dn" id="actarticleFormLi">
        <label class="write-form-label">征文活动</label>
        <div class="write-form-cell">
            <div class="write-input bc-act">
            </div>
        </div>
    </div>
</script>
<script type="text/template" id="actarticleEmptyOptionTpl">
    <div class="write-input lrc-item">
        <input type="radio" id="act0" name="actarticle" value="0">
        <label for="act0" class="ui-radio"></label>
        <label class="radio-txt mr24" for="act0">不参加活动</label>
    </div>
</script>
<script type="text/template" id="actarticleOptionTpl">
    <% _.each(data, function (item) { %>
    <div class="write-input lrc-item">
        <input type="radio" id="act<%= item.iActArticle.idx %>" name="actarticle" value="<%= item.iActArticle.idx %>">
        <label for="act<%= item.iActArticle.idx %>" class="ui-radio"></label>
        <label class="radio-txt mr24" for="act<%= item.iActArticle.idx %>">
            <%= item.iActArticle.authorcontent %>
            <a class="bc-act-link" href="/portal/dashboard/actarticleDetail?id=<%= item.iActArticle.idx %>" target="_blank">活动详情</a>
        </label>
    </div>
    <% }); %>
</script>
<script type="text/template" id="actExtSelectTpl">
    <div class="write-form-li dn" id="actextFormLi">
        <label class="write-form-label">选择赛区</label>
        <div class="write-form-cell">
            <div class="write-input">
                <p class="input-error">请选择赛区</p>
            </div>
        </div>
    </div>
    <!-- <div class="g-hr mt24 mb24"></div> -->
</script>
<script type="text/template" id="actExtOptionTpl">
    <% _.each(data, function (item) { %>
    <label class="lrc-item">
        <input type="radio" id="artext<%= item.idx %>" name="artext" class="form-ignore" value="<%= item.idx %>">
        <label for="artext<%= item.idx %>" class="ui-radio"></label><label class="radio-txt mr24" for="artext<%= item.idx %>"><%= item.extname %></label>
        <div class="rc-con">
            <p class="input-caution"><%= item.extdescription %></p>
        </div>
    </label>
    <% }); %>
</script>
<script type="text/template" id="precollectionSelectTpl">
    <div class="write-form-li dn" id="precollectionFormLi">
        <label class="write-form-label">预收藏</label>
        <div class="write-form-cell">
            <div class="write-input lrc-item ">
                <% if(data){ %>
                <input type="radio" id="preYes" name="precollection" value="1" checked>
                <label for="preYes" class="ui-radio"></label><label class="radio-txt " for="preYes">是</label>
                <i class="icon-idb jsThemeTips mr24" title="按照单章订阅价格付费阅读作品章节内容"><em class="icon-font icon_info input-vertified">&#xe91d;</em></i>
                <input type="radio" id="preNo" name="precollection" value="0">
                <label for="preNo" class="ui-radio"></label><label class="radio-txt " for="preNo">否</label>
                <% } %>
                <% if(!data){ %>
                <input type="radio" id="preYes" name="precollection" value="1" disabled>
                <label for="preYes" class="ui-radio"></label><label class="radio-txt " for="preYes">是</label>
                <i class="icon-idb jsThemeTips mr24" title="按照单章订阅价格付费阅读作品章节内容"><em class="icon-font icon_info input-vertified">&#xe91d;</em></i>
                <input type="radio" id="preNo" name="precollection" value="0" checked>
                <label for="preNo" class="ui-radio"></label><label class="radio-txt " for="preNo">否</label>
                <% } %>
            </div>
            <p class="pre-collect-note _info">创建预收藏作品需要消耗预收藏作品券，你可以在积分兑换页面中消耗 666 积分进行兑换<i class="icon-idb jsThemeTips mr24" title="预收藏作品创建成功后会生成默认章节，正文章节（含默认章节）内容满1000字后会变为正常作品，预收藏标识消失。"><em class="icon-font icon_info input-vertified">&#xe91d;</em></i></p>
        </div>
    </div>
</script>
<script type="text/template" id="saletypeTpl">
    <div class="write-form-li" id="saletypeFormLi">
        <label class="write-form-label">销售意向</label>
        <div class="write-form-cell">
            <div class="write-input lrc-item _info">
                <input type="radio" id="saleSingle" name="saletype" value="1">
                <label for="saleSingle" class="ui-radio"></label><label class="radio-txt " for="saleSingle">单订</label>
                <i class="icon-idb jsThemeTips mr24" title="按照单章订阅价格付费阅读作品章节内容"><em class="icon-font icon_info input-vertified">&#xe91d;</em></i>
                <input type="radio" id="saleMonth" name="saletype" value="2">
                <label for="saleMonth" class="ui-radio"></label><label class="radio-txt " for="saleMonth">包月</label>
                <i class="icon-idb jsThemeTips mr24" title="付X元/月看所有包月作品"><em class="icon-font icon_info input-vertified">&#xe91d;</em></i>
                <p class="input-error">请选择销售意向</p>
            </div>
        </div>
    </div>
</script>
<script type="text/template" id="introInputTpl">
    <div class="write-form-li" id="introFormLi">
        <label class="write-form-label">作品介绍</label>
        <div class="write-form-cell">
            <!-- 添加warning，会出现释放焦点检验有误的样式 -->
            <div class="write-input">

                <div class="ui-textarea j-check">

                    <textarea rows="8" placeholder="请填写" name="intro"></textarea>
                    <em class="icon-font input-vertified icon_check_circle">&#xe90b;</em>
                </div>
                <p class="input-caution">20~500个字</p>
                <p class="input-error">请填写20~50选择对应的编辑组以后将无法修改，请谨慎选择</p>
                <p class="input-error">请0个字</p>
            </div>
        </div>
    </div>
</script>
<!-- 选择编辑分组 -->
<script id="editorGroupTpl" type="text/html">
    <div class="bc-editor-con j-select">
        <ul class="bc-ec-ul cf">
            <% _.each(data, function (item) { %>
            <li class="bc-ec-li" data-id="<%= item.novelgroup %>">
                <a href="javascript:" class="bc-ec-item">
                    <h4 class="bc-ec-title"><%= item.novelgroupname %></h4>
                    <p class="bc-ec-txt"><%= item.intro %></p>
                    <i class="editor-icon-checked"></i>
                    <p class="editor-more-info js-editor-more">详情<em class="icon-font">&#xe90d;</em></p>
                </a>
            </li>
            <% }); %>
        </ul>
    </div>
</script>
<script type="text/template" id="pagemessTpl">
    <div class="write-form-li" id="editorGroupFormLi">
        <label class="write-form-label">编辑组</label>
        <div class="write-form-cell">
            <div class="write-input">
                <p class="bc-check-group jEmptyEditor">
                    <a class="bc-cg-operate jEvokeEditorModal" href="javascript:" data-event-id="ZQ_E05">请选择编辑组</a>
                </p>
                <p class="bc-check-group jSelectedEditor dn">
                    <span class="bc-cg-txt mr24"></span>
                    <a class="bc-cg-operate jEvokeEditorModal" href="javascript:" data-event-id="ZQ_E08">更换</a>
                </p>
                <input class="dn" name="editorGroup" />
                <p class="input-caution">作品选择编辑组</p>
            </div>
        </div>
    </div>
    <div class="write-form-li" id="pagemessFormLi">
        <label class="write-form-label">给读者的话</label>
        <div class="write-form-cell">
            <div class="write-input">
                <div class="ui-textarea j-check">
                    <textarea rows="4" placeholder="在阅文旗下产品阅读我的正版授权作品，感谢您的支持！" name="pagemess"></textarea>
                    <em class="icon-font input-vertified icon_check_circle">&#xe90b;</em>
                </div>
                <p class="input-caution">0～32字，给读者的话将展示在您作品的版权页</p>
                <p class="input-error"></p>
            </div>
        </div>
    </div>
</script>
<script type="text/template" id="formFooter">
    <div class="write-form-li write-form-button">
        <label class="write-form-label"></label>
        <button class="ui-button ui-large ui-button-primary jSubmit" type="button">创建作品</button>
        <button class="ui-button ui-large jPrev" type="button">返回上一步</button>
    </div>
</script>

<script>
var isshortstory = true;
var pageid = isshortstory ? 'ZQ_short_book_create_new' : 'ZQ_book_create_new';
</script>
<script>
    (function(pro){
        function mytrim() {
            return this.replace(/(^\s*)|(\s*$)/g, "");
        }
        if (!pro.trim) {
            pro.trim = mytrim;
        }
    })(String.prototype);
</script>
<script>

    var root = "";

    var infoUrl = "/ccauthorweb/novel/getInfoWhenNewNovel";
    var bookTitleCheckUrl = "/ccauthorweb/novel/booktitlecheck";
    var actarticleInfoListUrl = "/ccauthorweb/novel/getarticlelist";
    var createBookUrl = "/ccauthorweb/novel/createnovel";
    var editorGroupUrl = "/ccauthorweb/novel/getnovelgrouplist";
    function ajax(option, successCb, failCb) {
        option.dataType = 'json';
        option.contentType = "application/json";
        option.success = function(res) {
            if (res.returnCode === 2000) {
            if (successCb) {
                successCb(res);
                return;
            }
            return;
            }
            if (failCb) {
            failCb({message: res.returnMsg});
            }
        }
        option.error = function(err) {
            if (failCb) {
            failCb({message: "网络错误请重试"});
            }
        }
        if (option.data && option.method === "POST") {
            option.data = JSON.stringify(option.data)
        }
        $.ajax(option);
    }
    function getInfoAjax(data, successCb, failCb) {
        data.t = Date.now();
        ajax({
          url: root + infoUrl,
          data: data,
          method: 'GET'
        }, successCb, failCb);
    }
    function getactarticleInfoListAjax(data, successCb, failCb) {
        ajax({
          url: root + actarticleInfoListUrl,
          data: data,
          method: 'POST'
        }, successCb, failCb);
    }
    function createBookAjax(data, successCb, failCb) {
        ajax({
          url: root + createBookUrl,
          data: data,
          method: 'POST'
        }, successCb, failCb);
    }
    function getEditorGroupAjax(site, categoryid, successCb, failCb) {
        ajax({
          url: root + editorGroupUrl + "?site=" + site + "&categoryid=" + categoryid + "&t=" + Date.now(),
          method: 'GET'
        }, successCb, failCb);
    }
</script>
<script>
    jQuery.validator.addMethod("bookTitleCheck", function(value, element) {
        return this.optional(element) || /^[A-Za-z0-9\u4E00-\u9fa5]{1,15}$/.test(value);
    }, "作品名15字以内，不能有特殊字符");
    jQuery.validator.addMethod("byteRangeLengthByOne", function(value, element, param) {
        value = value.replace(/\r\n/ig, "");
        value = value.replace(/\s+/g, '');
        var length = value.length;
        return this.optional(element) || (length >= param[0] && length <= param[1]);
    }, "请确保输入的值在20-500个字节之间(一个中文字算1个字节)");
</script>
<script>
(function(){


    $(document).ready(function(){
        dataReport({
            pageid: pageid,
            eventid: 'ZQ_E01',
            cauthorid: yconfig.ttd
        });
    });

    var step = 1;
    var insubmitting = false;
    var isPresetAct = $("#presetAct").length > 0;

    $("input[name=sex]").on("change", function(){
        var _eid = this.value == 1 ? 'ZQ_E02' : 'ZQ_E03';
        dataReport({
            pageid: pageid,
            eventid: _eid,
            cauthorid: yconfig.ttd
        });
        $("#step1Form .ui-button-primary").removeClass("disabled");
    });

    function nextStep() {
        step++;
        $(".wc-progress")
            .removeClass()
            .addClass("wc-progress")
            .addClass("_step" + step);
        $(".wc-step").addClass("dn");
        $("#step" + step + "Form").removeClass("dn");
    }
    function prevStep() {
        if (step <= 1) {
            return;
        }
        step--;
        $(".wc-progress")
            .removeClass()
            .addClass("wc-progress")
            .addClass("_step" + step);
        $(".wc-step").addClass("dn");
        $("#step" + step + "Form").removeClass("dn");
    }

    function getSelectedFreetype() {
        var selected = $("input[name=sex]:checked");
        if (selected.length <= 0) {
            return undefined;
        }
        return selected.val();
    }

    function getSelectedValue(name) {
        var selected = $("input[name=" + name + "]:checked");
        if (selected.length <= 0) {
            return undefined;
        }
        return selected.val();
    }

    function renderSiteSelection(sites) {
        var t = _.template($("#siteSelectTpl").html());
        var _html = t({data: sites});
        return _html;
    }

    function renderCatSelection(categories, selectedID) {
        var t = _.template($("#catSelectTpl").html());
        var _html = t({data: categories, selectedID: selectedID});
        return _html;
    }

    function renderShortStoryCatSelection(categories) {
        var t = _.template($("#shortStoryCatSelectTpl").html());
        var _html = t({data: categories});
        return _html;
    }

    function renderActarticle(actarticles) {
        var t = _.template($("#actarticleSelectTpl").html());
        return t({data: actarticles});
    }

    function renderPrecollection(canCreatePrecollection) {
        var t = _.template($("#precollectionSelectTpl").html());
        return t({data: canCreatePrecollection});
    }

    function refreshForm(info, freetype) {
        var formHtml = "<form>";
        formHtml += renderSiteSelection(info.siteVOS);
        formHtml += $("#nameInputTpl").html();
        if (isshortstory) {
            formHtml += renderShortStoryCatSelection(info.categoryVos);
        } else {
            formHtml += renderCatSelection(info.categoryVos);
        }

        if (isPresetAct) {
            formHtml += $("#presetAct").html();
        } else {
            formHtml += $("#actarticleSelectTpl").html();
            formHtml += $("#actExtSelectTpl").html();
        }

        formHtml += renderPrecollection(info.canCreatePrecollection);
        formHtml += $("#saletypeTpl").html();
        formHtml += $("#introInputTpl").html();
        formHtml += $("#pagemessTpl").html();
        formHtml += $("#formFooter").html();
        formHtml += "</form>";
        $("#step2Form").html(formHtml);

        $("#saletypeFormLi").addClass("dn");
        $("#saletypeFormLi input").addClass("form-ignore");

        $("#step2Form textarea[name=pagemess]").attr("placeholder", info.randomPageMess);

        $("select").each(function() {
            new Select($(this));
        });
        new Tips($('.jsThemeTips'), {
            align: 'reverse',
            theme: 'white'
        });
        bindPrev();
        catChange();
        subcatChange();
        siteChange();
        validateForm();
        pagemessFocus();
        bindPrecollectionChange();
    }

    function validateFreetype(cb) {
        var freetype = getSelectedFreetype();
        var result = true;
        if (freetype === undefined) {
            if (cb) {
                new Dialog().alert('<h6>请选择目标读者</h6>', {
                    buttons: [{ value: "我知道了" }]
                });
                cb(true, {freetype: freetype});
            }
            return;
        }

        var reqData = {
            freetype: freetype,
            isshortstory: isshortstory
        };
        if (isPresetAct) {
            reqData.actarticleidx = $("#presetAct").attr("data-actidx");
        }
        getInfoAjax(reqData, function(res) {
            window._allInfo = res.result;
            refreshForm(res.result, freetype);
            if (cb) {
                cb(false, {});
            }
        }, function() {
            window.$.lightTip.error("获取信息失败");
        });
    }

    function submit(cb) {
        var beh = undefined;
        switch(step) {
            case 1:
                beh = validateFreetype;
                break;
            case 2:
                beh = validateForm;
                break;
            default:
                beh = undefined;
        }
        if (beh) {
            beh(cb);
        }
    }

    $(".jNext").on("click", function() {
        dataReport({
            pageid: pageid,
            eventid: 'ZQ_E04',
            cauthorid: yconfig.ttd
        });
        var $this = $(this);
        if ($this.hasClass("disabled")) {
            return;
        }
        submit(function(err, data) {
            if (err) {
                return;
            }
            nextStep();
        });
    });

    function bindPrev() {
        $(".jPrev").on("click", function() {
            dataReport({
                pageid: pageid,
                eventid: 'ZQ_E07',
                cauthorid: yconfig.ttd
            });
            var $this = $(this);
            if ($this.hasClass("disabled")) {
                return;
            }
            prevStep();
        });
    }

    function getCategoryInfo(key) {
        var categoryVos = _allInfo.categoryVos;
        var cat;
        for (var i = 0; i < categoryVos.length; i++) {
            if (categoryVos[i].categoryid == key) {
                return categoryVos[i]
            }
        }
        return;
    }

    function catChange() {
        $("#catSelect").change(function() {
            var value = $("#catSelect option:checked").val();

            if (value){
                unhighlight($("#catSelect"));
                $("#catSelect").siblings().removeClass("error");
            }

            var cat = getCategoryInfo(value);
            var options = cat.subcategoryList;
            var optionHtml = "";
            for(var i = 0; i < options.length; i++) {
                var option = options[i];
                optionHtml += "<option value='" + option.subcategoryid + "'>" + option.subcategoryname + "</option>";
            }
            $("#subcatSelect").html(optionHtml);
            $("#subcatSelect").refresh();

            unhighlight($("#subcatSelect"));
            $("#subcatSelect").siblings().removeClass("error");

            $("#catFormLi .input-caution").text(cat.categorydesc);

            if (!isPresetAct) {
                getactarticleInfoList();
            }
            refreshEditorGroup();
        });
    }

    function subcatChange() {
        $("#subcatSelect").on("change", function() {
            unhighlight($("#subcatSelect"));
            $("#subcatSelect").siblings().removeClass("error");

            if (!isPresetAct) {
                getactarticleInfoList();
            }
        });
    }

    function pagemessFocus() {
        $("textarea[name=pagemess]").on("focus", function() {
            if (!this.value || !this.value.trim()) {
                $(this).val(_allInfo.randomPageMess);
            }
        });
    }

    function bindPrecollectionChange() {
        $("input[name=precollection]").change(function() {
            introValidChange();
        });
    }

    function showPrecollection() {
        if (!$("#precollectionFormLi").hasClass("dn")) {
            return;
        }
        $("#precollectionFormLi").removeClass("dn");
    }

    function hidePrecollection() {
        if ($("#precollectionFormLi").hasClass("dn")) {
            return;
        }
        $("#precollectionFormLi").addClass("dn");
    }

    function introValidChange() {
        var preShow = !$("#precollectionFormLi").hasClass("dn");
        var preValue = getSelectedValue("precollection");

        var rule1 = {
            required: true,
            byteRangeLengthByOne: [20, 500],
            messages: {
                required: "请填写作品介绍",
                byteRangeLengthByOne: "请输入20-500字介绍您的作品"
            }
        };

        var rule2 = {
            required: true,
            byteRangeLengthByOne: [20, 1000],
            messages: {
                required: "请填写作品介绍",
                byteRangeLengthByOne: "请输入20-1000字介绍您的作品"
            }
        };


        if (preShow && preValue == 1) {
            $("#introFormLi .input-caution").text("20~1000字");
            $("textarea[name=intro]").rules("remove");
            $("textarea[name=intro]").rules("add", rule2);
        } else {
            $("#introFormLi .input-caution").text("20~500字");
            $("textarea[name=intro]").rules("remove");
            $("textarea[name=intro]").rules("add", rule1);
        }
    }

    function showHidePrecollection(site) {
        var precollectionSite = _allInfo.precollectionSite;
        var show = false;
        for (var i = 0; i < precollectionSite.length; i++) {
            if (precollectionSite[i] == site) {
                show = true;
                break;
            }
        }
        show ? showPrecollection() : hidePrecollection();
    }

    function showHideSaleType(site) {
        var show = site == 2 || site == 22 || site == 23;
        if (show) {
            $("#saletypeFormLi").removeClass("dn");
            $("#saletypeFormLi input").removeClass("form-ignore");
        } else {
            $("#saletypeFormLi").addClass("dn");
            $("#saletypeFormLi input").addClass("form-ignore");
        }
    }

    function chooseEditorGroup(id) {
        var editorInfo;

        for (var i = 0; i < _allInfo.editorGroupInfoList.length; i++) {
            if (_allInfo.editorGroupInfoList[i].novelgroup == id) {
                editorInfo = _allInfo.editorGroupInfoList[i];
                break;
            }
        }

        if (!editorInfo) {
            return;
        }
        $("#editorGroupFormLi .jEmptyEditor").addClass("dn");
        $("#editorGroupFormLi .jSelectedEditor").removeClass("dn");
        $("#editorGroupFormLi .jSelectedEditor span").text(editorInfo.novelgroupname);
        $("input[name=editorGroup]").val(id);
    }

    function refreshEditorGroup() {
        var site = getSelectedValue("site");
        var categoryid = $("#catSelect").val();

        if (!site || !categoryid) {
            return;
        }

        $("#editorGroupFormLi .jEmptyEditor").addClass("dn");
        $("#editorGroupFormLi .jSelectedEditor").addClass("dn");
        $("input[name=editorGroup]").val("");

        _allInfo.editorGroupInfoList = [];
        getEditorGroupAjax(site, categoryid, function(res) {
            if (!res.result) {
                _allInfo.editorGroupInfoList = [];
                $("#editorGroupFormLi .jSelectedEditor").addClass("dn");
                $("#editorGroupFormLi .jEmptyEditor").removeClass("dn");
                return;
            }

            var editorGroupInfoList = _allInfo.editorGroupInfoList = res.result.novelGroupVOS;
            var lastNovelGroup = _allInfo.lastNovelGroup = res.result.lastNovelGroup;
            var lastNovelGroupInfo;

            for (var i = 0; i < _allInfo.editorGroupInfoList.length; i++) {
                if (editorGroupInfoList[i].novelgroup == lastNovelGroup) {
                    lastNovelGroupInfo = editorGroupInfoList[i];
                    break;
                }
            }

            if (lastNovelGroupInfo) {
                chooseEditorGroup(lastNovelGroupInfo.novelgroup);
                unhighlight($("input[name=editorGroup]"));
                return;
            }

            if (_allInfo.editorGroupInfoList.length === 1) {
                chooseEditorGroup(_allInfo.editorGroupInfoList[0].novelgroup);
                unhighlight($("input[name=editorGroup]"));
                return;
            }

            $("#editorGroupFormLi .jSelectedEditor").addClass("dn");
            $("#editorGroupFormLi .jEmptyEditor").removeClass("dn");
        }, function() {
            _allInfo.editorGroupInfoList = [];
        });
    }

    function evokeEditorModal() {
        dataReport({
            pageid: pageid,
            eventid: $(this).attr("data-event-id"),
            cauthorid: yconfig.ttd
        });
        var site = getSelectedValue("site");
        var categoryid = $("select[name=category]").val();
        if (!site || !categoryid) {
            $.lightTip.error("请先填写发布平台及作品分类");
            return;
        }
        if (!_allInfo.editorGroupInfoList || !_allInfo.editorGroupInfoList.length) {
            $.lightTip.error("信息错误，请联系客服");
            return;
        }

        var _html = _.template($("#editorGroupTpl").html())({data: _allInfo.editorGroupInfoList});
        var button1 = {
            value: '确定',
            events: function(e) {
                var editorId = $(".editor-select-body li.current").attr("data-id");

                chooseEditorGroup(editorId);
                unhighlight($("input[name=editorGroup]"));
                e.data.dialog.remove();
            }
        };
        var button2 = {
            value: '跳过，随机分配',
            type: 'secondary',
            events: function(e) {
                dataReport({
                    pageid: 'ZQ_editor_group_select',
                    eventid: 'ZQ_E01',
                    cauthorid: yconfig.ttd
                });
                var randomIndex = Math.floor(Math.random() * _allInfo.editorGroupInfoList.length);
                var randomG = _allInfo.editorGroupInfoList[randomIndex];
                chooseEditorGroup(randomG.novelgroup);
                unhighlight($("input[name=editorGroup]"));
                e.data.dialog.remove();
            }
        }
        var buttons = [];
        if (_allInfo.editorGroupInfoList.length > 1) {
            buttons = [button1, button2];
        } else {
            buttons = [button1];
        }
        var tagDialog = new Dialog({
            title: '当前可选的编辑组有',
            content: _html,
            // >=6个宽度为816，=<7个宽度为504
            width: _allInfo.editorGroupInfoList.length > 6 ? 816 : 504,
            buttons: buttons,
            onShow: function(){
                var self = this;
                var selectedEditorId = $("input[name=editorGroup]").val();
                var selectedLi = $(".bc-ec-li[data-id=" + selectedEditorId + "]");

                this.el.button0.addClass("disabled");
                if (selectedLi.length === 1) {
                    selectedLi.addClass("current");
                    self.el.button0.removeClass("disabled");
                }

                $(".bc-ec-li").each(function() {
                    var txtBlock = $(this).find(".bc-ec-txt");
                    if (txtBlock[0].scrollHeight > txtBlock.height()) {
                        $(this).find(".editor-more-info").attr("style", "");
                    } else {
                        $(this).find(".editor-more-info").attr("style", "display:none");
                    }
                });

                $('.j-select').on('click', 'li', function () {
                    $(this).addClass('current').siblings().removeClass('current');
                    self.el.button0.removeClass("disabled");
                });
            }
        })
        tagDialog.el.dialog.addClass("editor-select-body");

        // 点击展示编辑分组详情--js-editor-more
        $(".js-editor-more").on("click", function(e) {
            e.stopPropagation();
            var title = $(this).parent().find(".bc-ec-title").html();
            var content = $(this).parent().find(".bc-ec-txt").html();
            var diaEditorMore =  new Dialog({
                title: title,
                width: 504,
                content: content,
                buttons: [{
                    value: '我知道了'
                }]
            })
            diaEditorMore.el.body.css('white-space','pre-line');
        });

    }


    $("#step2Form").delegate('.jEvokeEditorModal', 'click', evokeEditorModal);

    function getactarticleInfoList() {
        var data = {};
        data.site = getSelectedValue("site");
        data.categoryid = $("#catSelect").val();
        data.subcategoryid = $("#subcatSelect").val();
        data.limittype = 1;

        if (!data.site || !data.categoryid || !data.subcategoryid) {
            $("#actarticleFormLi").addClass("dn");
            $("#actextFormLi").addClass("dn");
            $("#actextFormLi input").addClass("form-ignore");
            return;
        }

        getactarticleInfoListAjax(data, function(res) {
            _allInfo.actarticleInfoList = res.result;
            if (!_allInfo.actarticleInfoList || _allInfo.actarticleInfoList.length === 0) {
                $("#actarticleFormLi").addClass("dn");
                $("#actextFormLi").addClass("dn");
                $("#actextFormLi input").addClass("form-ignore");
                return;
            }

            var t = _.template($("#actarticleOptionTpl").html());
            var data = _allInfo.actarticleInfoList;

            var _html = $("#actarticleEmptyOptionTpl").html();
            _html += t({data: data});
            $("#actarticleFormLi .write-input").html(_html);
            $("#actarticleFormLi #act0").attr("checked", "");

            actChange();
            $("#actarticleFormLi").removeClass("dn");
            $("#actextFormLi").addClass("dn");
            $("#actextFormLi input").addClass("form-ignore");

        });
    }

    function actChange() {
        $("input[name=actarticle]").change(function() {
            if (!_allInfo.actarticleInfoList || _allInfo.actarticleInfoList.length === 0) {
                $("#actarticleFormLi").addClass("dn");
                $("#actarticleFormLi input").addClass("form-ignore");
                return;
            }

            var actarticleInfo;
            for (var i = 0; i < _allInfo.actarticleInfoList.length; i++) {
                var _info = _allInfo.actarticleInfoList[i];
                if (_info.iActArticle.idx == this.value) {
                    actarticleInfo = _allInfo.actarticleInfoList[i];
                    break;
                }
            }
            renderActext(actarticleInfo);
        });
    }

    function renderActext(actarticleInfo) {
        if (!actarticleInfo || !actarticleInfo.iActArticleExt || actarticleInfo.iActArticleExt.length === 0) {
            $("#actextFormLi").addClass("dn");
            $("#actextFormLi input").addClass("form-ignore");
            return;
        }

        var t = _.template($("#actExtOptionTpl").html());
        var _html = t({data: actarticleInfo.iActArticleExt});
        _html += "<p class='input-error'>请选择赛区</p>";
        $("#actextFormLi .write-input").html(_html);
        $("#actextFormLi").removeClass("dn");
        if (actarticleInfo.iActArticleExt && actarticleInfo.iActArticleExt.length > 0) {
            $("#actextFormLi input").removeClass("form-ignore");
        }
    }

    function siteCatChange(site) {
        var catList = [];
        for (var i = 0; i <_allInfo.categoryVos.length; i++) {
            var _cat = _allInfo.categoryVos[i];
            if ((site == 2 || site == 3) && _cat.categoryid == 30078) {
                continue;
            }
            catList.push(_cat);
        }
        var _html = "<option></option>";
        for (var i = 0; i < catList.length; i++) {
            var _cat = catList[i];
            _html += "\n<option value=\"" + _cat.categoryid + "\"";
            if (_cat.categoryid === $("select[name=category]").val()) {
                _html += " selected";
            }
            _html += ">" + _cat.categoryname + "</option>";
        }
        $("#catSelect").html(_html);
        $("#catSelect").refresh();

        if (!$("select[name=category]").val()) {
            $("#subcatSelect").html("<option></option>");
            $("#subcatSelect").refresh();
        }
    }

    function siteChange() {
        $("input[name=site]").change(function() {
            showHidePrecollection(this.value);
            showHideSaleType(this.value);
            siteCatChange(this.value);
            introValidChange();

            if (this.value == 22) {
                $("#pagemessFormLi").addClass("dn");
                $("#pagemessFormLi textarea").addClass("form-ignore");
            } else {
                $("#pagemessFormLi").removeClass("dn");
                $("#pagemessFormLi textarea").removeClass("form-ignore");
            }

            if (!isPresetAct) {
                getactarticleInfoList();
            }
            refreshEditorGroup();
        });
    }

    function addError(error, element) {
        element.parents(".write-input").addClass("_error");
        element.parents(".j-check").removeClass("_check");
        element.parents(".write-form-li").find(".input-error").text(error.text());
    }

    function unhighlight(element) {
        element.removeClass("error");
        element.parents(".write-input").removeClass("_error");
        element.parents(".j-check").addClass("_check");
    }

    function handleSubmit(form) {
        dataReport({
            pageid: pageid,
            eventid: 'ZQ_E06',
            cauthorid: yconfig.ttd
        });
        if (insubmitting) {
            return;
        }
        var data = {};
        data.freetype = getSelectedFreetype();
        data.site = getSelectedValue("site");;
        data.title = $("input[name=title]").val();
        data.categoryid = $("select[name=category]").val();
        data.subcategoryid = $("select[name=subcategory]").val();
        data.intro = $("textarea[name=intro]").val();
        data.novelgroup = $("input[name=editorGroup]").val();

        if (!$("#precollectionFormLi").hasClass("dn")) {
            data.isprecollection = getSelectedValue("precollection");
        }

        if (!$("#saletypeFormLi").hasClass("dn")) {
            data.saletype = getSelectedValue("saletype");
        }

        if (!$("#actarticleFormLi").hasClass("dn")) {
            var selectedArtidx = getSelectedValue("actarticle");
            if (selectedArtidx && selectedArtidx != 0) {
                data.artidx = selectedArtidx;
            }
        }

        if ($("#actextFormLi").length > 0 && !$("#actextFormLi").hasClass("dn")) {
            var selectedArtextidx = getSelectedValue("artext");
            if (selectedArtextidx && selectedArtextidx != 0) {
                data.artextidx = selectedArtextidx;
            }
        }

        if (!$("#pagemessFormLi").hasClass("dn")) {
            data.pagemess = $("textarea[name=pagemess]").val();
        }

        insubmitting = true;
        $(".jSubmit").addClass("loading");
        $(".jPrev").addClass("disabled");
        createBookAjax(data, function(res) {
            insubmitting = false;
            $(".jSubmit").removeClass("loading");
            $(".jPrev").removeClass("disabled");
            $("#step3Form a").attr("href", "/portal/booknovels/chaptertmp/CBID/" + res.result.cbid);
            nextStep();
        }, function(err) {
            insubmitting = false;
            $(".jSubmit").removeClass("loading");
            $(".jPrev").removeClass("disabled");
            $.lightTip.error(err.message);
        });
    }

    function validateForm() {
        $("#step2Form form").validate({
            ignore:".form-ignore",
            rules: {
                site: {
                    required: true
                },
                title: {
                    required: true,
                    bookTitleCheck: true,
                    remote: {
                        url: root + bookTitleCheckUrl,
                        dataType: 'json',
                        headers: {
                            'Cache-Control': 'no-cache',
                            'Pragma': 'no-cache'
                        },
                        data: {
                            title: function() {
                                return $( "input[name=title]" ).val();
                            }
                        },
                        dataFilter: function(resString) {
                            if (resString.indexOf('false') > -1 || resString.indexOf('2000') < 0) {
                                return 'false';
                            }
                            return 'true';
                        }
                    }
                },
                category: {
                    required: true
                },
                subcategory: {
                    required: true
                },
                intro: {
                    required: true,
                    byteRangeLengthByOne: [20, 500]
                },
                editorGroup: {
                    required: true
                },
                pagemess: {
                    byteRangeLengthByOne: [0, 32]
                },
                saletype: {
                    required: true
                },
                artext: {
                    required: true
                }
            },
            messages: {
                site: {
                    required: "请选择发布平台"
                },
                title: {
                    required: "请输入作品名",
                    bookTitleCheck: "15字以内，请勿添加书名号等特殊符号",
                    remote: "这本大作已经有人写过了，再想个名字吧！"
                },
                category: {
                    required: "请选择作品类别"
                },
                subcategory: {
                    required: "请选择作品类别"
                },
                intro: {
                    required: "请填写作品介绍",
                    byteRangeLengthByOne: "请输入20-500字介绍您的作品"
                },
                editorGroup: {
                    required: "请选择编辑组"
                },
                pagemess: {
                    byteRangeLengthByOne: "请输入32个字以内的内容"
                },
                saletype: {
                    required: "请选择销售意向"
                },
                artext: {
                    required: "请选择赛区"
                }
            },
            errorPlacement: function(error, element) {
                addError(error, element);
            },
            unhighlight: function(element) {
                var $element = $(element);
                unhighlight($element);
            }
        });
        $("#step2Form form .ui-button-primary").on("click", function() {
            if ($("#step2Form form").valid()) {
                handleSubmit();
            }
            return false;
        });
    }



})();
</script>

    <script>
      window.yconfig = {
        isLogin: true,
        ttd: '17752236906517001'
      }
    </script>
    <script type="text/javascript">
      var _mtac = {
        "performanceMonitor": 1
      };
      (function () {
        var mta = document.createElement("script");
        mta.src = "//pingjs.qq.com/h5/stats.js?v2.0.4";
        mta.setAttribute("name", "MTAH5");
        mta.setAttribute("sid", "500659219");
        mta.setAttribute("cid", "500664628");
        var s = document.getElementsByTagName("script")[0];
        s
          .parentNode
          .insertBefore(mta, s);
      })();
    </script>


</body></html>