!function(){"use strict";function n(e){return e.toString(36)}function a(){var t;try{var e=new Uint32Array(1);o.crypto.getRandomValues(e),t=2147483647&e[0]}catch(e){t=Math.floor(2147483648*Math.random())}return t}var e=window.parent!=window,o=window,s=o.document,r=function(e){var t=o.navigator.userAgent+(s.cookie?s.cookie:"")+(s.referrer?s.referrer:"")+o.location.href,i=n(a()^2147483647&function(e){var t=1;if(e){var i=0;t=0;for(var n=e.length-1;0<=n;n--)t=(t<<6&268435455)+(i=e.charCodeAt(n))+(i<<14),t=0!=(i=266338304&t)?t^i>>21:t}return t}(t))+"."+n(a())+"."+n(+new Date);return e?"QD."+i:i};var T={MAX_POST_LIMIT:{LENGTH:4500,TIP_TEXT:"chat_max_post_limit_text"},VIEW_OPTS:{POST_MAX_ROW:3,TIME_INTERVAL:12e4,HISTORY_MSG:{PER_NUM:10,GET_MSG:"chat_history_msg_get_text",LOADING:"chat_history_msg_loading_text",GET_MSG_ERROR:"chat_history_msg_get_error"},OFFLINE_MSG:{LOADING:"chat_offline_msg_loading_text",FAIL:"chat_offline_msg_fail_text",OVER:"chat_offline_msg_over_text"},MENU_MSG:{LOADING:"chat_menu_msg_loading_text",FAIL:"chat_menu_msg_fail_text"}},CGI_URL:{SOCKET_CHAT:"https://"+__domain.chat+".qidian.qq.com",STATUS_MANAGER:"https://webpage.qidian.qq.com/qidian/chatClient/release/status/js/report-f3afb2c93.js",QQ_FACE:"https://"+__domain.source+".com/qidian/chatClient/release/comp/img/qq/",GET_SIGT:"https://"+__domain.admin+".qidian.qq.com/webim/webImLogin/getSigT",GET_TENCENT_SCHEME:"https://"+__domain.admin+".qidian.qq.com/tp/wpaCall/getWebProtocol",UPLOAD_IMG:"https://"+__domain.admin+".qidian.qq.com/webim/pic/upload",ROUTE_CHANGE_LOADING:{QQ:"https://"+__domain.admin+".qidian.qq.com/template/blue/wpa/link.html"},GET_GRAPHIC_MSG:"https://"+__domain.admin+".qidian.qq.com/webim/innerPage/getGraphicMsg",GET_OFFLINE_MSG:"https://"+__domain.admin+".qidian.qq.com/webim/offlineMessage/getMessages",COMP_SOURCE_URL:"https://"+__domain.source+".com/qidian/chatClient/release/comp/",GET_MENU_URL:"https://"+__domain.admin+".qidian.qq.com/webim/innerPage/getNav",GET_FEEDBACK_RET:"https://"+__domain.admin+".qidian.qq.com/webim/innerPage/feedBack",ACT_RPT:"https://"+__domain.admin+".qidian.qq.com/ar/ActCap/ActRpt",GET_SERVER_TIME:"https://"+__domain.admin+".qidian.qq.com/webim/commonRequest/checkTime",GET_ADD_FRIEND_SCHEME:"https://"+__domain.admin+".qidian.qq.com/tp/wpaCall/GetAddFriendProtocol",COMMON_REQ_RPT:"https://"+__domain.admin+".qidian.qq.com/webim/commonRequest/actRpt",GET_RELATED_MESSAGE:"https://"+__domain.admin+".qidian.qq.com/webim/complete/question",ROBOT_SATISFACTION_REPORT:"https://"+__domain.admin+".qidian.qq.com/cl/robotSatisfaction/robotReport",GET_WX_MP_OPENID:"https://"+__domain.admin+".qidian.qq.com/webim/wx/getMpOpenId",CHECK_WX_VISITORID:"https://"+__domain.admin+".qidian.qq.com/webim/wx/checkVisitorId",CHECK_THIRD_VISITORID:"https://"+__domain.admin+".qidian.qq.com/webim/nonAnonymous/getVisitorId",GET_WX_MP_JSSDK_SIGNATURE:"https://"+__domain.admin+".qidian.qq.com/webim/wx/getSignature",GET_WX_MP_JSSDK_SOURCE:"https://res.wx.qq.com/open/js/jweixin-1.4.0.js",GET_SKIN_CORP_INFO:"https://"+__domain.admin+".qidian.qq.com/webim/innerPage/getPCIMInfo",GET_RECEPTION_DETAIL:"https://"+__domain.admin+".qidian.qq.com/webim/innerPage/getEmployeeInfo",GET_LEAVE_MSG_CONFIG:"https://"+__domain.admin+".qidian.qq.com/reception/leaveMessage/customerMessageConfig",SEND_LEAVE_MSG_FORM:"https://"+__domain.admin+".qidian.qq.com/reception/leaveMessage/customerMessageCreate",TEXT_TRANSLATE:"https://"+__domain.admin+".qidian.qq.com/ts/translate/textTranslate",TRANSLATE_LANG_CHANGE:"https://"+__domain.admin+".qidian.qq.com/webim/commonRequest/setTranslateLang",GET_ROAMING_LIST:"https://"+__domain.admin+".qidian.qq.com/webim/roam/getMessage",GET_MSG_INFO_DATA:"https://"+__domain.admin+".qidian.qq.com/webim/innerPage/getXmlMsgData",GET_BUSINESS_CARD_DATA:"https://"+__domain.admin+".qidian.qq.com/webim/innerPage/fetchBusinessCard"},SOCKET_OPTS:{OPTS:{path:"/session",reconnectionDelay:1e4,reconnectionDelayMax:2e4,reconnectionAttempts:2,timeout:2e4,transports:["websocket"]},C2B_TIMEOUT:6e4,SIGT_TIMEOUT:6e4,REG_TIMEOUT:6e4,SEQ_RANGE:{C2B_FOR_PHP:2147483647,C2B_FOR_PC:65535},CLIENT_PING_DELAY:2e4},IMG_UPLOAD_OPTS:{MAX_SUM:9,MAX_SIZE:2097152,MAX_WIDTH:540,MAX_HEIGHT:960,JPG_COMPRESS_RATIO:60,ACCEPT_TYPE:["image/jpeg","image/jpg","image/bmp","image/png","image/gif"],ACCEPT_TYPE_SWFUPLOAD:"gif,jpg,jpeg,bmp,png"},MSG_DB_OPTS:{NAME:"Qidian WebIM History Message Database",CURRENT_VERSION:3},FB_OPTS:{levelDesc:["$$$chat_feedback_very_dissatisfied_text$$$","$$$chat_feedback_dissatisfied_text$$$","$$$chat_feedback_neutral_text$$$","$$$chat_feedback_satisfied_text$$$","$$$chat_feedback_very_satisfied_text$$$"],availLetterSum:60,delayTime:500},HEADER_TPL:{BTN_BACK:'<a href="javascript:;" class="btn-back"><svg><use xlink:href="#back"/></svg></a>',H5:{BTN_CALL_QQ:'<a href="javascript:;" class="btn-callqq" reqpos="0"><svg><use xlink:href="#qq"/></svg></a>',BTN_LANG_SETTING:'<a href="javascript:;" class="btn-lang-setting" reqpos="1"><svg><use xlink:href="#setting"/></svg></a>'},PC:{BTN_CALL_QQ:'<a href="javascript:;" class="btn-callqq" reqpos="0"><i class="icon-qq"></i></a>',BTN_LANG_SETTING:'<a href="javascript:;" class="btn-lang-setting" reqpos="1"><i class="icon-lang-setting"></i></a>'}},SYS_MSG:{sessionEnd:"sysmsg_session_end_msg",disconnect:"sysmsg_disconnect_msg",changeKf:"sysmsg_change_kf_msg",reReg:"sysmsg_rereg_msg",connect:"sysmsg_connect_msg",connecting:"sysmsg_connecting_msg",connectError:"sysmsg_connect_error_msg",reconnectError:"sysmsg_reconnect_error_msg",reconnectIng:"sysmsg_reconnecting_msg",reconnectFail:"sysmsg_reconnect_fail_msg",callqq:"sysmsg_callqq_msg",callqqCorpUin:"sysmsg_callqq_corpuin_msg",sigTtimeOut:"sysmsg_get_sigt_timeout_msg",regTimeout:"sysmsg_reg_timeout_msg",regSuccess:"sysmsg_reg_success_msg",retStart:"sysmsg_reg_start_msg",startGetSigT:"sysmsg_get_sigt_msg",sigTfail:"sysmsg_get_sigt_fail_msg",overSumLimit:"sysmsg_upload_image_max",msgExpired:"sysmsg_message_expired_msg",feedBack:"sysmsg_feeback_msg",autoChangeKF:"sysmsg_auto_change_kf_msg",b2cKfChange:"sysmsg_change_b2c_kf_msg",noVisitorId:"sysmsg_no_visitorid_error_msg",addFriendFail:"sysmsg_add_friend_fail_msg",graphicMsgFail:"sysmsg_graphic_msg_fail_msg",revoke:"sysmsg_msg_revoke_msg",currentServiceLang:"sysmsg_msg_current_service_lang",changeServiceLang:"sysmsg_msg_change_service_lang",getThirdVisitorIdError:"sysmsg_msg_get_third_visitor_id_error"},CHAT_MSG_TPL:{tencentCert:'<a href="<%=o.website%>" target="_blank" class="tencent-certification">\n                <img class="tencent-certification__logo" src="<%=o.logo%>" />\n                <span class="tencent-certification__name"><%=o.name%></span>\n            </a>',tencentCertContent:'<img class="tencent-certification__logo" src="<%=o.logo%>" /><span class="tencent-certification__name"><%=o.name%></span>',time:'<div class="msg-time"><%==timeStamp%></div>',sys:'<div class="msg-sys" data-guid="<%=seq%>">\n                    <span class="text"><%==msg%></span>\n                </div>',b2c:'<div class="msg-b2c" data-guid="<%=seq%>"><p class="avatar"><img src="<%=avatar%>"/></p><div class="content"><p class="name"><%=name%></p><div class="bubble"><p class="text"><%==data%></p></div></div></div>',b2cImage:'<div class="msg-b2c msg-image" data-guid="<%=seq%>"><p class="avatar"><img src="<%=avatar%>"/></p><div class="content"><p class="name"><%=name%></p><div class="bubble"><p class="image"><img src="<%=data%>"/><i class="loading loading-s"></i></p></div></div></div>',b2cWrap:'<div class="msg-b2c <%=o.msgType%> <%=o.msgName%>" data-guid="<%=o.seq%>">\n                        <p class="avatar"><img src="<%=o.face || o.avatar%>"/></p>\n                        <div class="content">\n                            <p class="name"><%=o.name%></p>\n                            <div class="bubble">msgContent\n                              <% if(o.vote) { %>\n                              <div class="b2c-content-tails" data-id="<%=o.vote.id%>">\n                                  <% if (o.vote.active) { %>\n                                    <span class="b2c-content-tails-icon active b2c-content-tails-icon-<%= (o.vote.active.index == 0 ? \'up\' : \'down\')%>"><span class="b2c-content-tails-hand"></span></span>\n                                  <% } else {%>\n                                    <% for (var i = 0; i < (o.vote.button && o.vote.button.length); i++) {%>\n                                    <span data-key="<%=o.vote.button[i].key%>" data-index="<%=i%>" class="b2c-content-tails-icon b2c-content-tails-icon-<%= (i === 0 ? \'up\' : \'down\')%>"><span class="b2c-content-tails-hand"></span></span>\n                                    <% } %>\n                                  <% } %>\n                              </div>\n                              <% } %>\n                            </div>\n                        </div>\n                    </div>',c2b:'<div class="msg-c2b" data-guid="<%=seq%>"><div class="bubble" data-style="senderBubble"><i></i><p class="text"><%==data%></p><svg class="bubble-arrow" data-style="bubbleArrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.64 16.95"><path d="M15.63,5.05C11.34,9.36,4.61,10,1.59,10H.86C.34,10,0,10,0,10s0,0,0,0H0V22H3.69C16.56,13.53,15.63,5.05,15.63,5.05Z" transform="translate(0 -5.05)"/></svg></div></div>',c2bImage:'<div class="msg-c2b msg-image" data-guid="<%=seq%>"><div class="bubble" data-style="senderBubble"><i></i><p class="image"><img src="<%=data%>"/></p><svg class="bubble-arrow" data-style="bubbleArrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.64 16.95"><path d="M15.63,5.05C11.34,9.36,4.61,10,1.59,10H.86C.34,10,0,10,0,10s0,0,0,0H0V22H3.69C16.56,13.53,15.63,5.05,15.63,5.05Z" transform="translate(0 -5.05)"/></svg></div></div>',c2bVoice:'<div class="msg-c2b msg-voice <%=expired%>" data-guid="<%=seq%>"><div class="bubble" data-style="senderBubble" style="width: <%=width%>px;"><i></i><span class="duration"><%=duration%>"</span><div class="tip">转文字</div><svg class="bubble-arrow" data-style="bubbleArrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.64 16.95"><path d="M15.63,5.05C11.34,9.36,4.61,10,1.59,10H.86C.34,10,0,10,0,10s0,0,0,0H0V22H3.69C16.56,13.53,15.63,5.05,15.63,5.05Z" transform="translate(0 -5.05)"/></svg></div></div>',c2bVoiceRecording:'<div class="msg-c2b msg-voice msg-voice--recording"><div class="bubble" data-style="senderBubble"><i></i><span class="duration"></span><div class="tip">转文字</div><svg class="bubble-arrow" data-style="bubbleArrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.64 16.95"><path d="M15.63,5.05C11.34,9.36,4.61,10,1.59,10H.86C.34,10,0,10,0,10s0,0,0,0H0V22H3.69C16.56,13.53,15.63,5.05,15.63,5.05Z" transform="translate(0 -5.05)"/></svg></div></div>',c2bWrap:'<div class="msg-c2b <%=o.msgType%> <%=o.msgName%>" data-guid="<%=o.seq%>">\n                    <div class="bubble" data-style="senderBubble">msgContent<svg class="bubble-arrow" data-style="bubbleArrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.64 16.95"><path d="M15.63,5.05C11.34,9.36,4.61,10,1.59,10H.86C.34,10,0,10,0,10s0,0,0,0H0V22H3.69C16.56,13.53,15.63,5.05,15.63,5.05Z" transform="translate(0 -5.05)"/></svg></div>\n                </div>',callqq:'<div class="msg-offline">\n                        <div class="content">\n                            <div class="kf-detail">\n                                <p class="avatar"><img src="<%=avatar%>"/></p>\n                                <dl class="detail">\n                                    <dt><%=name%></dt>\n                                    <dd><%=corpName%><span class="resign"><%=resign%></span></dd>\n                                </dl>\n                            </div>\n                            <a href="javascript:;" class="btn-act" data-style="button" reqpos="1">$$$common_start_qq_chat_text$$$</a>\n                        </div>\n                    </div>',callqqCorpUin:'<div class="msg-offline">\n                            <div class="content">\n                                <div class="kf-detail">\n                                    <p class="avatar"><img src="<%=corpAvatar%>"/></p>\n                                    <dl class="detail">\n                                        <dt><%=corpName%></dt>\n                                    </dl>\n                                </div>\n                                <a href="javascript:;" class="btn-act" data-style="button" reqpos="1">$$$common_start_qq_chat_text$$$</a>\n                            </div>\n                        </div>',msgLoad:{getMsg:'<div class="load-status"><a href="javascript:;" class="btn-load-msg"><%==text%></a></div>',loading:'<div class="load-status"><p class="status-loading"><i class="loading loading-s"></i><span class="text"><%==text%></span></p></div>',overTip:'<p class="status-tip"><span class="text"><%==text%></span></p>',numTip:'<a href="javascript:;" class="btn-offlinemsg-gotop"><%==text%>条新消息<i class="icon-arrow-up"></i></a>'},menuMsgNormal:'<div class="mod-menu <% if(o.config.welcome == 1) { %>wel<% } %><% if(o.config.menu == 1) { %>nav<% } %><% if(o.config.button == 1) { %>btn<% } %>" data-guid="<%=o.guid%>" data-oldver="<% if(o.version >= o.currentVersion) {%>0<%} else {%>1<%}%>">\n                    <div class="menu-wrap"><% if(o.version >= o.currentVersion) { %>\n                        <% if(o.config.welcome == 1 && (o.navVersion == 1 || !o.navVersion)) { %>\n                            <div class="menu-wel">\n                                <div class="tit">\n                                    <dl>\n                                        <dt><img src="<%=o.eLogo%>" width="25" height="25"/></dt>\n                                        <dd><%=o.welcome.tit%></dd>\n                                    </dl>\n                                </div>\n                                <% if(o.config.description == 1 ) { %>\n                                    <p class="text"><%=o.description%></p>\n                                 <% } %>\n                            </div>\n                        <% } %><% if(o.navVersion === \'2\') { %>\n                            <div class="menu-wel menu-wel--v2">\n                                <div class="tit">\n                                    <dl>\n                                        <dt><img src="<%=o.eLogo%>" width="25" height="25"/></dt>\n                                        <dd><%=o.welcome.tit%></dd>\n                                    </dl>\n                                </div>\n                                <% if(o.config.description == 1 ) { %>\n                                    <p class="text"><%=o.description%></p>\n                                 <% } %>\n                            </div>\n                            <% if(o.config.menu === 1) { %>\n                                <div class="menu-nav menu-nav--v2">\n                                    <% for(var i = 0, l = o.menu.list.length;i<l;i++) {\n                                          var replyType = typeof o.menu.list[i].manualType != \'undefined\' ? o.menu.list[i].manualType : o.menu.list[i].replyType;\n                                    %>\n                                    <div class="nav-item">\n                                        <div class="nav-hd">\n                                            <a href="javascript:;" data-action="<%= o.menu.list[i].action%>" data-origin-replytype="<%=o.menu.list[i].replyType %>" data-origin-replytext="<%= o.menu.list[i].replyText %>" data-origin-materialid="<%= o.menu.list[i].materialId %>" data-replytype="<%= replyType %>" data-replydata="<%=o.menu.list[i].serviceKfext || o.menu.list[i].robotId || o.menu.list[i].groupId || o.menu.list[i].replyText || o.menu.list[i].imgurl || o.menu.list[i].url || o.menu.list[i].materialId%>"><span class="text"><%= o.menu.list[i].name%></span> <% if(o.menu.list[i].action == 4 && o.menu.list[i].sublist) { %><i class="icon-arrow-down"><% if(o.isMobile) { %><svg><use xlink:href="#back"/></svg><% } %></i><% } %></a>\n                                        </div><%if(o.menu.list[i].action == 4 && o.menu.list[i].sublist) {%>\n                                        <div class="nav-bd">\n                                            <ul><% for(var k = 0, len = o.menu.list[i].sublist.length;k<len;k++) {\n                                                      var subReplyType = typeof o.menu.list[i].sublist[k].manualType != \'undefined\' ? o.menu.list[i].sublist[k].manualType : o.menu.list[i].sublist[k].replyType;\n                                                %>\n                                                <li><a href="javascript:;" data-action="<%= o.menu.list[i].sublist[k].action%>" data-origin-replytype="<%= o.menu.list[i].sublist[k].replyType %>" data-origin-replytext="<%= o.menu.list[i].sublist[k].replyText %>" data-origin-materialid="<%= o.menu.list[i].sublist[k].materialId %>" data-replytype="<%= subReplyType %>" data-replydata="<%= o.menu.list[i].sublist[k].serviceKfext || o.menu.list[i].sublist[k].robotId || o.menu.list[i].sublist[k].groupId || o.menu.list[i].sublist[k].replyText || o.menu.list[i].sublist[k].imgurl || o.menu.list[i].sublist[k].url || o.menu.list[i].sublist[k].materialId%>"><%= o.menu.list[i].sublist[k].name%></a></li><% } %>\n                                            </ul>\n                                        </div><% } %>\n                                    </div><% } %>\n                                </div>\n                            <% } %>\n                        <% } %><% if(o.config.menu == 1 && (o.navVersion == 1 || !o.navVersion)) { %><div class="menu-nav">\n                            <p class="tit"><%=o.menu.tit%></p>\n                            <% for(var i = 0, l = o.menu.list.length;i<l;i++) {%><div class="nav-item">\n                                <div class="nav-hd">\n                                    <a href="javascript:;" data-action="<%= o.menu.list[i].action%>" data-origin-replytype="<%=o.menu.list[i].replyType %>" data-origin-replytext="<%= o.menu.list[i].replyText %>" data-origin-materialid="<%= o.menu.list[i].materialId %>" data-replytype="<%= o.menu.list[i].manualType || o.menu.list[i].replyType %>" data-replydata="<%=o.menu.list[i].serviceKfext || o.menu.list[i].groupId || o.menu.list[i].replyText || o.menu.list[i].imgurl || o.menu.list[i].url || o.menu.list[i].materialId%>"><span class="text"><%= o.menu.list[i].name%></span> <% if(o.menu.list[i].action == 4 && o.menu.list[i].sublist) { %><i class="icon-arrow-down"><% if(o.isMobile) { %><svg><use xlink:href="#back"/></svg><% } %></i><% } %></a>\n                                </div><% if(o.menu.list[i].action == 4 && o.menu.list[i].sublist) { %>\n                                <div class="nav-bd">\n                                    <ul><% for(var k = 0, len = o.menu.list[i].sublist.length;k<len;k++) {%>\n                                        <li><a href="javascript:;" data-action="<%= o.menu.list[i].sublist[k].action%>" data-origin-replytype="<%= o.menu.list[i].sublist[k].replyType %>" data-origin-replytext="<%= o.menu.list[i].sublist[k].replyText %>" data-origin-materialid="<%= o.menu.list[i].sublist[k].materialId %>" data-replytype="<%= o.menu.list[i].sublist[k].manualType || o.menu.list[i].sublist[k].replyType %>" data-replydata="<%= o.menu.list[i].sublist[k].serviceKfext || o.menu.list[i].sublist[k].robotId || o.menu.list[i].sublist[k].groupId || o.menu.list[i].sublist[k].replyText || o.menu.list[i].sublist[k].imgurl || o.menu.list[i].sublist[k].url || o.menu.list[i].sublist[k].materialId%>"><%= o.menu.list[i].sublist[k].name%></a></li><% } %>\n                                    </ul>\n                                </div><% } %>\n                            </div><% } %>\n                        </div><% } %><% if(o.config.button == 1) { %><div class="menu-action">\n                            <ul><% for(var i = 0, l = o.button.length;i<l;i++) {%>\n                                <li style="width:<%= o.buttonWidth %>%"><a href="javascript:;" data-action="<%= o.button[i].action%>" data-origin-replytype="<%= o.button[i].replyType %>" data-origin-replytext="<%= o.button[i].replyText %>" data-origin-materialid="<%= o.button[i].materialId %>" data-replytype="<%= o.button[i].manualType || o.button[i].replyType %>" data-replydata="<%= o.button[i].serviceKfext || o.button[i].robotId || o.button[i].groupId || o.button[i].replyText || o.button[i].imgurl || o.button[i].url || o.button[i].materialId%>"><%= o.button[i].name%></a></li><% } %>\n                            </ul>\n                        </div><% } %><% } else { %>\n                        <div class="menu-disabled">\n                            <dl>\n                                <dt></dt>\n                                <dd>$$$chat_menu_msg_history_expired_text$$$</dd>\n                            </dl>\n                        </div><% } %>\n                    </div>\n                  </div>',menuMsgExpired:'<div class="menu-disabled">\n                            <dl>\n                                <dt></dt>\n                                <dd>$$$chat_menu_msg_history_expired_text$$$</dd>\n                            </dl>\n                        </div>',feedback:'<div class="mod-fb" data-fbkey=<%= o.fbKey %>>\n                            <div class="fb-wrap">\n                                <p class="tit">$$$chat_feedback_title_text$$$</p>\n                                <div class="fb-level">\n                                    <% for(var i = 0;i < o.levelDesc.length; i++) {%><a href="javascript:;" data-desc="<%= o.levelDesc[i] %>"><i class="fd-icon fd-icon-<%= i %>"></i><span><%= o.levelDesc[i] %></span></a><% } %>\n                                </div><% if(o.hasDesc) {%>\n                                <div class="fb-desc">\n                                    <div class="post-text"><p class="text"></p></div>\n                                    <div class="post-area">\n                                        <textarea maxlength="<%= o.availLetterSum %>" placeholder="$$$chat_feedback_postarea_placeholder$$$"></textarea>\n                                        <span class="num"><%= o.availLetterSum %></span>\n                                    </div>\n                                    <a href="javascript:;" class="btn-submit">$$$chat_feedback_submit_text$$$</a>\n                                </div><% } %>\n                                <button class="fb-loading">$$$chat_feedback_submitting_text$$$</button>\n                            </div>\n                        </div>',blackTip:'<div class="mod-black-tip"><p class="text"><%= o.text %></p></div>',voiceTip:'<div class="mod-voice-tip"><i class="voice-icon <%=o.icon%>"></i><div class="voice-tip"><span><%= o.tip %></span></div></div>',translateTip:'<div class="mod-translate-tip"><i class="translate-icon <%=o.icon%>"></i><div class="translate-tip"><span><%= o.tip %></span></div></div>',receptionInfo:'<div class="mod-desc">\n                            <p class="logo"><img src="<%=o.avatar%>" width="64" height="64" alt="<%=o.name%>" title="<%=o.name%>"/></p>\n                            <p class="name" title="<%=o.name%>"><%=o.name%></p>\n                            <p class="company" title="<%=o.company%>"><%=o.company%></p>\n                            <p class="position" title="<%=o.position%>"><%=o.position%></p>\n                        </div>\n                        <div class="mod-connect">\n                            <ul>\n                                <% if(o.signature) { %><li title="<%=o.signature%>"><i class="icon-signature"></i><%=o.signature%></li><% } %>\n                                <% if(o.phone) { %><li><i class="icon-phone"></i><a href="tel:<%=o.phone%>" title="<%=o.phone%>"><%=o.phone%></a></li><% } %>\n                                <% if(o.fixedPhone) { %><li><i class="icon-tel"></i><a href="tel:<%=o.fixedPhone%>" title="<%=o.fixedPhone%>"><%=o.fixedPhone%></a></li><% } %>\n                                <% if(o.email) { %><li><i class="icon-email"></i><a href="mailto:<%=o.email%>" title="<%=o.email%>"><%=o.email%></a></li><% } %>\n                                <% if(o.companySites) { %><li><i class="icon-link"></i><a href="<%=o.companySites%>"  title="<%=o.companySites%>" target="_blank"><%=o.companySites%></a></li><% } %>\n                                <% if(o.companyAddress) { %><li title="<%=o.companyAddress%>"><i class="icon-address"></i><%=o.companyAddress%></li><% } %>\n                            </ul>\n                        </div>',privacyTips_b2c_base:'<div id="imTopNotic" class="im-tips im-tips--b2c-base">\n                                    <div class="im-tips__content"><%=o.tips%></div>\n                                    <div class="im-tips__close-btn"></div>\n                               </div>'},RICH_MSG_TPL:['<% if(!o.isNeedWrap) {%><div class="mod-richmsg" data-guid="<%=o.seq%>"><% } %>\n            <div class="richmsg-type-0">\n                <div class="content">\n                    <dl>\n                        <dt class="title"><a href="javascript:;" action="<%=o.title.action%>" url="<%=o.title.url%>"><p><%=o.title.text%></p></a></dt>\n                        <dd class="thumb"><a href="javascript:;" action="<%=o.title.action%>" url="<%=o.title.url%>"><img src="<%=o.picture.cover%>"/></a></dd>\n                    </dl>\n                </div>\n                <div class="buttons"><% for(var i = 0, l = o.buttons.length;i<l;i++) {%>\n                    <a href="javascript:;" class="action" action="<%=o.buttons[i].action%>" actionData="<%=o.buttons[i].actionData%>"><%=o.buttons[i].text%></a>\n                </div><% } %>\n            </div>\n            <% if(!o.isNeedWrap) {%></div><% } %>','<div class="richmsg-type-1">\n            <div class="content">\n                <h2 class="title"><%=o.title.text%></h2>\n                <p class="thumb"><a href="javascript:;" class="action" action="<%=o.picture.action%>" actionData="<%=o.picture.actionData%>"><img src="<%=o.picture.cover || o.face%>"/></a></p>\n                <dl class="detail">\n                    <dt><a href="javascript:;" class="action" action="<%=o.detailText.mainText.action%>" actionData="<%=o.detailText.mainText.actionData%>"><%=o.detailText.mainText.text%></a></dt>\n                    <dd><a href="javascript:;" class="action" action="<%=o.detailText.subText.action%>" actionData="<%=o.detailText.subText.actionData%>"><%=o.detailText.subText.text%></a></dd>\n                </dl>\n            </div>\n        </div>',{simple:'\n                    <div class="richmsg-type-2">\n                        <div class="content simple" actionData="<%=o.data[0].url%>" action="web">\n                            <h2 class="title"><%=o.data[0].title%></h2>\n                            <h3 class="date"><%=o.data[0].date%></h3>\n                            <div class="thumb">\n                                <div class="img" style="background-image: url(<%=o.data[0].cover%>)"></div>\n                            </div>\n                            <div class="summary"><%=o.data[0].summary%></div>\n                            <div class="detail"><span>$$$chat_graphic_msg_readmore_text$$$</span><span class="arrow"></span></div>\n                        </div>\n                    </div>\n                    ',multiple:'\n                      <div class="richmsg-type-2">\n                          <ul class="content multiple">\n                              <% for (var i = 0;i < o.data.length; i++) { %>\n                                  <% if (i == 0) { %>\n                                      <li class="article main">\n                                          <div class="thumb" action="web" actionData="<%=o.data[i].url%>">\n                                              <div class="img" style="background-image: url(<%=o.data[i].cover%>)"></div>\n                                              <div class="title-wrap">\n                                                  <div class="title"><%=o.data[i].title%></div>\n                                              </div>\n                                          </div>\n                                      </li>\n                                  <% } else { %>\n                                      <li class="article sub">\n                                          <div class="thumb" action="web" actionData="<%=o.data[i].url%>">\n                                              <div class="title"><div><%=o.data[i].title%></div></div>\n                                              <div class="img" style="background-image: url(<%=o.data[i].cover%>)"></div>\n                                          </div>\n                                      </li>\n                                  <% } %>\n                              <% } %>\n                          </ul>\n                      </div>\n                      '},'<div class="richmsg-type-3">\n            <div class="content">\n            <%\n                var qlist = o.qlist || {},\n                    hasDesc = false,\n                    description = qlist.description || [],\n                    questions = qlist.questions || [];\n\n                if (qlist.type && qlist.type == 2) {\n                    hasDesc = true;\n            %>\n                <div class="desc-section <%= questions.length > 0 ? \'\' : \'desc-section--only\' %>">\n            <%\n                    for (var i = 0, len = description.length; i < len; i++) {\n                        if (description[i].url) {\n            %>\n                <a action="web" url="<%= description[i].url %>" href="<%= description[i].url %>" target="_blank"><%= description[i].text %></a>\n            <% } else { %>\n                <span><%= description[i].text %></span>\n            <% }} %> </div> <% } %>\n                <% if (questions.length > 0) { %>\n                <div class="question-title"><%= hasDesc ? \'你可能还想问：\' : \'亲，你是不是想问：\' %></div>\n                <ul class="question-list" data-type="<%= qlist.type %>">\n                    <% for (var i = 0, len = questions.length; i < len; i++) { %>\n                    <li class="question-item"><a action="msg" question="<%= questions[i].text %>" href="javascript:;"><i class="question-icon"></i><%= questions[i].text %></a></li>\n                    <% } %>\n                </ul>\n                <% } %>\n            </div>\n        </div>','<div class="richmsg-type-4">\n            <div class="content coupon" action="web" url=<%=o.data.url%>>\n                <div class="coupon-header" style="background-color: <%=o.data.bgColor%>;">\n                    <div class="coupon-info">\n                        <p class="name" title="<%=o.data.title%>"><%=o.data.title%></p>\n                        <p class="summary" title="<%=o.data.summary%>"><%=o.data.summary%></p>\n                    </div>\n                    <div class="coupon-icon" style="background-image:url(<%=o.data.cover%>)"></div>\n                </div>\n                <div class="coupon-footer">\n                    <p class="time"><%=o.data.remark%></p>\n                </div>\n            </div>\n        </div>','<div class="richmsg-type-5">\n            <div class="html-content">\n            </div>\n        </div>'],MSG_AUTO_COMPLETE_TPL:'<ul data-queryid="<%=o.queryid%>"><%for(var i=0;i<o.list.length;i++){%>\n            <li data-order="<%=o.list[i].order%>" data-docid="<%=o.list[i].reply_docid%>" title="<%=o.list[i].text%>"><span class="text"><i class="icon-q"></i><%=o.list[i].text%></span></li><%}%>\n        </ul>',SOCKET_CMD:{REG:{EMIT:"register",RECEIVE:"register ack"},C2B:{EMIT:"message c2b",RECEIVE:"message c2b ack"},B2C:{RECEIVE:"message b2c",EMIT:"message b2c ack"},KF_CHANGE:{EMIT:"change kf",RECEIVE:"change kf ack"},ROUTE:{RECEIVE:"route change",EMIT:"route change ack"},OVER:{RECEIVE:"session over"},SESSION_MSG:{RECEIVE:"s_msg",EMIT:"s_msg_ack"},CLIENT_PING:{EMIT:"p"}},AUTH_TYPE:{wx_mp:{name:"wx_mp",getVidUrlKey:"CHECK_WX_VISITORID",needGetOpenid:!0,appType:1},wx_mini:{name:"wx_mini",getVidUrlKey:"CHECK_WX_VISITORID",appType:1},wx_mix:{name:"wx_mix",getVidUrlKey:"CHECK_WX_VISITORID",appType:1},base:{name:"base",appType:4},31:{name:"31",getVidUrlKey:"CHECK_THIRD_VISITORID",appType:3,needGetOpenid:!1,reconnectDoSso:!0,ssoIframe:!0,ssoIframeUrl:"/login?client_id=GjhClient&nonce="+(new Date).getTime()+"&redirect_uri=https%3A%2F%2Fwebpage.qidian.qq.com%2F2%2Fchat%2Fmiddle%2Findex.html",redirectUrl:"https://webpage.qidian.qq.com/2/chat/middle/index.html",authDomain:"auth.cantonfair.org.cn"},"31WL":{name:"31WL",getVidUrlKey:"CHECK_THIRD_VISITORID",appType:6,needGetOpenid:!1,reconnectDoSso:!0,ssoIframe:!0,ssoIframeUrl:"/user/oauth2/authorize/?app_id=a496bc60dcb7f7ba&type=app_admin&scope=user_base&state=%257B%2522auth%2522%253A%252231WL%2522%257D&account_id=a496bc60dcb7f7ba&redirect_uri=https%3A%2F%2Fwebpage.qidian.qq.com%2F2%2Fchat%2Fsso-middle%2Findex.html",redirectUrl:"https://webpage.qidian.qq.com/2/chat/sso-middle/index.html",authDomain:"user.cantonfair.org.cn"}}},S={win:window,receptionist:{},wpaDetail:{},getSignTData:{},kfChangeTip:0,isGetSignT:0,isRegOK:0,isMobile:0,isChangeKF:0,inRegProcess:0,isRealSendMsg:1,isInIframe:e,defaultAvatar:T.CGI_URL.COMP_SOURCE_URL+"img/default-avatar.png",imageLoadFail:T.CGI_URL.COMP_SOURCE_URL+"img/image-load-fail.png",reSendC2bMsg:null,ioLinkStatus:null,regSuccessCallBack:null,imStatus:"open",pageStatus:"show",clickName:"click",chatSocket:new function(){this.create=function(e,t){return this.ioLink=io.connect(e,t),this},this.close=function(){this.ioLink.disconnect()},this.emitMsg=function(e,t,i,n){return this.ioLink&&this.ioLink.compress(!1).emit(e,t),i&&i.call(n),this},this.receiveMsg=function(e,t,i,n,a){i=i||this;return a?this.ioLink.once(e,function(e){n&&$.extend(e,n),t&&t.call(i,e)}):this.ioLink.on(e,function(e){n&&$.extend(e,n),t&&t.call(i,e)}),this}},c2bDBsaveData:[],c2bSeqGroup:[],authConfig:{auth:0},menuDetail:{active:0,currentVersion:"",eLogo:"",eName:"",defaultConfig:{active:0}},seqs:{key:"",data:[]},getSigTData:{},originRoleValue:null,clientPingTimer:null,serverClientTimeDiff:0,htReportOpts:{flag1:21873,flag2:1},registerType:"default",routePermit:{isCorpUin:0,isNeedQQ:1},lang:"zh-cn",translate:{translateSwitch:!1,translateLang:"zh",translateAuto:!0},wxConfig:{enableVoice:!1,appid:"",openid:""},externalType:1,isShowQidianSign:1,isShowBusinessCard:1,thirdAppConfig:{enable:!1,type:"",appType:0,appId:"",openId:"",userInfo:null}},t=S.win.navigator.userAgent.toLocaleLowerCase();S.userAgent=t,$.extend(S,!0,{isGetSkin:0});var w={chatBody:$("body"),page:$(".page"),header:$(".title-normal"),callGroup:$(".call-group"),chatList:$(".chat-list"),modList:$(".mod-list"),chatListWrap:$(".chat-list .list-wrap"),chatPost:$(".chat-post"),chatBtnSend:$(".btn-send"),btnUpload:$(".btn-upload"),btnFace:$(".btn-face"),btnVoice:$(".btn-voice"),btnKeyboard:$(".btn-keyboard"),faceList:$(".chat-face"),uploadInput:$("input[type=file]"),sidebar:$(".sidebar"),actList:$(".act-list"),btnBusinessCard:$(".btn-business-card")},u=$.extend(!0,{},w,{page:$(".page"),chatPostArea:$(".post-area"),unReadMsgNum:$(".unread-msg-num"),statusBar:$(".title-minify"),sidebar:$(".sidebar")}),v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],n=!0,a=!1,o=void 0;try{for(var s,r=e[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!t||i.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw o}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},q=function(s){if(s.BJ_REPORT)return s.BJ_REPORT;var l=[],i={},d={id:0,uin:0,url:"",offline_url:"",offline_auto_url:"",ext:null,level:4,ignore:[],random:1,delay:1e3,submit:null,repeat:5,offlineLog:!1,offlineLogExp:5,offlineLogAuto:!1},f={db:null,ready:function(t){var i=this;if(!window.indexedDB||!d.offlineLog)return d.offlineLog=!1,t();if(this.db)setTimeout(function(){t(null,i)},0);else{var e=window.indexedDB.open("badjs",1);if(!e)return d.offlineLog=!1,t();e.onerror=function(e){return t(e),!(d.offlineLog=!1)},e.onsuccess=function(e){i.db=e.target.result,setTimeout(function(){t(null,i)},500)},e.onupgradeneeded=function(e){var t=e.target.result;t.objectStoreNames.contains("logs")||t.createObjectStore("logs",{autoIncrement:!0})}}},insertToDB:function(e){this.getStore().add(e)},addLog:function(e){this.db&&this.insertToDB(e)},addLogs:function(e){if(this.db)for(var t=0;t<e.length;t++)this.addLog(e[t])},getLogs:function(i,n){var e,a;this.db&&(e=this.getStore().openCursor(),a=[],e.onsuccess=function(e){var t=e.target.result;t?(t.value.time>=i.start&&t.value.time<=i.end&&t.value.id==i.id&&t.value.uin==i.uin&&a.push(t.value),t.continue()):n(null,a)},e.onerror=function(e){return n(e),!0})},clearDB:function(e){var i,n;this.db&&(i=this.getStore(),e?(n=Date.now()-24*(e||2)*3600*1e3,i.openCursor().onsuccess=function(e){var t=e.target.result;t&&(t.value.time<n||!t.value.time)&&(i.delete(t.primaryKey),t.continue())}):i.clear())},getStore:function(){return this.db.transaction("logs","readwrite").objectStore("logs")}},p={isOBJByType:function(e,t){return Object.prototype.toString.call(e)==="[object "+(t||"Object")+"]"},isOBJ:function(e){return"object"===(void 0===e?"undefined":v(e))&&!!e},isEmpty:function(e){return null===e||!p.isOBJByType(e,"Number")&&!e},extend:function(e,t){for(var i in t)e[i]=t[i];return e},processError:function(t){try{if(t.stack){var e=t.stack.match("https?://[^\n]+"),i=(i=(e=e?e[0]:"").match(":(\\d+):(\\d+)"))||[0,0,0];return{msg:p.processStackMsg(t),rowNum:i[1],colNum:i[2],target:e.replace(i[0],""),_orgMsg:t.toString()}}return t.name&&t.message&&t.description?{msg:JSON.stringify(t)}:t}catch(e){return t}},processStackMsg:function(e){var t=e.stack.replace(/\n/gi,"").split(/\bat\b/).slice(0,9).join("@").replace(/\?[^:]+/gi,""),i=e.toString();return t.indexOf(i)<0&&(t=i+"@"+t),t},isRepeat:function(e){if(!p.isOBJ(e))return!0;var t=e.msg;return(i[t]=(parseInt(i[t],10)||0)+1)>d.repeat}},r=s.onerror;s.onerror=function(e,t,i,n,a){var o=e;a&&a.stack&&(o=p.processStackMsg(a)),p.isOBJByType(o,"Event")&&(o+=o.type?"--"+o.type+"--"+(o.target?o.target.tagName+"::"+o.target.src:""):""),h.push({msg:o,target:t,rowNum:i,colNum:n,_orgMsg:e}),c(),r&&r.apply(s,arguments)};function u(){var e;clearTimeout(_),m.length&&(e=d._reportUrl+m.join("&")+"&count="+m.length+"&_t="+ +new Date,d.submit?d.submit(e):(new Image).src=e,_=0,m=[])}var g=[],m=[],_=0,c=function(e){if(d._reportUrl){for(var t,i=Math.random()>=d.random;l.length;){var n=!1,a=l.shift();if(a.msg=(a.msg+""||"").substr(0,500),!p.isRepeat(a)){var o=function(e,t){var i=[],n=[],a=[];if(p.isOBJ(e))for(var o in e.level=e.level||d.level,e){var s=e[o];if(!p.isEmpty(s)){if(p.isOBJ(s))try{s=JSON.stringify(s)}catch(e){s="[BJ_REPORT detect value stringify error] "+e.toString()}a.push(o+":"+s),i.push(o+"="+encodeURIComponent(s)),n.push(o+"["+t+"]="+encodeURIComponent(s))}}return[n.join("&"),a.join(","),i.join("&")]}(a,m.length);if(p.isOBJByType(d.ignore,"Array"))for(var s=0,r=d.ignore.length;s<r;s++){var c=d.ignore[s];if(p.isOBJByType(c,"RegExp")&&c.test(o[1])||p.isOBJByType(c,"Function")&&c(a,o[1])){n=!0;break}}n||(d.offlineLog&&(d.id,d.uin,t=a,t=p.extend({id:d.id,uin:d.uin,time:+new Date},t),f.db?f.addLog(t):(f.db||g.length||f.ready(function(e,t){t&&g.length&&(t.addLogs(g),g=[])}),g.push(t))),i||20==a.level||(m.push(o[0]),d.onReport&&d.onReport(d.id,a)))}}e?u():_=_||setTimeout(u,d.delay)}},h={},h="localhost"!=window.location.host?s.BJ_REPORT={push:function(e){var t,i,n=p.isOBJ(e)?p.processError(e):{msg:e};return d.ext&&!n.ext&&(n.ext=d.ext),n.from||(n.from=location.href),n._orgMsg?(t=n._orgMsg,delete n._orgMsg,n.level=2,(i=p.extend({},n)).level=4,i.msg=t,l.push(n),l.push(i)):l.push(n),c(),h},report:function(e,t){return e&&h.push(e),t&&c(!0),h},info:function(e){return e&&(p.isOBJ(e)?e.level=2:e={msg:e,level:2},h.push(e)),h},debug:function(e){return e&&(p.isOBJ(e)?e.level=1:e={msg:e,level:1},h.push(e)),h},reportOfflineLog:function(){window.indexedDB?f.ready(function(e,t){var a,o;t&&(a=new Date-24*d.offlineLogExp*3600*1e3,o=+new Date,t.getLogs({start:a,end:o,id:d.id,uin:d.uin},function(e,i){var n=document.createElement("iframe");n.name="badjs_offline_"+ +new Date,n.frameborder=0,n.height=0,n.width=0,n.src="javascript:false;",n.onload=function(){var e=document.createElement("form");e.style.display="none",e.target=n.name,e.method="POST",e.action=d.offline_url||d.url.replace(/badjs$/,"offlineLog"),e.enctype.method="multipart/form-data";var t=document.createElement("input");t.style.display="none",t.type="hidden",t.name="offline_log",t.value=JSON.stringify({logs:i,userAgent:navigator.userAgent,startDate:a,endDate:o,id:d.id,uin:d.uin}),n.contentDocument.body.appendChild(e),e.appendChild(t),e.submit(),setTimeout(function(){document.body.removeChild(n)},1e4),n.onload=null},document.body.appendChild(n)}))}):q.info("unsupport offlineLog")},offlineLog:function(e){return e&&(p.isOBJ(e)?e.level=20:e={msg:e,level:20},h.push(e)),h},init:function(e){if(p.isOBJ(e))for(var t in e)d[t]=e[t];var i=parseInt(d.id,10);return i&&(/qq\.com$/gi.test(location.hostname)&&(d.url||(d.url="//badjs2.qq.com/badjs"),d.uin||(d.uin=parseInt((document.cookie.match(/\buin=\D+(\d+)/)||[])[1],10))),d._reportUrl=(d.url||"/badjs")+"?id="+i+"&uin="+d.uin+"&"),l.length&&c(),f._initing||(f._initing=!0,f.ready(function(e,t){t&&setTimeout(function(){t.clearDB(d.offlineLogExp),setTimeout(function(){var e;d.offlineLogAuto&&((e=document.createElement("script")).src=d.offline_auto_url||d.url.replace(/badjs$/,"offlineAuto")+"?id="+d.id+"&uin="+d.uin,window._badjsOfflineAuto=function(e){e&&q.reportOfflineLog()},document.head.appendChild(e))},5e3)},1e3)})),h},__onerror__:s.onerror}:s.BJ_REPORT={push:function(){return h},report:function(){return h},info:function(){return h},debug:function(){return h},reportOfflineLog:function(){},offlineLog:function(){return h},init:function(){return h},__onerror__:s.onerror};return"undefined"!=typeof console&&console.error&&setTimeout(function(){(location.hash||"").match(/([#&])BJ_ERROR=([^&$]+)/)},0),h}(window);"undefined"!=typeof module&&(module.exports=q);!function(){for(var e=["mb2345browser","ucbrowser"],t=window.navigator.userAgent.toLocaleLowerCase(),i={id:1,combo:0,url:"//badjs.qidian.qq.com/badjs",level:2},n=0;n<e.length;n++)if(-1!==t.indexOf(e[n])){$.extend(i,{ignore:[/Script error/i]});break}BJ_REPORT.init(i)}();function h(){w.chatListWrap[0].scrollTop=w.chatListWrap[0].scrollHeight}function c(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent("on"+t,i)}var l,d,y=(d="QD_PM",{receive:function(e,a){c(e,"message",function(e){var t,i,n=(t=e.data,i=Object.prototype.toString,!(!t||"[object String]"!==i.call(t)||/uc_msg|oppo_night|weibo|msfapi|axure/i.test(t))&&t);if(n){-1==n.indexOf(d)&&BJ_REPORT&&BJ_REPORT.report("PM NO Flag "+n);try{l=JSON.parse(n)}catch(e){throw new Error("PostMsg Parse Error "+n)}"function"==typeof a&&a(l)}})},send:function(e,t){var i=l?$.extend(l,e):e,n=t||"CHAT";i.hasOwnProperty(d)&&i[d]==n||(i[d]=n),i="string"!=typeof i?JSON.stringify(i):i,window.parent.postMessage(i,"*")}});function C(e){var t=e-100+1;return Math.floor(Math.random()*t+100)}var x=function(e){return(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;").replace(/=/g,"&#61;").replace(/`/g,"&#96;")};function f(e,t){var i=1<arguments.length&&void 0!==t?t:{};if("object"===(void 0===i?"undefined":v(i))&&i.styleConfig&&"object"===v(i.styleConfig)&&(!i.attributeName||"string"==typeof i.attributeName)){var n=i.attributeName||"data-style",a=!0;i.hasOwnProperty("overwrite")&&!1===i.overwrite&&(a=!1);var o=i.keepEvents||!1;if("object"===(void 0===e?"undefined":v(e))&&e instanceof HTMLElement)return p(e,i.styleConfig,n,a,o);if("string"==typeof e){if("#"===e.substr(0,1)){var s=e.substr(1),r=document.getElementById(s);if(null===r)return;return p(r,i.styleConfig,n,a,o)}if("."===e.substr(0,1)){var c=e.substr(1),l=document.getElementsByClassName(c),d=[];if(0===l.length)return;for(var f=0;f<l.length;f++)d.push(p(l[f],i.styleConfig,n,a,o));return d}}}}function p(e,t,i,n,a){if(a){var o=e.querySelectorAll("["+i+"]");e.hasAttribute(i)&&g(e,t,i,n);for(var s=0,r=o.length;s<r;s++)g(o[s],t,i,n);return e}var c=e.cloneNode(!0);c.hasOwnProperty(i)&&g(c,t,i,n);for(var l=c.querySelectorAll("["+i+"]"),d=0,f=l.length;d<f;d++)g(l[d],t,i,n);return e.parentNode.replaceChild(c,e),c}function g(e,t,i,n){var a=t[e.getAttribute(i)];for(var o in a)!n&&e.style.hasOwnProperty(o)||(e.style[o]=a[o]);return e}var k=function(e,i,t){var n,a={}.toString;return n=e.replace(/<%=(.+?)%>/g,function(e,t){return"="===t.substring(0,1)?"[object Object]"==a.call(i,null)?i[t.substring(1)]:i:i[t]?x("[object Object]"==a.call(i,null)?i[t]:i):""}),S.styleRenderConfig&&(n=function(e){var t=document.createElement("div");t.appendChild(e.cloneNode(!0));var i=t.innerHTML;return t=e=null,i}(f($(n).get(0),S.styleRenderConfig))),n=t?t(n):n};var m={"zh-cn":"","en-us":"En","zh-tw":"Tw",zh:"",en:"En","zh-TW":"Tw"},_=function(e){var t,i,n,a;return S.suportInfo?(t=S.lang,i=S.suportInfo["suportName"+m[t]||""],n=S.suportInfo["supportWebsite"+m[t]||""]||S.suportInfo.suportWebsite,a=-1<S.suportInfo.suportWebsite.indexOf("?")?"&":"?",$(e).find(".tencent-certification").remove(),$(e).append($.tmpl(T.CHAT_MSG_TPL.tencentCert,{logo:S.suportInfo.suportLogo,name:i,website:n+a+"bid="+S.receptionist.kfUin+"&f_uin="+S.receptionist.kfUin+"&channel=webim"}))):($(e).find(".tencent-certification").remove(),$(e).append($('<div class="tencent-certification"></div>'))),$(e)},E=function(){var e,t,i,n;return S.suportInfo&&(e=S.lang,t=S.suportInfo["suportName"+m[e]||""],i=S.suportInfo.suportWebsite,n=-1<S.suportInfo.suportWebsite.indexOf("?")?"&":"?",$(".tencent-certification").html($.tmpl(T.CHAT_MSG_TPL.tencentCertContent,{logo:S.suportInfo.suportLogo,name:t,website:i+n+"bid="+S.receptionist.kfUin}))),$(".tencent-certification")};function I(e){var t,i=!0,n=e.msgType,a={seq:e.seq};switch(n){case"tmpl":t=$.tmpl(T.CHAT_MSG_TPL[e.type],e.data);break;case"serverResp":t=e.data;break;case"feedBack":t=e.replyContent;break;case"sessionEnd":t=e.data||$.i18n(T.SYS_MSG[e.type]);break;default:t=$.i18n(T.SYS_MSG[e.type])}$.extend(a,{msg:t}),"sessionEnd"==e.type&&(S.isChangeKF?i=!1:S.ioLinkStatus="sessionOver"),e.empty&&w.chatBody.hasClass("regsuccess")&&(e.empty=!1),i&&!e.notip&&(e.empty?(w.chatListWrap.empty().append(k(T.CHAT_MSG_TPL.sys,a)),_(w.chatListWrap)):(w.chatBody.hasClass("regsuccess")||w.chatBody.hasClass("reconnect"))&&"new"==e.act?w.chatListWrap.find(".tencent-certification").before(k(T.CHAT_MSG_TPL.sys,a)):"update"==e.act?w.chatBody.hasClass("regsuccess")||w.chatBody.hasClass("reconnect")?$('[data-guid="'+e.seq+'"]').find(".text").html(a.msg):w.chatListWrap.find(".msg-sys").last().find(".text").html(a.msg):"remove"==e.act&&$('[data-guid="'+e.seq+'"]').remove(),h())}var R=document;function O(e,t,i,n,a){a=a&&new Date(+new Date+a);var o=e+"="+escape(t)+(a?"; expires="+a.toGMTString():"")+(n?"; path="+n:"")+(i?"; domain="+i:"");return o.length<4096&&(R.cookie=o),this}function A(e){var t=R.cookie.match(new RegExp("(^| )"+e+"=([^;]*)(;|$)"));return null!=t?unescape(t[2]):null}function M(){var i={};return{type:"memory",getItem:function(e){return e in i&&i[e]},setItem:function(e,t){return i[e]=t,!0},removeItem:function(e){return e in i&&delete i[e]},clear:function(){return i={},!0}}}var L=function(e){var i=M();try{"localStorage"in e&&e.localStorage&&(e.localStorage.setItem("test","test"),e.localStorage.removeItem("test"),i=e.localStorage)}catch(e){BJ_REPORT&&BJ_REPORT.report(JSON.stringify(e))}return{type:i.type,get:function(e){return i.getItem(e)},set:function(e,t){try{return i.setItem(e,t),!0}catch(e){return!1}},remove:function(e){return i.removeItem(e)},clear:function(){return i.clear()}}}(window),P={setType:function(e,t){return e+""+t},getType:function(e){return i(e)?e.substr(-1,1):e},getBody:function(e){return i(e)?e.substr(0,13):e}};function i(e){return 14==e.length}var D=function(e){for(var t=e.length,i=parseInt(t/450,10),i=t%450!=0?i+1:i,n=0;n<i;n++)BJ_REPORT.report("Seqs Sheet "+e.substr(450*n,450))};function N(e){for(var t,i=L.get(S.seqs.key),n=P.getType(e),a=P.getBody(e),o=new RegExp(a,"gm");null!=(t=o.exec(i));)if(n==i.substr(t.index+13,1))return BJ_REPORT.report("Duplicate Msg SingleSeqs "+e),D(JSON.stringify(S.seqs.data)),!1;return!0}function B(e){var t=S.receptionist,i=U+t.kfUin+"_"+t.visitorId;L.set(i,JSON.stringify(e))}var U="MESSAGE_CACHE_",G=function(e){var t=[],i=(i=e)||U+S.receptionist.kfUin+"_"+S.receptionist.visitorId;try{t=JSON.parse(L.get(i))||[]}catch(e){}return t},H={setMsgCache:function(e){var t=S.receptionist,i=U+t.kfUin+"_"+t.visitorId,n=G(i),a=w.chatBody.hasClass("regsuccess")?"ack":"unconnect",o={singleSeqs:e.singleSeqs,seq:e.seq,cacheType:a};n.push(o),L.set(i,JSON.stringify(n))},setMsgCacheList:B,removeMsgCache:function(e){for(var t=S.receptionist,i=U+t.kfUin+"_"+t.visitorId,n=G(i),a=0;a<n.length;a++)if(n[a].seq==e){n.splice(a,1);break}L.set(i,JSON.stringify(n))},getMsgCacheList:G,hasSeqInMsgCache:function(e){for(var t="",i=G(),n=0;n<i.length;n++)if(e==i[n].seq){t=i[n].cacheType;break}return t},clearUnconnectForCache:function(){for(var e=G(),t=[],i=0;i<e.length;i++)"unconnect"!=e[i].cacheType&&t.push(e[i]);B(t)},clearCache:function(){B([])}};var F,j=(F={},{initialize:function(e){F=S.receptionist,function(){var e=JSON.parse(L.get("config")),t="kf"+F.kfUin,i=JSON.parse(L.get(t)),n=+new Date,a={visitorId:F.visitorId,startTime:n,total:0},o=!1;e?function(){var e,t,i,n=L.get("config");if(~n.indexOf("verison")&&(BJ_REPORT.report("Wrong Word verison"),n=n.replace(/verison/g,"version"),L.set("config",n)),e=JSON.parse(n),"1.0.0"==(t=e.version)&&($.extend(e,{version:1,updateAct:{name:"reName",time:+new Date}}),L.set("config",JSON.stringify(e))),0<(i=T.MSG_DB_OPTS.CURRENT_VERSION-t)){for(var a=0;a<i;a++)!function(e){var t="kf"+F.kfUin,i=JSON.parse(L.get(t));switch(e){case 2:for(var n=0;n<i.length;n++){var a=i[n].visitorId,o=i[n].total;if(a==F.visitorId&&0<o)for(var s=0;s<o;s++){var r=t+"vId"+a+"index"+s,c=JSON.parse(L.get(r));$.extend(c,{type:1}),L.set(r,JSON.stringify(c))}}break;case 3:if(!0===S.isRoamMessage)break;for($.isArray(i)||(i=[{visitorId:F.visitorId,total:0}],BJ_REPORT.report("Msgdb Update Error "+JSON.stringify(i))),n=0;n<i.length;n++)if(a=i[n].visitorId,o=i[n].total,a==F.visitorId&&0<o)for(var l=t+"vId"+a+"seqs",d=[],s=0;s<o;s++)d.push(s),L.set(l,JSON.stringify(d));break;default:BJ_REPORT.report("VERSION INDEX ERROR: "+e)}}(a+t+1);$.extend(e,{version:T.MSG_DB_OPTS.CURRENT_VERSION,updateAct:{name:"update",time:+new Date}}),L.set("config",JSON.stringify(e))}}():L.set("config",JSON.stringify({name:T.MSG_DB_OPTS.NAME,version:T.MSG_DB_OPTS.CURRENT_VERSION,createTime:n})),i?(i.forEach(function(e){e.visitorId==a.visitorId&&(o=!0)}),o||(i.push(a),L.set(t,JSON.stringify(i)),o=!0)):(L.set(t,JSON.stringify([a])),L.set(S.seqs.key,JSON.stringify([]))),S.isRoamMessage||L.get(S.seqs.key)||L.set(S.seqs.key,JSON.stringify([]))}()},saveMsg:function(e,t,i){var n,a=S.receptionist,o=a.kfUin,s=a.visitorId,r=t["b2c"==e?"sortseq":"date"]+""+t.type,c="kf"+o+"vId"+s+"index"+r,l=S.c2bDBsaveData,d=S.seqs.data,f={};if(d&&$.isArray(d)||(S.seqs.data=d=[],!0!==S.isRoamMessage&&L.set(S.seqs.key,JSON.stringify(d))),"b2c"==e){if(f={data:t.data,type:t.type,seq:t.seq,time:t.date,date:t.date,img_type:t.img_type,vote:t.vote,brief:t.brief},!i.singleSeqs)throw new Error("not sortSeqs");n=i.singleSeqs,3!=t.type&&$.extend(f,{dir:e,avatar:t.avatar,name:t.name}),5==t.type&&$.extend(f,{tpl:t.tpl,msgType:t.msgType,simple:t.simple,method:""}),"insert"==i.act?d.splice(i.index,0,i.singleSeqs):d.push(i.singleSeqs)}else if("c2b"==e){for(var p,u=0,g=l.length;u<g;u++){var m=l[u];if(m.seq==t.seq){$.extend(f,m,t),f.time=f.date,f.dir=e,l.splice(u,1),S.c2bDBsaveData=l;break}}2==f.type&&(p=f.data,f.data=f.imgSrc.replace(/\/0$/g,"/720"),f.imgSrc=p),w.chatBody.hasClass("regsuccess")&&d.push(t.singleSeqs),n=t.singleSeqs,H.setMsgCache(f)}void 0!==f.data.tpl&&delete f.data.tpl,r++,S.seqs.data=d,!0!==S.isRoamMessage&&(!w.chatBody.hasClass("regsuccess")&&"c2b"==e||function(e,t,i){var n,a="kf"+e,o=JSON.parse(L.get(a))||[];o.forEach(function(e){e.visitorId==t&&(n=e.total,"set"==i&&(n++,e.total=n))}),"get"!=i&&L.set("kf"+e,JSON.stringify(o))}(o,s,"set"),L.set(S.seqs.key,JSON.stringify(d))),!0===S.isRoamMessage&&L.set("CACHE_"+S.seqs.key,JSON.stringify(d)),L.set(c,JSON.stringify(f)),BJ_REPORT.report("Msg Dir "+e+" Seqs "+("b2c"==e?P.setType(t.sortseq-S.serverClientTimeDiff,t.type):n))},saveMsgToDB:function(e){var t=S.c2bSeqGroup||[],i=e.date||e.time,n={seq:e.seq,data:e.data,type:e.type};2==e.type&&$.extend(n,{imgSrc:e.imgSrc}),S.c2bDBsaveData.push(n),t.push({date:i,seq:e.seq,type:e.type}),S.c2bSeqGroup=t,N(i+""+e.type)&&j.saveMsg("c2b",{avatar:e.avatar,wordMsgSeq:e.wordMsgSeq,seq:e.seq,type:e.type,date:i,singleSeqs:i+""+e.type,vote:e.vote,brief:e.brief})}}),W={index:[14,1,2,3,4,5,6,7,8,9,10,11,12,13,0,15,16,96,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,89,113,114,115,60,61,46,63,64,116,66,67,53,54,55,56,57,117,59,75,74,69,49,76,77,78,79,118,119,120,121,122,123,124,42,85,43,41,86,125,126,127,128,129,130,131,132,133,134,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,135,17,40,44,45,58,47,48,50,51,52,68,70,71,72,73,80,81,82,83,84,87,88,90,91,92,93,94,95,62,65,172,182,179,173,174,212,175,178,177,180,181,176,183,171,188,192,184,185,190,187,193,194,197,198,199,200,201,202,203,204,205,206,207,208,210,211],humen:["微笑","撇嘴","色","发呆","得意","流泪","害羞","闭嘴","睡","大哭","尴尬","发怒","调皮","呲牙","惊讶","难过","酷","冷汗","抓狂","吐","偷笑","可爱","白眼","傲慢","饥饿","困","惊恐","流汗","憨笑","大兵","奋斗","咒骂","疑问","嘘...","晕","折磨","衰","骷髅","敲打","再见","擦汗","抠鼻","鼓掌","糗大了","坏笑","左哼哼","右哼哼","哈欠","鄙视","委屈","快哭了","阴险","亲亲","吓","可怜","菜刀","西瓜","啤酒","篮球","乒乓","咖啡","饭","猪头","玫瑰","凋谢","示爱","爱心","心碎","蛋糕","闪电","炸弹","刀","足球","瓢虫","便便","月亮","太阳","礼物","拥抱","强","弱","握手","胜利","抱拳","勾引","拳头","差劲","爱你","NO","OK","爱情","飞吻","跳跳","发抖","怄火","转圈","磕头","回头","跳绳","挥手","激动","街舞","献吻","左太极","右太极","双喜","鞭炮","灯笼","发财","K歌","购物","邮件","帅","喝彩","祈祷","爆筋","棒棒糖","喝奶","下面","香蕉","飞机","开车","高铁左车头","车厢","高铁右车头","多云","下雨","钞票","熊猫","灯泡","风车","闹钟","大伞","彩球","钻戒","沙发","纸巾","药","手枪","青蛙"],locale:["qqface_Smile","qqface_Grimac","qqface_Drool","qqface_Scowl","qqface_Chill","qqface_Sob","qqface_Shy","qqface_Silent","qqface_Sleep","qqface_Cry","qqface_Awkward","qqface_Angry","qqface_Tongue","qqface_Grin","qqface_Surprise","qqface_Frown","qqface_CoolGuy","qqface_Helpless","qqface_Scream","qqface_Puke","qqface_Chuckle","qqface_Joyful","qqface_Slight","qqface_Smug","qqface_Hungry","qqface_Drowsy","qqface_Panic","qqface_Sweat","qqface_Laugh","qqface_Commando","qqface_Determined","qqface_Scold","qqface_Confused","qqface_Shhh","qqface_Dizzy","qqface_Torturing","qqface_Toasted","qqface_Skull","qqface_Hammer","qqface_Bye","qqface_Speechless","qqface_NosePick","qqface_Clap","qqface_Embarrased","qqface_Trick","qqface_Hum!L","qqface_Hum!R","qqface_Yawn","qqface_Pooh-pooh","qqface_Shrunken","qqface_TearingUp","qqface_Sly","qqface_Kiss","qqface_What!","qqface_Whimper","qqface_Cleaver","qqface_Watermelon","qqface_Beer","qqface_Basketball","qqface_Pingpong","qqface_Coffee","qqface_Rice","qqface_Pig","qqface_Rose","qqface_Wilt","qqface_Lips","qqface_Heart","qqface_BrokenHeart","qqface_Cake","qqface_Lightning","qqface_Bomb","qqface_Knife","qqface_Football","qqface_Beetle","qqface_Poop","qqface_Moon","qqface_Sun","qqface_Gift","qqface_Hug","qqface_Thumbsup","qqface_Thumbsdown","qqface_Shake","qqface_Victory","qqface_Salute","qqface_Beckon","qqface_Fist","qqface_Bad","qqface_LoveYou","qqface_NO","qqface_OK","qqface_Love","qqface_Blow_a_kiss","qqface_Waddle","qqface_Tremble","qqface_Aaagh!","qqface_Twirl","qqface_Kowtow","qqface_Turn_round","qqface_Rope_Skipping","qqface_Wave_hand","qqface_Excited","qqface_Street_Dance","qqface_Give_a_kiss","qqface_Tai_Chi_L","qqface_Tai_Chi_R","qqface_Bliss","qqface_Firecracker","qqface_Lantern","qqface_Fortune","qqface_Karaoke","qqface_Shopping","qqface_Email","qqface_Handsome","qqface_Hurray","qqface_Pray","qqface_Furious","qqface_Lollipop","qqface_Drink_milk","qqface_Noodles","qqface_Banana","qqface_Plane","qqface_Driving","qqface_Highspeed_Rail_L","qqface_Carriage","qqface_Highspeed_Rail_R","qqface_Cloudy","qqface_Rainy","qqface_Cash","qqface_Panda","qqface_Light_bulb","qqface_Windmill","qqface_Alarm_Clock","qqface_Umbrella","qqface_Balloon","qqface_Ring","qqface_Sofa","qqface_Toilet_Paper","qqface_Medicine","qqface_Pistol","qqface_Frog"]},J=function(e,t){var i,n,e=e||window.location.href;if(t){i=new RegExp("[?&]"+t+"=([^&#]*)","i");try{n=i.exec(e)[1]}catch(e){n=null}}else n=e.substring(e.indexOf("?")+1);return n},K=function(e,t){var i,n,e=e||window.location.href;if(t){i=new RegExp("[?&]"+t+"=([^&#]*)","i");try{n=i.exec(e)[0]}catch(e){n=""}}return""!==n&&(e=e.replace(n,"")),e},V=function(e,t,i){var n,a,e=e||window.location.href;if(t){n=new RegExp("([?&])"+t+"=([^&#]*)","i");try{a=n.exec(e)}catch(e){a=""}}return a&&(e=e.replace(t+"="+a[2],t+"="+i)),e};function z(e,t,i){this.$el=e,this.options=t,this.events=i,this.render(),this.bindEvents()}function Q(e,t,i){this.$el=e,this.options=t,this.events=i,this.render()}function Y(e,t,i){var n=this,a=$($.tmpl(T.CHAT_MSG_TPL.blackTip,e));w.chatList.append(a),setTimeout(function(){a.remove(),i&&i.apply(n)},t)}z.prototype.render=function(){var e=this.$el,t=this.options.value,i=$(['<div class="webim-switch">','   <input class="webim-switch__input" type="checkbox">','   <div class="webim-switch__slider"></div>',"</div>"].join(""));t&&(i.find(".webim-switch__slider").addClass("webim-switch__slider--on"),i.find(".webim-switch__input").prop("checked",!0)),e.append(i)},z.prototype.bindEvents=function(){var e=this.$el,t=this.events||{},i=e.find(".webim-switch__slider"),n=e.find(".webim-switch__input");i.on(S.clickName,function(){var e=n.prop("checked");n.prop("checked",!e),i[e?"removeClass":"addClass"]("webim-switch__slider--on"),"function"==typeof t.change&&t.change(!e)})},Q.prototype.render=function(){for(var e=this.$el,t=this.events||{},i=this.options.value||"en",n=this.options.options||[],a=[],o=0,s=n.length;o<s;o++)a.push('<option value="'+n[o].value+'">'+n[o].text+"</option>");var r=$(['<div class="webim-select">',"   <select>",a,"   </select>","</div>"].join("")),c=r.find("select");c.val(i),c.on("change",function(){"function"==typeof t.change&&t.change(c.val())}),e.append(r)};var X={init:function(e,t){we.call(this,e,t)},render:function(e){var t=!(0<arguments.length&&void 0!==e)||e;u.page.removeClass("hidden"),t&&(document.title=$.i18n("common_page_title")),t&&u.header.find("span.name").text($.i18n("common_page_title")),u.chatBtnSend.text($.i18n("common_sendbtn_text")),u.chatBtnSend.attr("title",$.i18n("common_sendbtn_text")),u.btnUpload.attr("title",$.i18n("common_insert_photo_text")),u.btnFace.attr("title",$.i18n("common_insert_emoji_text")),u.btnBusinessCard.attr("title",$.i18n("common_insert_businessCard_text")),/macintosh|mac os x/i.test(navigator.userAgent)?u.chatPost.find(".post-area").attr("placeholder",$.i18n("common_postarea_Macpc_placeholder")):u.chatPost.find(".post-area").attr("placeholder",$.i18n("common_postarea_pc_placeholder")),t&&u.chatListWrap.find(".initial-loading").html(['<i class="loading loading-b"></i>','<div class="msg-sys">','   <div class="text">'+$.i18n("sysmsg_get_sigt_msg")+"</div>","</div>"].join("")),setTimeout(function(){t&&u.chatListWrap.removeClass("chat-initial"),t&&u.chatListWrap.find(".initial-loading").hide()},200),t&&u.sidebar.find(".corp-loading .text").text($.i18n("sysmsg_load_corpinfo_msg"))}},Z=$.extend(!0,{},w,{chatPostArea:$(".post-area textarea")}),ee={init:function(e,t){we.call(this,e,t)},render:function(e){var t=!(0<arguments.length&&void 0!==e)||e;t&&(document.title=$.i18n("common_page_title")),t&&Z.header.find("span.title").text($.i18n("common_page_title")),Z.chatBtnSend.text($.i18n("common_sendbtn_text")),Z.chatPostArea.attr("placeholder",$.i18n("common_postarea_mobile_placeholder")),t&&Z.chatListWrap.find(".tencent-certification").before(['<section class="msg-sys">','<div class="text">'+$.i18n("sysmsg_get_sigt_msg")+"</div>","</section>",'<i class="loading loading-b"></i>'].join("")),setTimeout(function(){t&&Z.chatListWrap.find(".loading-b").remove()},200)}},te={"zh-cn":"zh","en-us":"en","zh-tw":"zh-TW"},ie=function(e){var t=$("#imTopNotic"),i=te[S.lang];t&&e&&t.find(".im-tips__content").html(e[i])},ne='\n<div class="lang-select">\n    <div class="lang-select__mask jLangMask"></div>\n    <div class="lang-select__wrapper">\n        <div class="lang-select__panel">\n            <div class="lang-select__header">\n                <div class="lang-select__icon"></div>\n                <div class="lang-select__title">Choose the service language</div>\n            </div>\n            <div class="lang-select__content">\n                <div class="lang-select__select jLangSelect"></div>\n                <div class="lang-select__switch">\n                    <span class="lang-select__switch__container jAutoSwitch"></span>\n                    <span class="lang-select__switch__label">Auto translation</span>\n                </div>\n                <div class="lang-select__tip">Show translation when receiving message</div>\n                <button class="lang-select__button jConfirmBtn">OK</button>\n            </div>\n        </div>\n    </div>\n</div>\n',ae={en:"en-us",zh:"zh-cn","zh-TW":"zh-tw"},oe=null;function se(){oe&&oe.remove(),oe=null}function re(i){var n,e,t,a,o,s,r;oe||(oe=$($.tmpl(ne,{})),w.chatList.append(oe),n=S.translate,e=oe.find(".jLangSelect"),t=oe.find(".jLangMask"),a=oe.find(".jAutoSwitch"),o=oe.find(".jConfirmBtn"),s=n.translateAuto,r=n.translateLang,new z(a,{value:n.translateAuto},{change:function(e){s!=e&&(s=e)}}),new Q(e,{value:n.translateLang,options:[{value:"en",text:"English"},{value:"zh-TW",text:"繁体中文"},{value:"zh",text:"简体中文"}]},{change:function(e){r!=e&&(r=e),S.isMobile&&(S.isInIframe?y.send({act:"BLUR",data:{isScrollWindow:!0}}):setTimeout(function(){window.scrollTo(0,0)},100))}}),t.on(S.clickName,function(e){o.hasClass("pending")||$(e.target).hasClass("lang-select__mask")&&se()}),o.on(S.clickName,function(){return n.translateLang==r?(n.translateAuto=s,oe.remove(),void(oe=null)):void(o.hasClass("pending")||(o.addClass("pending"),e={translateLang:r,isFirst:0},t=$.Deferred(),$.ajax({url:T.CGI_URL.TRANSLATE_LANG_CHANGE+"?kfuin="+S.receptionist.kfUin,data:$.extend({kfuin:S.receptionist.kfUin,visitorId:S.receptionist.visitorId},e),type:"POST",timeout:5e3,dataType:"json",success:function(e){t.resolve(e),E(),ie(S.topNotice)},fail:function(e){t.reject(e)}}),t.promise().then(function(e){var t;0==+e.r?(n.translateLang=r,n.translateAuto=s,S.lang=ae[r],$.i18n({locale:S.lang}),S.isInIframe||(-1!==(t=window.location.href).indexOf("qidian_lang")?t=V(t,"qidian_lang",ae[r]):t+="&qidian_lang="+ae[r],window.history&&window.history.replaceState&&window.history.replaceState({},"",t)),S.isMobile?ee.render(!1):X.render(!1),I({msgType:"serverResp",data:$.i18n(T.SYS_MSG.changeServiceLang)+'<a href="javascript:;" class="btn-lang">'+$.i18n("common_lang_"+r)+"</a>",act:"new"}),w.chatListWrap.find(".msg-sys .btn-lang").off(S.clickName).on(S.clickName,function(){Se()}),se(),i&&i()):Y({text:e.message},1e3),o.removeClass("pending")},function(e){BJ_REPORT.report("change translate lang error"),BJ_REPORT.report(JSON.stringify(e))})));var e,t}))}function ce(e){var t,i="tencentSig",n=void 0===L.type||"memory"===L.type;S.thirdAppConfig.secretKey&&(i="tencentThirdSig");var a,o,s,r={active:!1,url:""};return $.extend(r,e),o=(a=r.active)?J(r.url,"visitorId"):A(i),!a&&n&&(o?L.set(i,o):o=L.get(i)),(t=o)||(s=(Math.floor(10*Math.random())||1)+function(e,t){var i,n,a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),o=[];if(t=t||a.length,e)for(i=0;i<e;i++)o[i]=a[0|Math.random()*t];else for(o[8]=o[13]=o[18]=o[23]="-",o[14]="4",i=0;i<36;i++)o[i]||(n=0|16*Math.random(),o[i]=a[19==i?3&n|8:n]);return o.join("")}(3,10)+(new Date).getTime().toString().slice(2,13),n?L.set(i,s):O(i,s,null,"/",31536e6),t=s),t}function le(e){var t="tencentSig",i=void 0===L.type||"memory"===L.type;S.thirdAppConfig.secretKey&&(t="tencentThirdSig"),i?L.set(t,e):O(t,e,null,"/",31536e6),window.CURRENT_VISITORID=e}var de={qqface_Smile:"Smile",qqface_Grimac:"Grimac",qqface_Drool:"Drool",qqface_Scowl:"Scowl",qqface_Chill:"Chill",qqface_Sob:"Sob",qqface_Shy:"Shy",qqface_Silent:"Silent",qqface_Sleep:"Sleep",qqface_Cry:"Cry",qqface_Awkward:"Awkward",qqface_Angry:"Angry",qqface_Tongue:"Tongue",qqface_Grin:"Grin",qqface_Surprise:"Surprise",qqface_Frown:"Frown",qqface_CoolGuy:"CoolGuy",qqface_Helpless:"Helpless",qqface_Scream:"Scream",qqface_Puke:"Puke",qqface_Chuckle:"Chuckle",qqface_Joyful:"Joyful",qqface_Slight:"Slight",qqface_Smug:"Smug",qqface_Hungry:"Hungry",qqface_Drowsy:"Drowsy",qqface_Panic:"Panic",qqface_Sweat:"Sweat",qqface_Laugh:"Laugh",qqface_Commando:"Commando",qqface_Determined:"Determined",qqface_Scold:"Scold",qqface_Confused:"Confused",qqface_Shhh:"Shhh",qqface_Dizzy:"Dizzy",qqface_Torturing:"Torturing",qqface_Toasted:"Toasted",qqface_Skull:"Skull",qqface_Hammer:"Hammer",qqface_Bye:"Bye",qqface_Speechless:"Speechless",qqface_NosePick:"NosePick",qqface_Clap:"Clap",qqface_Embarrased:"Embarrased",qqface_Trick:"Trick","qqface_Hum!L":"Hum!L","qqface_Hum!R":"Hum!R",qqface_Yawn:"Yawn","qqface_Pooh-pooh":"Pooh-pooh",qqface_Shrunken:"Shrunken",qqface_TearingUp:"TearingUp",qqface_Sly:"Sly",qqface_Kiss:"Kiss","qqface_What!":"What!",qqface_Whimper:"Whimper",qqface_Cleaver:"Cleaver",qqface_Watermelon:"Watermelon",qqface_Beer:"Beer",qqface_Basketball:"Basketball",qqface_Pingpong:"Pingpong",qqface_Coffee:"Coffee",qqface_Rice:"Rice",qqface_Pig:"Pig",qqface_Rose:"Rose",qqface_Wilt:"Wilt",qqface_Lips:"Lips",qqface_Heart:"Heart",qqface_BrokenHeart:"BrokenHeart",qqface_Cake:"Cake",qqface_Lightning:"Lightning",qqface_Bomb:"Bomb",qqface_Knife:"Knife",qqface_Football:"Football",qqface_Beetle:"Beetle",qqface_Poop:"Poop",qqface_Moon:"Moon",qqface_Sun:"Sun",qqface_Gift:"Gift",qqface_Hug:"Hug",qqface_Thumbsup:"Thumbsup",qqface_Thumbsdown:"Thumbsdown",qqface_Shake:"Shake",qqface_Victory:"Victory",qqface_Salute:"Salute",qqface_Beckon:"Beckon",qqface_Fist:"Fist",qqface_Bad:"Bad",qqface_LoveYou:"LoveYou",qqface_NO:"NO",qqface_OK:"OK",qqface_Love:"Love",qqface_Blow_a_kiss:"Blow a kiss",qqface_Waddle:"Waddle",qqface_Tremble:"Tremble","qqface_Aaagh!":"Aaagh!",qqface_Twirl:"Twirl",qqface_Kowtow:"Kowtow",qqface_Turn_round:"Turn round",qqface_Rope_Skipping:"Rope Skipping",qqface_Wave_hand:"Wave hand",qqface_Excited:"Excited",qqface_Street_Dance:"Street Dance",qqface_Give_a_kiss:"Give a kiss",qqface_Tai_Chi_L:"Tai Chi L",qqface_Tai_Chi_R:"Tai Chi R",qqface_Bliss:"Bliss",qqface_Firecracker:"Firecracker",qqface_Lantern:"Lantern",qqface_Fortune:"Fortune",qqface_Karaoke:"Karaoke",qqface_Shopping:"Shopping",qqface_Email:"Email",qqface_Handsome:"Handsome",qqface_Hurray:"Hurray",qqface_Pray:"Pray",qqface_Furious:"Furious",qqface_Lollipop:"Lollipop",qqface_Drink_milk:"Drink milk",qqface_Noodles:"Noodles",qqface_Banana:"Banana",qqface_Plane:"Plane",qqface_Driving:"Driving",qqface_Highspeed_Rail_L:"Highspeed Rail L",qqface_Carriage:"Carriage",qqface_Highspeed_Rail_R:"Highspeed Rail R",qqface_Cloudy:"Cloudy",qqface_Rainy:"Rainy",qqface_Cash:"Cash",qqface_Panda:"Panda",qqface_Light_bulb:"Light bulb",qqface_Windmill:"Windmill",qqface_Alarm_Clock:"Alarm Clock",qqface_Umbrella:"Umbrella",qqface_Balloon:"Balloon",qqface_Ring:"Ring",qqface_Sofa:"Sofa",qqface_Toilet_Paper:"Toilet Paper",qqface_Medicine:"Medicine",qqface_Pistol:"Pistol",qqface_Frog:"Frog",common_page_title:"Online consultation",common_sendbtn_text:"Send",common_voicebtn_hold_text:"Hold to Talk",common_voicebtn_release_text:"Release to send",common_voicebtn_cancel_text:"Release to cancel",common_insert_photo_text:"Insert photo",common_insert_emoji_text:"Insert emoji",common_insert_businessCard_text:"Send business card",common_postarea_pc_placeholder:'Press "Enter" to send message, "Ctrl + Enter" change to new line',common_postarea_Macpc_placeholder:'Press "Enter" to send message, "Command + Enter" change to new line',common_postarea_mobile_placeholder:"Please enter",common_chatting_text:"Chatting",common_leave_message_text:"Message",common_chatting_with_text:"Chatting with $1",common_qq_chat_text:"QQ Chat",common_start_qq_chat_text:"Start QQchat",common_new_message_text:"New message",common_add_qq_friend_text:"Add QQ friends",common_confirm_text:"Confirm",common_cancel_text:"Cancel",common_tencent_certification:"certification-en",common_lang_en:"English",common_lang_zh:"Chinese","common_lang_zh-TW":"Traditional Chinese",common_tencent_translator:"Mr.Translator Auto Translation",common_tencent_translator_fail:"Translation failure-Mr.Translator",common_tencent_translator_only:"Only Chinese-English translation is supported-Mr.Translator",sysmsg_get_sigt_msg:"Receiving authenticated message",sysmsg_get_sigt_timeout_msg:'Timeout, please <a class="btn-refresh" href="javascript:;" onclick="location.reload();">refresh</a> to try again',sysmsg_get_sigt_fail_msg:'Access fails, please <a class="btn-refresh" href="javascript:;" onclick="location.reload();">refresh</a> to try again',sysmsg_load_corpinfo_msg:"Loading business information",sysmsg_load_corpinfo_fail_msg:"Failed to load business information",sysmsg_session_end_msg:"Consultation is ended",sysmsg_disconnect_msg:'Network error, please <a class="btn-refresh" href="javascript:;" onclick="location.reload();">refresh</a> to try again',sysmsg_connect_msg:"Successful connection to server, please wait to enter",sysmsg_connecting_msg:"System connecting, please wait",sysmsg_connect_error_msg:"Connection fails, automatically reconnects",sysmsg_reconnect_error_msg:"Connection fails, automatically reconnects",sysmsg_reconnect_fail_msg:'Network error, please <a class="btn-refresh" href="javascript:;" onclick="location.reload();">refresh</a> to try again',sysmsg_reconnecting_msg:"Reconnecting, please wait",sysmsg_reg_timeout_msg:'Timeout, please <a class="btn-refresh" href="javascript:;" onclick="location.reload();">refresh</a> to try again',sysmsg_reg_success_msg:"Successful connection",sysmsg_reg_start_msg:'You will be served through<a class="btn-refresh" href="https://qidian.qq.com" target="_blank">Tencent QD Service Cloud</a>',sysmsg_rereg_msg:'Network error, please <a class="btn-refresh" href="javascript:;" onclick="location.reload();">refresh</a> to try again',sysmsg_message_expired_msg:"This message is expired",sysmsg_feeback_msg:"Thank you for your advice",sysmsg_callqq_msg:'Agent is offline at the moment, you can press "QQchat" continue your consultation',sysmsg_callqq_corpuin_msg:'Agent is offline at the moment, you can press "QQchat" continue your consultation',sysmsg_upload_image_max_msg:"Photo number exceeds $1 limit",sysmsg_upload_image_size_msg:"Sending Failed due to exceed maximum limit.",sysmsg_upload_image_supported_msg:"Format not supported",sysmsg_upload_image_wifi_warning_msg:"Attention: sending photos under non-wifi networks may consume much cellular data",sysmsg_add_friend_fail_msg:"Add friends fails, please click name tag or copy QQ no. to add manually",sysmsg_graphic_msg_fail_msg:"Temporarily out of service, please try later",sysmsg_no_visitorid_error_msg:'Unable to get visitor id，please <a class="btn-refresh" href="javascript:;" onclick="location.reload();">refresh</a> to try again',sysmsg_change_kf_msg:'Need to switch customer agent?<br/><a href="javascript:;" class="btn-newkf">Confirm to switch</a>',sysmsg_auto_change_kf_msg:"Last agent is offline，you are automatically being switched to a new one",sysmsg_change_b2c_kf_msg:"Conversation has been switched to $1",sysmsg_msg_revoke_msg:" has recalled a message",sysmsg_msg_current_service_lang:"The service language is ",sysmsg_msg_change_service_lang:"Service language changed to ",sysmsg_msg_get_third_visitor_id_error:"Sorry！There are too many people accessing the website at this time. Please try again later.",sysmsg_send_product_xml_msg:'Product information has been sent, you will be served via<a class="btn-link" href="https://qidian.qq.com/branding/service_en.html" target="_blank">Tencent QD Service Cloud</a>',sysmsg_send_sheet_xml_msg:'Sourcing request has been sent, you will be served via<a class="btn-link" href="https://qidian.qq.com/branding/service_en.html" target="_blank">Tencent QD Service Cloud</a>',chat_max_post_limit_text:"Content exceeds text limit",chat_history_msg_get_text:"Click to load historical messages",chat_history_msg_get_error:"Failed to load history message",chat_history_msg_loading_text:"Loading historical messages",chat_offline_msg_loading_text:"Loading new messages",chat_offline_msg_fail_text:"Fail to receive new messages, please click to retry",chat_offline_msg_over_text:"New message",chat_menu_msg_loading_text:"Loading navigation",chat_menu_msg_fail_text:"Fail to receive navigation, click to retry",chat_menu_msg_history_expired_text:"Historical messages has expired",chat_graphic_msg_readmore_text:"Read more",chat_feedback_title_text:"Please rate for the service",chat_feedback_submit_text:"Submit",chat_feedback_postarea_placeholder:"Your advice is mostly welcomed :)",chat_feedback_submitting_text:"Submitting",chat_feedback_success_msg:"Submitted successfully",chat_feedback_fail_msg:"Submission Failed",chat_feedback_error_msg:"Network error, please try again",chat_feedback_very_dissatisfied_text:"Very Dissatisfied",chat_feedback_dissatisfied_text:"Dissatisfied",chat_feedback_neutral_text:"Neutral",chat_feedback_satisfied_text:"Satisfied",chat_feedback_very_satisfied_text:"Very Satisfied",chat_add_friend_fetching_protocol_msg:"Fetching protocol",chat_add_friend_copy_success_msg:"Successful copy",chat_add_friend_fail_text:"Fail",chat_add_friend_fail_get_number_fail_text:"Failed to get numerical data",chat_add_friend_fail_no_text_selected_text:"No text selected, please copy it manually",chat_add_friend_fail_browser_not_support_text:"Browser does not support, please copy it manually",xml_product_name:"Product Name",xml_product_exhibition_area:"Exhibition Area",xml_product_category:"Product Category",xml_purchase_quantity:"Purchase Quantity",xml_purchase_unit:"Purchase Unit",xml_buyer_name:"Buyer Name",xml_buyer_location:"Buyer Location",xml_buyer_tag:"Buyer Tag"},fe={qqface_Smile:"微笑",qqface_Grimac:"撇嘴",qqface_Drool:"色",qqface_Scowl:"发呆",qqface_Chill:"得意",qqface_Sob:"流泪",qqface_Shy:"害羞",qqface_Silent:"闭嘴",qqface_Sleep:"睡",qqface_Cry:"大哭",qqface_Awkward:"尴尬",qqface_Angry:"发怒",qqface_Tongue:"调皮",qqface_Grin:"呲牙",qqface_Surprise:"惊讶",qqface_Frown:"难过",qqface_CoolGuy:"酷",qqface_Helpless:"冷汗",qqface_Scream:"抓狂",qqface_Puke:"吐",qqface_Chuckle:"偷笑",qqface_Joyful:"可爱",qqface_Slight:"白眼",qqface_Smug:"傲慢",qqface_Hungry:"饥饿",qqface_Drowsy:"困",qqface_Panic:"惊恐",qqface_Sweat:"流汗",qqface_Laugh:"憨笑",qqface_Commando:"大兵",qqface_Determined:"奋斗",qqface_Scold:"咒骂",qqface_Confused:"疑问",qqface_Shhh:"嘘...",qqface_Dizzy:"晕",qqface_Torturing:"折磨",qqface_Toasted:"衰",qqface_Skull:"骷髅",qqface_Hammer:"敲打",qqface_Bye:"再见",qqface_Speechless:"擦汗",qqface_NosePick:"抠鼻",qqface_Clap:"鼓掌",qqface_Embarrased:"糗大了",qqface_Trick:"坏笑","qqface_Hum!L":"左哼哼","qqface_Hum!R":"右哼哼",qqface_Yawn:"哈欠","qqface_Pooh-pooh":"鄙视",qqface_Shrunken:"委屈",qqface_TearingUp:"快哭了",qqface_Sly:"阴险",qqface_Kiss:"亲亲","qqface_What!":"吓",qqface_Whimper:"可怜",qqface_Cleaver:"菜刀",qqface_Watermelon:"西瓜",qqface_Beer:"啤酒",qqface_Basketball:"篮球",qqface_Pingpong:"乒乓",qqface_Coffee:"咖啡",qqface_Rice:"饭",qqface_Pig:"猪头",qqface_Rose:"玫瑰",qqface_Wilt:"凋谢",qqface_Lips:"示爱",qqface_Heart:"爱心",qqface_BrokenHeart:"心碎",qqface_Cake:"蛋糕",qqface_Lightning:"闪电",qqface_Bomb:"炸弹",qqface_Knife:"刀",qqface_Football:"足球",qqface_Beetle:"瓢虫",qqface_Poop:"便便",qqface_Moon:"月亮",qqface_Sun:"太阳",qqface_Gift:"礼物",qqface_Hug:"拥抱",qqface_Thumbsup:"强",qqface_Thumbsdown:"弱",qqface_Shake:"握手",qqface_Victory:"胜利",qqface_Salute:"抱拳",qqface_Beckon:"勾引",qqface_Fist:"拳头",qqface_Bad:"差劲",qqface_LoveYou:"爱你",qqface_NO:"NO",qqface_OK:"OK",qqface_Love:"爱情",qqface_Blow_a_kiss:"飞吻",qqface_Waddle:"跳跳",qqface_Tremble:"发抖","qqface_Aaagh!":"怄火",qqface_Twirl:"转圈",qqface_Kowtow:"磕头",qqface_Turn_round:"回头",qqface_Rope_Skipping:"跳绳",qqface_Wave_hand:"挥手",qqface_Excited:"激动",qqface_Street_Dance:"街舞",qqface_Give_a_kiss:"献吻",qqface_Tai_Chi_L:"左太极",qqface_Tai_Chi_R:"右太极",qqface_Bliss:"双喜",qqface_Firecracker:"鞭炮",qqface_Lantern:"灯笼",qqface_Fortune:"发财",qqface_Karaoke:"K歌",qqface_Shopping:"购物",qqface_Email:"邮件",qqface_Handsome:"帅",qqface_Hurray:"喝彩",qqface_Pray:"祈祷",qqface_Furious:"爆筋",qqface_Lollipop:"棒棒糖",qqface_Drink_milk:"喝奶",qqface_Noodles:"下面",qqface_Banana:"香蕉",qqface_Plane:"飞机",qqface_Driving:"开车",qqface_Highspeed_Rail_L:"高铁左车头",qqface_Carriage:"车厢",qqface_Highspeed_Rail_R:"高铁右车头",qqface_Cloudy:"多云",qqface_Rainy:"下雨",qqface_Cash:"钞票",qqface_Panda:"熊猫",qqface_Light_bulb:"灯泡",qqface_Windmill:"风车",qqface_Alarm_Clock:"闹钟",qqface_Umbrella:"大伞",qqface_Balloon:"彩球",qqface_Ring:"钻戒",qqface_Sofa:"沙发",qqface_Toilet_Paper:"纸巾",qqface_Medicine:"药",qqface_Pistol:"手枪",qqface_Frog:"青蛙",common_page_title:"在线咨询",common_sendbtn_text:"发送",common_voicebtn_hold_text:"按住 说话",common_voicebtn_release_text:"松开 结束",common_voicebtn_cancel_text:"松开手指，取消发送",common_insert_photo_text:"上传图片",common_insert_emoji_text:"输入表情",common_insert_businessCard_text:"发送名片",common_postarea_pc_placeholder:"请输入，按Enter直接发送消息，Ctrl+Enter换行",common_postarea_Macpc_placeholder:"请输入，按Enter直接发送消息，Command+Enter换行",common_postarea_mobile_placeholder:"请点击输入",common_chatting_text:"交谈中",common_leave_message_text:"留言了",common_chatting_with_text:"与$1交谈中",common_qq_chat_text:"去QQ交谈",common_start_qq_chat_text:"发起QQ会话",common_new_message_text:"你有【新消息】",common_add_qq_friend_text:"添加QQ联系人",common_confirm_text:"确定",common_cancel_text:"取消",common_tencent_certification:"",common_lang_en:"英语",common_lang_zh:"简体中文","common_lang_zh-TW":"繁体中文",common_tencent_translator:"腾讯翻译君实时翻译",common_tencent_translator_fail:"翻译失败-腾讯翻译君",common_tencent_translator_only:"仅支持中英互译-腾讯翻译君",sysmsg_get_sigt_msg:"正在获取鉴权信息",sysmsg_get_sigt_timeout_msg:'接入超时，请<a class="btn-refresh" href="javascript:;" onclick="location.reload();">刷新页面</a>重试',sysmsg_get_sigt_fail_msg:'接入失败，请<a class="btn-refresh" href="javascript:;" onclick="location.reload();">刷新页面</a>重试',sysmsg_load_corpinfo_msg:"正在加载企业信息",sysmsg_load_corpinfo_fail_msg:"企业信息拉取失败",sysmsg_session_end_msg:"本次咨询已结束，发送消息可开始新的咨询",sysmsg_disconnect_msg:'当前会话网络已中断，请<a class="btn-refresh" href="javascript:;" onclick="location.reload();">刷新页面</a>或再发条消息试试',sysmsg_connect_msg:"与服务器连接成功，请等待接入",sysmsg_connecting_msg:"正在与服务器建立连接",sysmsg_connect_error_msg:"服务连接失败，即将自动为您重新建立连接",sysmsg_reconnect_error_msg:"服务连接失败，即将自动为您重新建立连接",sysmsg_reconnect_fail_msg:'当前网络有点问题，请<a class="btn-refresh" href="javascript:;" onclick="location.reload();">刷新页面</a>或再发条消息试试',sysmsg_reconnecting_msg:"正在重新与服务器建立连接",sysmsg_reg_timeout_msg:'建立会话超时，请<a class="btn-refresh" href="javascript:;" onclick="location.reload();">刷新页面</a>再试试',sysmsg_reg_success_msg:"接入成功",sysmsg_reg_start_msg:'对方将用<a class="btn-refresh" href="https://qidian.qq.com" target="_blank">企点客服</a>为您服务',sysmsg_rereg_msg:'网络有点问题无法接入客户，请<a class="btn-refresh" href="javascript:;" onclick="location.reload();">刷新页面</a>再试试',sysmsg_message_expired_msg:"此消息已过期",sysmsg_feeback_msg:"感谢您的意见和建议，我们将继续努力",sysmsg_callqq_msg:"客服暂时不在线，您可直接发起QQ会话进行咨询",sysmsg_callqq_corpuin_msg:"客服暂时不在线，您可直接发起QQ会话进行咨询",sysmsg_upload_image_max_msg:"图片数目超过最大$1张限制",sysmsg_upload_image_size_msg:"图片过大，发送失败",sysmsg_upload_image_supported_msg:"格式不支持",sysmsg_upload_image_wifi_warning_msg:"温馨提示：非wifi网络下发送图片可能会耗费较多流量",sysmsg_add_friend_fail_msg:'添加好友失败，请点击名片重试或<a href="javascript:;" class="btn-paste">复制QQ号</a>手动添加',sysmsg_graphic_msg_fail_msg:"服务暂不可用，请稍后重试",sysmsg_no_visitorid_error_msg:'无法获取访客ID，请<a class="btn-refresh" href="javascript:;" onclick="location.reload();">刷新页面</a>重试',sysmsg_change_kf_msg:'需要切换客服人员吗?<br/><a href="javascript:;" class="btn-newkf">确认切换客服</a>',sysmsg_auto_change_kf_msg:"原客服不在线，已为您自动更换在线的客服",sysmsg_change_b2c_kf_msg:"会话已转接到$1，欢迎继续咨询",sysmsg_msg_revoke_msg:"撤回了一条消息",sysmsg_msg_current_service_lang:"当前服务语言是",sysmsg_msg_change_service_lang:"服务语言已更换为",sysmsg_msg_get_third_visitor_id_error:"很抱歉当前咨询人数过多，请稍后再试。",sysmsg_send_product_xml_msg:'商品信息已发送，对方将使用<a class="btn-link" href="https://qidian.qq.com/branding/service.html" target="_blank">企点客服</a>为您服务',sysmsg_send_sheet_xml_msg:'意向单信息已发送，对方将使用<a class="btn-link" href="https://qidian.qq.com/branding/service.html" target="_blank">企点客服</a>为您服务',chat_max_post_limit_text:"发送消息过长，请分条发送。",chat_history_msg_get_text:"点击加载更多历史消息",chat_history_msg_get_error:"加载历史消息失败",chat_history_msg_loading_text:"正在加载历史消息",chat_offline_msg_loading_text:"正在加载新消息",chat_offline_msg_fail_text:"新消息加载失败，点击重试",chat_offline_msg_over_text:"以下为未读消息",chat_menu_msg_loading_text:"正在加载菜单导航",chat_menu_msg_fail_text:"菜单导航加载失败，点击重试",chat_menu_msg_history_expired_text:"历史数据已失效",chat_graphic_msg_readmore_text:"阅读原文",chat_feedback_title_text:"请为本次服务打分",chat_feedback_submit_text:"提交",chat_feedback_postarea_placeholder:"感谢您的评分，可留下其他意见或建议",chat_feedback_submitting_text:"正在提交评价",chat_feedback_success_msg:"提交成功",chat_feedback_fail_msg:"提交失败",chat_feedback_error_msg:"网络错误，请重试",chat_feedback_very_dissatisfied_text:"很不满意",chat_feedback_dissatisfied_text:"不满意",chat_feedback_neutral_text:"一般",chat_feedback_satisfied_text:"满意",chat_feedback_very_satisfied_text:"很满意",chat_add_friend_fetching_protocol_msg:"正在获取添加协议",chat_add_friend_copy_success_msg:"复制成功",chat_add_friend_fail_text:"失败",chat_add_friend_fail_get_number_fail_text:"获取号码数据失败",chat_add_friend_fail_no_text_selected_text:"没有选中文字，请手工复制",chat_add_friend_fail_browser_not_support_text:"浏览器不支持，请手工复制",xml_product_name:"商品名称",xml_product_exhibition_area:"商品展区",xml_product_category:"商品类别",xml_purchase_quantity:"采购数量",xml_purchase_unit:"采购单位",xml_buyer_name:"采购商名称",xml_buyer_location:"采购商所在地",xml_buyer_tag:"采购商属性标签"},pe={qqface_Smile:"微笑",qqface_Grimac:"憋嘴",qqface_Drool:"色",qqface_Scowl:"發呆",qqface_Chill:"得意",qqface_Sob:"流淚",qqface_Shy:"害羞",qqface_Silent:"閉嘴",qqface_Sleep:"睡",qqface_Cry:"大哭",qqface_Awkward:"尷尬",qqface_Angry:"發怒",qqface_Tongue:"調皮",qqface_Grin:"呲牙",qqface_Surprise:"驚訝",qqface_Frown:"難過",qqface_CoolGuy:"酷",qqface_Helpless:"冷汗",qqface_Scream:"抓狂",qqface_Puke:"吐",qqface_Chuckle:"偷笑",qqface_Joyful:"可愛",qqface_Slight:"白眼",qqface_Smug:"傲慢",qqface_Hungry:"飢餓",qqface_Drowsy:"困",qqface_Panic:"驚恐",qqface_Sweat:"流汗",qqface_Laugh:"憨笑",qqface_Commando:"大兵",qqface_Determined:"奮鬥",qqface_Scold:"咒罵",qqface_Confused:"疑問",qqface_Shhh:"噓...",qqface_Dizzy:"暈",qqface_Torturing:"折磨",qqface_Toasted:"蓑",qqface_Skull:"骷顱",qqface_Hammer:"敲打",qqface_Bye:"再見",qqface_Speechless:"擦汗",qqface_NosePick:"摳鼻",qqface_Clap:"鼓掌",qqface_Embarrased:"糗大了",qqface_Trick:"壞笑","qqface_Hum!L":"左哼哼","qqface_Hum!R":"右哼哼",qqface_Yawn:"哈欠","qqface_Pooh-pooh":"鄙視",qqface_Shrunken:"委屈",qqface_TearingUp:"快哭了",qqface_Sly:"陰險",qqface_Kiss:"親親","qqface_What!":"嚇",qqface_Whimper:"可憐",qqface_Cleaver:"菜刀",qqface_Watermelon:"西瓜",qqface_Beer:"啤酒",qqface_Basketball:"籃球",qqface_Pingpong:"乒乓",qqface_Coffee:"咖啡",qqface_Rice:"飯",qqface_Pig:"豬頭",qqface_Rose:"玫瑰",qqface_Wilt:"凋謝",qqface_Lips:"示愛",qqface_Heart:"愛心",qqface_BrokenHeart:"心碎",qqface_Cake:"蛋糕",qqface_Lightning:"閃電",qqface_Bomb:"炸彈",qqface_Knife:"刀",qqface_Football:"足球",qqface_Beetle:"瓢蟲",qqface_Poop:"便便",qqface_Moon:"月亮",qqface_Sun:"太陽",qqface_Gift:"禮物",qqface_Hug:"擁抱",qqface_Thumbsup:"強",qqface_Thumbsdown:"弱",qqface_Shake:"握手",qqface_Victory:"勝利",qqface_Salute:"抱拳",qqface_Beckon:"勾引",qqface_Fist:"拳頭",qqface_Bad:"差勁",qqface_LoveYou:"愛你",qqface_NO:"NO",qqface_OK:"OK",qqface_Love:"愛情",qqface_Blow_a_kiss:"飛吻",qqface_Waddle:"跳跳",qqface_Tremble:"發抖","qqface_Aaagh!":"惱火",qqface_Twirl:"轉圈",qqface_Kowtow:"磕頭",qqface_Turn_round:"回頭",qqface_Rope_Skipping:"跳繩",qqface_Wave_hand:"揮手",qqface_Excited:"激動",qqface_Street_Dance:"街舞",qqface_Give_a_kiss:"獻吻",qqface_Tai_Chi_L:"左太極",qqface_Tai_Chi_R:"右太極",qqface_Bliss:"雙喜",qqface_Firecracker:"鞭炮",qqface_Lantern:"燈籠",qqface_Fortune:"發財",qqface_Karaoke:"K歌",qqface_Shopping:"購物",qqface_Email:"郵件",qqface_Handsome:"帥",qqface_Hurray:"喝采",qqface_Pray:"祈禱",qqface_Furious:"爆筋",qqface_Lollipop:"棒棒糖",qqface_Drink_milk:"喝奶",qqface_Noodles:"下面",qqface_Banana:"香蕉",qqface_Plane:"飛機",qqface_Driving:"開車",qqface_Highspeed_Rail_L:"高鐵左車頭",qqface_Carriage:"车厢",qqface_Highspeed_Rail_R:"高鐵右車頭",qqface_Cloudy:"多雲",qqface_Rainy:"下雨",qqface_Cash:"鈔票",qqface_Panda:"熊貓",qqface_Light_bulb:"燈泡",qqface_Windmill:"風車",qqface_Alarm_Clock:"鬧鐘",qqface_Umbrella:"大傘",qqface_Balloon:"彩球",qqface_Ring:"鑽戒",qqface_Sofa:"沙發",qqface_Toilet_Paper:"紙巾",qqface_Medicine:"藥",qqface_Pistol:"手槍",qqface_Frog:"青蛙",common_page_title:"線上咨詢",common_sendbtn_text:"發送",common_voicebtn_hold_text:"按住 說話",common_voicebtn_release_text:"放開 結束",common_voicebtn_cancel_text:"放開手指，取消發送",common_insert_photo_text:"上傳圖片",common_insert_emoji_text:"輸入表情",common_insert_businessCard_text:"發送名片",common_postarea_pc_placeholder:"請輸入，按Enter直接發送消息，Ctrl+Enter換行",common_postarea_Macpc_placeholder:"請輸入，按Enter直接發送消息，Command+Enter換行",common_postarea_mobile_placeholder:"請點擊輸入",common_chatting_text:"交談中",common_leave_message_text:"留言了",common_chatting_with_text:"與$1交談中",common_qq_chat_text:"去QQ交談",common_start_qq_chat_text:"發起QQ會話",common_new_message_text:"你有【新消息】",common_add_qq_friend_text:"添加QQ聯絡人",common_confirm_text:"確定",common_cancel_text:"取消",common_tencent_certification:"",common_lang_en:"英語",common_lang_zh:"簡體中文","common_lang_zh-TW":"繁體中文",common_tencent_translator:"騰訊翻譯君實時翻譯",common_tencent_translator_fail:"翻譯失敗-騰訊翻譯君",common_tencent_translator_only:"僅支持中英互譯-騰訊翻譯君",sysmsg_get_sigt_msg:"正在查看權限設定",sysmsg_get_sigt_timeout_msg:'接入超時，請<a class="btn-refresh" href="javascript:;" onclick="location.reload();">重新加載頁面</a>重試',sysmsg_get_sigt_fail_msg:'接入失敗，請<a class="btn-refresh" href="javascript:;" onclick="location.reload();">重新加載頁面</a>重試',sysmsg_load_corpinfo_msg:"正在加載企業信息",sysmsg_load_corpinfo_fail_msg:"企業信息獲取失敗",sysmsg_session_end_msg:"本次咨詢已結束，發送消息可開始新的咨詢",sysmsg_disconnect_msg:'當前網路已中斷，請<a class="btn-refresh" href="javascript:;" onclick="location.reload();">重新加載頁面</a>或再發條消息試試',sysmsg_connect_msg:"與伺服器連接成功，請等待接入",sysmsg_connecting_msg:"正在與伺服器建立連接",sysmsg_connect_error_msg:"服務連接失敗，即將重新為您建立連接",sysmsg_reconnect_error_msg:"服務連接失敗，即將重新為您建立連接",sysmsg_reconnect_fail_msg:'當前網路有點問題，請<a class="btn-refresh" href="javascript:;" onclick="location.reload();">重新加載頁面</a>或再發條消息試試',sysmsg_reconnecting_msg:"正在重新與伺服器建立連接",sysmsg_reg_timeout_msg:'建立會話超時，請<a class="btn-refresh" href="javascript:;" onclick="location.reload();">重新加載頁面</a>再試試',sysmsg_reg_success_msg:"接入成功",sysmsg_reg_start_msg:'對方將用<a class="btn-refresh" href="https://qidian.qq.com" target="_blank">企點客服</a>為您服務',sysmsg_rereg_msg:'網路有些問題無法接入客戶，請<a class="btn-refresh" href="javascript:;" onclick="location.reload();">重新加載頁面</a>再試試',sysmsg_message_expired_msg:"此消息已過期",sysmsg_feeback_msg:"感謝您的意見與建議，我們將繼續努力",sysmsg_callqq_msg:"客服暫時不在線上，您可直接發起QQ會話進行咨詢",sysmsg_callqq_corpuin_msg:"客服暫時不在線上，您可直接發起QQ會話進行咨詢",sysmsg_upload_image_max_msg:"圖片數量超過最大$1張限制",sysmsg_upload_image_size_msg:"圖片過大，發送失敗",sysmsg_upload_image_supported_msg:"格式不支持",sysmsg_upload_image_wifi_warning_msg:"溫馨提示：非wifi網路下發送圖片可能會耗費較多流量",sysmsg_add_friend_fail_msg:'添加好友失敗，請點擊名片重試或<a href="javascript:;" class="btn-paste">複製QQ號</a>手動添加',sysmsg_graphic_msg_fail_msg:"服務暫時無法使用，請稍候重試",sysmsg_no_visitorid_error_msg:'無法取得訪客ID，請<a class="btn-refresh" href="javascript:;" onclick="location.reload();">重新加載頁面</a>重試',sysmsg_change_kf_msg:'需要切換服務人員嗎？<br/><a href="javascript:;" class="btn-newkf">確認切換客服</a>',sysmsg_auto_change_kf_msg:"原客服不在線上，已為您自動更換在線的客服",sysmsg_change_b2c_kf_msg:"會話已轉接到$1，歡迎繼續咨詢",sysmsg_msg_revoke_msg:"撤回了一條消息",sysmsg_msg_current_service_lang:"當前服務語言是",sysmsg_msg_change_service_lang:"服務語言已更換為",sysmsg_msg_get_third_visitor_id_error:"很抱歉當前諮詢人數過多，請稍後再試。",sysmsg_send_product_xml_msg:'商品信息已發送，對方將使用<a class="btn-link" href="https://qidian.qq.com/branding/service.html" target="_blank">企點客服</a>為您服務',sysmsg_send_sheet_xml_msg:'意向單信息已發送，對方將使用<a class="btn-link" href="https://qidian.qq.com/branding/service.html" target="_blank">企點客服</a>為您服務',chat_max_post_limit_text:"發送消息過長，請分條發送。",chat_history_msg_get_text:"點擊加載更多歷史消息",chat_history_msg_get_error:"加載歷史消息失敗",chat_history_msg_loading_text:"正在加載歷史消息",chat_offline_msg_loading_text:"正在加載新消息",chat_offline_msg_fail_text:"新消息加載失敗，點擊重試",chat_offline_msg_over_text:"以下為未讀消息",chat_menu_msg_loading_text:"正在加載菜單導航",chat_menu_msg_fail_text:"菜單導航加載失敗，點擊重試",chat_menu_msg_history_expired_text:"歷史紀錄已失效",chat_graphic_msg_readmore_text:"閱讀原文",chat_feedback_title_text:"請為本次服務打分",chat_feedback_submit_text:"提交",chat_feedback_postarea_placeholder:"感謝您的評分，可留下其他意見或建議",chat_feedback_submitting_text:"正在提交評價",chat_feedback_success_msg:"提交成功",chat_feedback_fail_msg:"提交失敗",chat_feedback_error_msg:"網路錯誤，請重試",chat_feedback_very_dissatisfied_text:"很不滿意",chat_feedback_dissatisfied_text:"不滿意",chat_feedback_neutral_text:"一般",chat_feedback_satisfied_text:"滿意",chat_feedback_very_satisfied_text:"很滿意",chat_add_friend_fetching_protocol_msg:"正在獲取添加協議",chat_add_friend_copy_success_msg:"複製成功",chat_add_friend_fail_text:"失敗",chat_add_friend_fail_get_number_fail_text:"獲取號碼失敗",chat_add_friend_fail_no_text_selected_text:"沒有選中文字，請手工複製",chat_add_friend_fail_browser_not_support_text:"瀏覽器不支持，請手工複製",xml_product_name:"商品名稱",xml_product_exhibition_area:"商品展區",xml_product_category:"商品類別",xml_purchase_quantity:"採購數量",xml_purchase_unit:"採購單位",xml_buyer_name:"採購商名稱",xml_buyer_location:"採購商所在地",xml_buyer_tag:"採購商屬性標籤"},ue='\n<div class="translate-wrapper">\n    <div class="translate-content"><%# o.text %></div>\n    <div class="translate-bottom">$$$common_tencent_translator$$$<div class="translate-icon"></div></div>\n</div>\n',ge='\n<div class="translate-wrapper">\n    <div class="translate-bottom">$$$common_tencent_translator_fail$$$<div class="translate-icon"></div></div>\n</div>\n',me='\n<div class="translate-wrapper">\n    <div class="translate-bottom">$$$common_tencent_translator_only$$$<div class="translate-icon"></div></div>\n</div>\n',_e={"en-us":"en","zh-cn":"zh","zh-tw":"zh-TW"},he=["en","zh","zh-TW"],ve="[face_split_sign]";function qe(){var e="zh-cn",e=S.isInIframe?S.lang||"":J(window.location.href,"qidian_lang")||"";return S.lang=e.toLowerCase()||"zh-cn",$.i18n({locale:S.lang}),$.i18n().load({"zh-cn":fe,"en-us":de,"zh-tw":pe})}function ye(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:"").replace(/\${2,3}(.*?)\${2,3}/g,function(e,t){return $.i18n(t)})}function be(e){var t=$.Deferred(),i=S.isInIframe,n=S.win.location.href,a=void 0,o=void 0;i?(a=+e.translateSwitch||0,o=_e[S.lang],e.kfuin,e.visitorid||e.visitorId):(a=+J(n,"translateSwitch")||0,o=_e[S.lang],J(n,"kfuin"),ce({active:!!J(n,"visitorId"),url:n}));return a&&(S.translate.translateSwitch=!!a,S.translate.translateLang=o),t.resolve(),t.promise()}function Te(g,m){var _=S.translate;if(_.translateSwitch&&_.translateAuto){var h=g.find(".bubble");if(h){var v=void 0,e=m.originMsgContent||m.originData||m.data,q=[],t=[];if(!(t=(e=e.replace(/\[f_(.*?)\]/g,function(e,t){return q.push(e),ve})).split(ve)).join("").length)return;var i={source_lang:"auto",source_text_list:t,target_lang:_.translateLang,terminal_type:4};S.thirdAppConfig&&(i.kfuin=S.receptionist.kfUin,i.visitorId=S.thirdAppConfig.visitorId,i.secretKey=S.thirdAppConfig.secretKey),$.ajax({url:T.CGI_URL.TEXT_TRANSLATE+"?kfuin="+S.receptionist.kfUin,data:JSON.stringify(i),type:"POST",timeout:1e4,contentType:"application/json; charset=utf-8",dataType:"json",success:function(e){if(0==+e.code){var t=e.data||{};if(t.source_lang===_.translateLang)return;if(t.source_lang!==_.translateLang&&-1!==he.indexOf(t.source_lang)){for(var i=S.receptionist,n=i.kfUin,a=i.visitorId,o=[m.sortseq,m.type].join(""),s="",r=t.target_text_list||[],c=0;c<r.length;c++)s=s+r[c]+(q[c]||"");f=s,f=void 0!==S.win.emoji?S.win.emoji.replace_unified(f):f,u=S.isMobile?T.CGI_URL.QQ_FACE:T.CGI_URL.COMP_SOURCE_URL+"img/qq/",s=f.replace(/\[(.*?)\]/g,function(e,t){var i;if(0==t.indexOf("f")){t=t.match(/\d+/g);for(var n=0;n<W.index.length;n++)if(W.index[n]==t){i=n;break}}else if("b2c"!=p)for(n=0;n<W.locale.length;n++)if($.i18n(W.locale[n])==t){i=n;break}return i||0===i?'<img src="'+u+i+'.png" class="face"/>':e});var l="kf"+n+"vId"+a+"index"+o,d=L.get(l);d&&((d=JSON.parse(d)).translateData=s,L.set(l,JSON.stringify(d))),v=$($.tmpl(ye(ue),{text:s}))}else v=$($.tmpl(ye(ge),{}))}else v=-510==+e.code?$($.tmpl(ye(me),{})):$($.tmpl(ye(ge),{}));var f,p,u;v.find(".translate-icon").on(S.clickName,function(){Se()}),h.append(v),w.chatListWrap.scrollTop(w.chatListWrap.scrollTop()+g.height())},error:function(e){(v=$($.tmpl(ye(ge),{}))).find(".translate-icon").on(S.clickName,function(){Se()}),h.append(v),w.chatListWrap.scrollTop(w.chatListWrap.scrollTop()+g.height()),BJ_REPORT.report("translate text error"),BJ_REPORT.report(JSON.stringify(e))}})}}}function Se(){re()}function we(e,t){var i=this;S.isInIframe?void 0!==t?be(t).then(function(){i.render(),e&&e()}):qe().then(function(){e&&e()}):$.when(qe(),be()).then(function(){i.render(),e&&e()})}function Ce(e,t){var i=0<arguments.length&&void 0!==e?e:"add",n=1<arguments.length&&void 0!==t?t:"qq",a=w.header.find("span.title"),o=S.isMobile?"H5":"PC";"add"==i?"qq"==n&&0==w.callGroup.find(".btn-callqq").length?w.callGroup.append(ye(T.HEADER_TPL[o].BTN_CALL_QQ)):"tel"==n&&0==w.callGroup.find(".btn-calltel").length&&w.callGroup.append(ye(T.HEADER_TPL[o].BTN_CALL_TEL)):"remove"==i&&("qq"==n?w.callGroup.find(".btn-callqq").remove():"tel"==n&&w.callGroup.find(".btn-calltel").remove()),2==w.callGroup.children().length?a.addClass("title-mini"):a.removeClass("title-mini")}function xe(e){var n,a,o,s,r=+new Date;$.ajax({type:"HEAD",url:T.CGI_URL.GET_SERVER_TIME+"?kfuin="+e,timeout:1e3,success:function(e,t,i){n=+new Date,a=+new Date(i.getResponseHeader("Date")),o=parseInt((n-r)/2),s=a+o-n,S.serverClientTimeDiff=s,BJ_REPORT.report("Time Diff "+s)}})}var ke={get:function(e){return Ee()?sessionStorage.getItem(e):A(e)},set:function(e,t){Ee()?sessionStorage.setItem(e,t):A(e)||O(e,t,null,"/",0)}};function Ee(){try{var e,t=Date.now();if(sessionStorage.setItem(t,t),e=sessionStorage.getItem(t),sessionStorage.removeItem(t),t!=e)throw new Error;return 1}catch(e){}}function Ie(){var e=S.win.location.href,t="0"==J(e,"linkType")?2:3,i=S.wpaDetail,n=S.receptionist,a=i.clickid,o={mid:"",id:i.wpaId,kfuin:n.kfUin,kfext:J(e,"kfext"),cate:J(e,"cate"),type:J(e,"type"),eventtp:t,tpForm:t,refurl:void 0!==document.referrer?document.referrer:"",ua:S.userAgent,eptype:S.isMobile?2:1,pid:J(e,"_pid")||a,clickid:a,clickType:6,visitorid:n.visitorId,tptype:9};J(e,"sm")&&(o.sm=J(e,"sm")),31!=J(e,"auth")&&$.ajax({url:T.CGI_URL.ACT_RPT,data:o,type:"POST",timeout:3e3,dataType:"json"})}var Re=function(e){var t={timer:"",delay:1e4,consuming:0};return t.timer=setInterval(function(){!e.isGet&&t.consuming<e.timeout?(t.consuming+=t.delay,BJ_REPORT.report(e.text+t.consuming),t.consuming==e.timeout&&e.callback(t.consuming)):clearInterval(t.timer)},t.delay),t.timer},$e={SESSION_START:8,SESSION_START_SUCCESS:9,SESSION_START_FAIL:10,RECONNECT:11,RECONNECT_ERROR:12,SEND_C2B:13,SEND_C2B_SUCCESS:14,SEND_C2B_FAIL:15,RECEIVE_B2C:16},Oe=function(e){!function(e){var t=[],i=+new Date,n="log_"+i,a=t[n]=new Image;a.onload=a.onerror=function(){t[n]=null},e+=(-1<e.indexOf("?")?"&":"?")+i,a.src=e}("https://fereport.qidian.qq.com/report/webim?"+$.param($.extend({},e,{visitorid:S.receptionist.visitorId,kfuin:S.receptionist.kfUin,tid:1000001,count:1})))};function Ae(e){var t={auth:1,auth_pid:e.auth_pid||J(window.location.href,"auth_pid"),auth_paccount:e.auth_paccount||J(window.location.href,"auth_paccount")};S.authConfig=t;var i=window.location.host,n="https://admin.qidian.qq.com/hb/view/h5/wpa_authorization";-1<i.indexOf("localhost")?n="https://local.qiye.qq.com:8001/page/wpa-authorization/pc/index.html":(-1<i.indexOf("webpage.qidian.qq.com")||-1<i.indexOf("shpqc.dsnq.qq.com"))&&(n="https://oaadmin.qidian.qq.com/hb/view/h5/wpa_authorization");var a="auth_pid="+t.auth_pid+"&auth_paccount="+t.auth_paccount;return n+"?"+(S.isMobile?"auth_mode=1&platform=h5&from=webim":"auth_mode=0&platform=pc&from=webim")+"&"+a+"&"+$.param(e)}var Me=function(e){var t=document.createElement("iframe");return t.src=e.src,document.body.insertBefore(t,document.body.firstChild),t},Le=function(t){if(null!=document.querySelector("#"+t.id))return!1;var e=document.createElement("iframe");return e.src=t.src,e.setAttribute("id",t.id),e.style.cssText="position: fixed; width: 100%; height: 100%; top: 0; left: 0; z-index: 999; border: none; background: none;",document.body.insertBefore(e,document.body.firstChild),window[t.id+"BindMessage"]||(window.addEventListener("message",function(e){e.data&&e.data.id===t.id&&"close"===e.data.cmd&&($("#"+t.id).remove(),window[t.id+"BindMessage"]=!1)}),window[t.id+"BindMessage"]=!0),!0};var Pe=function(e){var t,i,n=$.extend(!0,{},S.getSigTData),a=S.isInIframe,o="mqq"===S.inWebViewType;S.isMobile?a?(e=e.replace(/\+/gi,"%2B"),window.parent.postMessage({act:"LAUNCH",type:"PHONE",sign:e,protocol:T.CGI_URL.ROUTE_CHANGE_LOADING.QQ+"?fromWebIm=1&"+$.param(n)+"&protocol="+e},"*")):top.location.href=o?e:T.CGI_URL.ROUTE_CHANGE_LOADING.QQ+"?"+J(window.location.href)+"&protocol="+e:"https"===window.location.protocol&&-1===S.userAgent.indexOf("msie")?window.location.href=e:(t=document.createElement("iframe"),i=document.body,t.style.display="none",i.insertBefore(t,i.firstChild),t.src=e)};function De(e){var t=$.extend(!0,{},S.getSigTData),i=S.receptionist.extUin,n=e.type;window.bindCallQQEvent=function(e){var t;S.inRegProcess=0,e&&0==e.r&&void 0!==e.data.sign?(t=e.data.sign,Pe(t)):Y({text:"点击失败："+e.data.message},1e3)},"qq"!=n&&"qqCorpUin"!=n||($.extend(t,{roleValue:0,reqPos:e.reqPos,reqSrc:"routeChange",isCorpUin:"qqCorpUin"==n?1:0}),e.data?$.extend(t,e.data):$.extend(t,{roleData:i,clickid:r()}),1==S.authConfig.auth||1==J(window.location.href,"auth")?function(e){var t=C(T.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PHP),i="wpaShowItemId";if(void 0===e.visitorId)return I({type:"noVisitorId",empty:!0}),BJ_REPORT.report("noVisitorId");void 0===e.reqSrc&&(e.kfuin&&xe(e.kfuin),Ie()),$.extend(e,{ftype:S.isMobile,rolekey:"roleQQ"}),void 0!==e[i]&&(ke.get(i)?delete e[i]:ke.set(i,"true")),e.fid=e.fid||e.wpaId;var n=Ae(e);S.isInIframe?y.send({act:"AUTH",data:e}):Le({src:n,id:"wpaAuthorization"}),(w.chatBody.hasClass("regsuccess")||w.chatBody.hasClass("reconnect"))&&(I({type:"startGetSigT",seq:t,act:"new"}),S.inRegProcess=t)}(t):Un(t,T.CGI_URL.GET_TENCENT_SCHEME,"bindCallQQEvent"))}function Ne(e,t){var i=1<arguments.length&&void 0!==t?t:{type:"qq"};$.extend(i,{reqPos:e.attr("reqpos")}),e.off(S.clickName).on(S.clickName,$.proxy(De,null,i))}var Be,Ue=(Be=T.SOCKET_OPTS.CLIENT_PING_DELAY,{add:Ge,remove:He,update:function(){He(),Ge()}});function Ge(){S.clientPingTimer||(S.clientPingTimer=setInterval(function(){S.chatSocket.emitMsg(T.SOCKET_CMD.CLIENT_PING.EMIT,{})},Be))}function He(){S.clientPingTimer&&(clearInterval(S.clientPingTimer),S.clientPingTimer=null)}function Fe(e){window.open(e,"_blank")}function je(e){for(var t,i=S.seqs.data,n=(P.getType(e),P.getBody(e)),a=i.length,o=0;o<a;o++)if(t=i[o],n<P.getBody(t))return{act:"insert",insertSeqs:t,singleSeqs:e,index:o};return{act:"append",singleSeqs:e}}var We={voteGuidTemp:{},voteSeqMap:{},render:function(e){var t=e.sortseq||e.time,i=e.data,n=$.tmpl.joinTpl(T.CHAT_MSG_TPL.b2cWrap,"msgContent",T.RICH_MSG_TPL[3]);$.extend(i,{name:e.name,avatar:e.avatar,msgName:"msg-qlist",tpl:n,seq:e.seq}),i=We.processData(i);var a=$($.tmpl(i.tpl,i).replace(/&lt;br\/?&gt;/g,"<br/>"));return e.sortSeq=t,We.bindEvent(a,e),a},bindEvent:function(e,t){var s=e.find(".question-list").data("type"),i=e.find(".b2c-content-tails"),n=t.sortSeq+""+t.type,a=S.receptionist,r="kf"+a.kfUin+"vId"+a.visitorId+"index"+n,c=t.sortSeq;i.delegate(".b2c-content-tails-icon","click",function(e){var t,i,n,a,o;e.preventDefault(),We.voteGuidTemp[c]||$(this).hasClass("active")||$(this).hasClass("flash")||(t=$(this).parents(".b2c-content-tails").attr("data-id"),i=$(this).attr("data-key"),n=$(this).attr("data-index"),a=C(T.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PHP),We.voteSeqMap[a]=c,We.voteGuidTemp[c]={index:n,key:i,localStorageKey:r},o={data:"",seq:a,type:1,wordMsgSeq:C(T.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PC),date:+new Date+S.serverClientTimeDiff,vote:{id:t,click:[{key:i}]}},S.chatSocket.emitMsg(T.SOCKET_CMD.C2B.EMIT,o))}),e.delegate("a","click",function(e){e.preventDefault();var t=$(e.currentTarget),i=t.attr("action"),n=t.attr("url"),a=t.attr("question");switch(i){case"web":Fe(n);break;case"msg":var o={data:a,seq:C(T.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PHP),type:1,wordMsgSeq:C(T.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PC),date:+new Date+S.serverClientTimeDiff,qlist:{kfUin:S.receptionist.kfUin,type:s}};2==S.registerType&&$.extend(o,{queueKey:S.queueKey}),In.normal.render("c2b",o);break;default:BJ_REPORT.report("QlistMsg Action Error: "+i)}})},handleC2bReceiveSeq:function(e,t){var i,n,a,o,s,r,c,l;We.voteSeqMap[t]&&We.voteGuidTemp[We.voteSeqMap[t]]&&(i=We.voteSeqMap[t],0===e&&(n=$('[data-guid="'+i+'"]'),o=(a=We.voteGuidTemp[We.voteSeqMap[t]]).index,s=a.key,r=a.localStorageKey,(c=n.find(".b2c-content-tails-icon").eq(o)).addClass("flash"),setTimeout(function(){c.removeClass("flash").addClass("active").siblings().remove()},300),(l=JSON.parse(L.get(r)))&&(l.data.vote.active={index:o,key:s},L.set(r,JSON.stringify(l)))),delete We.voteGuidTemp[We.voteSeqMap[t]],delete We.voteSeqMap[t])},processData:function(e){var t=e.vote||{},i=e.qlist||{},n=t.description||i.description||[],a=t.questions||i.questions||[];function o(e){return e.replace(/\r\n/g,"<br/>").replace(/[\n\r]/g,"<br/>")}return i.type=i.type||t.type||"2",0<n.length&&$.each(n,function(e,t){t.text=o(t.text)}),0<a.length&&$.each(a,function(e,t){t.text=o(t.text)}),i.description=n,i.questions=a,e.qlist=i,e}},Je=!1,Ke="init";function Ve(e){Ke="init",e&&e.removeClass("msg-voice--playing")}function ze(e,t){var i=void 0;switch(e){case"fail":i=$($.tmpl(T.CHAT_MSG_TPL.translateTip,{icon:e,tip:"转文字失败"}))}w.chatList.append(i),t&&setTimeout(function(){i.remove()},1500)}var Qe,Ye={render:function(e,t){var i,n=void 0;return t.isFromHistory?($.extend(e,{duration:e.data.duration,width:Ye.computeVoiceLength(e.data.duration)}),e.data.recordTime&&e.data.recordTime+2592e5<+new Date&&$.extend(e,{expired:"msg-voice--expired"}),n=$(k(T.CHAT_MSG_TPL.c2bVoice,e)),"ack"===t.cacheStatus&&n.find(".duration").text(""),Ye.bindEvent(n,e)):(i=e.seq,n=w.chatListWrap.find('[data-guid="'+i+'"]')),n},computeVoiceLength:function(e){return e=parseInt(e),90+10*Math.ceil((e-5)/5)},handleAck:function(e,t){var i=e.seq||"",n=e.data||{},a=w.chatListWrap.find('[data-guid="'+i+'"]');if(a&&a.length&&a.hasClass("msg-voice")){var o=Math.max(n.duration,0);if(a.removeClass("msg-voice--recording"),"success"===t?(a.find(".bubble").css("width",Ye.computeVoiceLength(o)+"px"),a.find(".duration").text(o+'"')):a.find(".duration").text(""),"success"===t){var s="kf"+S.receptionist.kfUin+"vId"+S.receptionist.visitorId+"index"+n.date+7;if(L.get(s))try{var r=L.get(s);(r=JSON.parse(r)).data.duration=o,L.set(s,JSON.stringify(r))}catch(e){BJ_REPORT.report("update voice msg duration error")}}Ye.bindEvent(a,e)}},bindEvent:function(n,a){var e=n.find(".bubble");e.on("tap",function(e){e.target&&"i"===e.target.nodeName.toLowerCase()||e.target&&$(e.target).hasClass("tip")||(n.hasClass("msg-voice--expired")?Y({text:"语音已过期"},1500):Ye.tapBubbleThrottle(function(){var e=void 0;n.hasClass("msg-voice--playing")?(e=n.data("localid"))&&Ye.stopVoice(n,e):(e=n.attr("data-localid"))?Ye.playVoice(n,e):Ye.downloadVoice(a.data.mediaId).then(function(e){Ye.playVoice(n,e.localId)},function(e){Y({text:e.errMsg},1500),Ve(n)})},500)())}),e.on("longTap",function(e){n.find(".bubble--translate").length||(n.addClass("msg-voice--tapping"),n.find(".tip").off("tap").on("tap",function(){var e,t,i=a.data||{};i.isTranslate?i.content?n.append('<div class="bubble--translate">'+a.data.content+'<div class="translate-tip">转换完成</div></div>'):ze("fail",!0):i.mediaId?(e=n.attr("data-localid"),t=$('<div class="bubble--translate"><i class="loading loading-s"></i></div>'),n.append(t),e?Ye.translateVoice(e).then(function(e){t.html(e.translateResult+'<div class="translate-tip">转换完成</div>')},function(){t.remove(),ze("fail",!0)}):Ye.downloadVoice(i.mediaId).then(function(e){n.attr("data-localid",e.localId),Ye.translateVoice(e.localId).then(function(e){t.html(e.translateResult+'<div class="translate-tip">转换完成</div>')},function(){t.remove(),ze("fail",!0)})},function(){t.remove(),ze("fail",!0)})):ze("fail",!0),n.removeClass("msg-voice--tapping").addClass("msg-voice--translating")}))}),e.on("contextmenu",function(e){e.preventDefault()}),Je||(w.chatBody.on("tap",function(){w.chatListWrap.find(".msg-voice").removeClass("msg-voice--tapping")}),Je=!0)},tapBubbleThrottle:function(t,e){var i=1<arguments.length&&void 0!==e?e:0,n=null,a=0;return function(){var e=+new Date;a+i<=e?(t(),a=e):(n&&(clearTimeout(n),n=null),n=setTimeout(function(){t()},i))}},playVoice:function(t,i){wx&&wx.onVoicePlayEnd({complete:function(e){e.localId==i&&Ve(t)}}),wx&&wx.playVoice({localId:i,success:function(){Ke="play",w.chatList.find(".msg-voice").removeClass("msg-voice--playing"),t.addClass("msg-voice--playing").attr("data-localid",i)},fail:function(e){Y({text:e.errMsg},1500),Ve(t)}})},stopVoice:function(t,e){"play"===Ke?wx&&wx.stopVoice({localId:e,success:function(){Ve(t)},fail:function(e){e&&"stopVoice:not playing"===e.errMsg?Ve(t):Y({text:e.errMsg},1500)}}):Ve(t)},downloadVoice:function(e){var t=$.Deferred();return Ke="download",wx&&wx.downloadVoice({serverId:e,isShowProgressTips:0,success:function(e){t.resolve(e)},fail:function(e){t.reject(e)}}),t.promise()},translateVoice:function(e){var t=$.Deferred();return wx&&wx.translateVoice({localId:e,isShowProgressTips:0,success:function(e){e.translateResult?t.resolve(e):t.reject(e)},fail:function(e){t.reject(e)}}),t.promise()}};function Xe(e,t){return"c2b"==e?-1!=t.indexOf("f_")?t:t.replace(/\[(.*?)\]/g,function(e,t){for(var i=0;i<W.locale.length;i++)if($.i18n(W.locale[i])==t)return"[f_"+W.index[i]+"]";return e}):"b2c"==e?t:void 0}function Ze(e,t,i,n,a,o){var s,r,c=S.chatSocket,l=S.wpaDetail,d=S.ioLinkStatus;if(c.ioLink&&c.ioLink.disconnected&&"sessionOver"!=d&&(d="over",S.ioLinkStatus="over",Ue.remove(),S.registerActionType=6),1==t.type&&(void 0!==t.originMsgContent&&(t.data=t.originMsgContent,delete t.originMsgContent),t.data=Xe(e,t.data)),"welcome"!=i)if("c2b"==e){switch(r=t.date,$.extend(t,{clickid:l.clickid,date:r}),S.thirdAppConfig.enable&&$.extend(t,{thirdAppInfo:$.extend(!0,{},S.thirdAppConfig)}),2===S.registerType&&(1==S.menuDetail.defaultConfig.active?($.extend(S.getSigTData,{roleValue:S.menuDetail.defaultConfig.roleValue,roleData:S.menuDetail.defaultConfig.roleData}),S.menuDetail.defaultConfig.active=0,S.ioLinkStatus=d="over",S.registerActionType=5):w.chatBody.hasClass("regsuccess")&&$.extend(t,{queueKey:S.queueKey})),w.chatBody.hasClass("regsuccess")||(d="none"),d){case"over":s=t,BJ_REPORT.info("IoLink Over ReConnect"),Bn().reConnect(!1);break;case"sessionOver":s=t,BJ_REPORT.info("Session Over ReConnect"),S.registerActionType=7,Bn().reConnect();break;case"normal":-1!=t.type&&(S.isChangeKF&&(c.emitMsg(T.SOCKET_CMD.KF_CHANGE.EMIT,{kf:""}),w.chatListWrap.find(".btn-newkf").addClass("disabled"),1==S.routePermit.isNeedQQ&&(Ce(),Ne(w.callGroup.find(".btn-callqq"),{type:S.routePermit.isCorpUin?"qqCorpUin":"qq"}))),s=null,Ue.update(),1==t.type&&S.translate&&S.translate.translateLang&&(t.translateLang=S.translate.translateLang),c.emitMsg(T.SOCKET_CMD.C2B.EMIT,t))}-1!=t.type&&(setTimeout(function(){!function(e){for(var t=e.seq,i=S.c2bSeqGroup,n=0;n<i.length;n++)i[n].seq==t&&(i.splice(n,1),S.c2bSeqGroup=i,In.normal.sendFail(e),We.handleC2bReceiveSeq(1,t),Ye.handleAck(e,"fail"))}(t)},T.SOCKET_OPTS.C2B_TIMEOUT),j.saveMsgToDB(t)),w.chatBody.hasClass("regsuccess")&&(S.reSendC2bMsg=s),4739345==t.data&&(L.clear(),S.win.location.reload())}else if("b2c"==e&&("msg"===i&&Ue.update(),a&&S.chatSocket.emitMsg(T.SOCKET_CMD.B2C.EMIT,{date:t.date,seq:t.seq,sortseq:t.sortseq-S.serverClientTimeDiff,csrf:t.csrf}),!a||void 0!==t.csrf&&t.csrf||BJ_REPORT.report("B2C Ack Csrf Error "+JSON.stringify(t)),o&&j.saveMsg(e,t,n),6==t.type)){for(var f=L.get("offlineSeq")||"[]",p=-1,f=JSON.parse(f),u=0;u<f.length;u++)t.seq==f[u]&&(p=u);-1!=p&&(f.splice(p,1),L.set("offlineSeq",JSON.stringify(f)))}}function et(e,t,i){for(var n=2<arguments.length&&void 0!==i?i:"prepend",a=e.toString().length;a<t;)e="prepend"==n?"0"+e:e+"0",a++;return e}function tt(e){return et((e=new Date(e)).getMonth()+1,2)+"-"+et(e.getDate(),2)+"&nbsp;"+et(e.getHours(),2)+":"+et(e.getMinutes(),2)}function it(e,t){var i=1<arguments.length&&void 0!==t?t:"append";(!Qe||e-Qe>T.VIEW_OPTS.TIME_INTERVAL)&&(Qe=e,"append"==i?w.chatListWrap.find(".tencent-certification").before(k(T.CHAT_MSG_TPL.time,tt(Qe))):w.chatListWrap[i](k(T.CHAT_MSG_TPL.time,tt(Qe))))}var nt=function(){var g=S.receptionist,a=S.wpaDetail,m=S.menuDetail,s=(S.inRegProcess,S.chatSocket,{start:function(e){var t={visitorId:g.visitorId,wpaId:a.wpaId,kfuin:g.kfUin,navKey:e.menuKey},i={loading:$.i18n(T.VIEW_OPTS.MENU_MSG.LOADING),fail:$.i18n(T.VIEW_OPTS.MENU_MSG.FAIL)},n=o;e.isNewNav&&(I({type:"msgExpired",act:"new"}),this.expired()),this.load(null,t,i,n)},load:function(e,i,n,a){var o=$(k(T.CHAT_MSG_TPL.msgLoad.loading,n.loading)),s=$('[data-guid="'+e+'"]').prev();o.data("queryData",i),e?o.insertBefore(s):w.chatListWrap.find(".tencent-certification").before(o),(s=o).on("fail",function(e,t){o.html(k(T.CHAT_MSG_TPL.msgLoad.getMsg,n.fail)).find(".btn-load-msg").one(S.clickName,function(){o.trigger("loading"),a&&a(i,s,o)}),h(),BJ_REPORT.report("Menu GetData Error"),BJ_REPORT.report(JSON.stringify(t))}).on("loading",function(){o.html(k(T.CHAT_MSG_TPL.msgLoad.loading,n.loading))}).on("success",function(){o.remove()}).on("over",function(){o.html(k(T.CHAT_MSG_TPL.msgLoad.overTip,n.over))}),a&&a(i,s,o)},expired:function(){w.chatListWrap.find('.mod-menu[data-oldver="0"]').each(function(){$(this).trigger("expired")})},msg:function(e,t){var i=0;e.button&&(i=(100/e.button.length).toFixed(2),$.extend(e,{buttonWidth:i})),j.saveMsg("b2c",{data:e,type:3,date:S.receptionist.time,sortseq:S.receptionist.time},{act:"append",singleSeqs:S.receptionist.time+"3"}),$.extend(e,{isMobile:S.isMobile,currentVersion:m.currentVersion,guid:C(T.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PHP)}),it(S.receptionist.time),w.chatListWrap.find(".tencent-certification").before($.tmpl(T.CHAT_MSG_TPL.menuMsgNormal,e,ye)),t.trigger("success"),h(),n($('[data-guid="'+e.guid+'"]'))}});function o(n,e,a){var t={},i=0,o=0;$.ajax({url:T.CGI_URL.GET_MENU_URL+"?kfuin="+S.receptionist.kfUin,data:n,type:"POST",timeout:1e4,dataType:"json",error:function(e,t,i){a.trigger("fail",{textStatus:t,errorThrown:i,queryData:n})},beforeSend:function(){o=+new Date},complete:function(){Oe({type:5,requestConsumTime:new Date-o,clickid:S.getSigTData.clickid,addon:JSON.stringify({menuKey:n.navKey})})},success:function(e){0!=e.r?a.trigger("fail",e):($.extend(t,{config:e.data.navSet.config,eLogo:e.data.eLogo||T.CGI_URL.COMP_SOURCE_URL+"img/default-logo.png",eName:e.data.eName,version:e.data.version,navVersion:e.data.navVersion||1},e.data.navSet.content),$.extend(m,{currentVersion:parseInt(t.version),eLogo:t.eLogo,eName:t.eName}),void 0!==t.default.action&&(i=parseInt(t.default.manualType),$.extend(m.defaultConfig,{active:parseInt(t.default.action),roleValue:i,roleData:0===i||4===i?parseInt(t.default.serviceKfext)||parseInt(t.default.robotId):parseInt(t.default.groupId),roleExtendData:t.default.data||""}),S.isRealSendMsg=m.defaultConfig.active,0==S.isRealSendMsg&&(S.c2bSeqGroup=[],w.chatListWrap.find(".msg-c2b i").removeClass("loading loading-s"),H.clearCache()),m.defaultConfig.active&&($.extend(S.getSigTData,{roleValue:m.defaultConfig.roleValue,roleData:m.defaultConfig.roleData}),S.ioLinkStatus="over")),$.extend(S.menuDetail,m),s.msg(t,a),H.getMsgCacheList().length&&Ze("c2b",{type:-1}))}})}function _(e){var t=T.CGI_URL.COMMON_REQ_RPT+"?kfuin="+g.kfUin,e=$.extend({},{data:e},{kfuin:g.kfUin,visitorid:g.visitorId,action:e.action||(e.replyType?parseInt(e.replyType)+1:1)});$.ajax({url:t,data:e,type:"POST",timeout:1e3,dataType:"json",error:function(){BJ_REPORT.report("Menu ActRpt Error")},success:function(e){0!=e.r&&BJ_REPORT.report("Menu ActRpt Error")}})}function n(e){var f,p=e,u={};p.delegate("a","click",function(e){e.preventDefault();var t=(f=$(e.currentTarget)).parent().parent(),i=t.children().eq(0),n=t.children().eq(1),a=i.find("i"),o=p.data("openIndex")||0,s=t.index(),r=+new Date+S.serverClientTimeDiff,c=3!=(c=0<f.closest(".menu-action").length?3:1)&&0<f.closest(".nav-bd").length?2:c;switch(u={action:parseInt(f.data("action")),type:f.data("replytype"),data:f.data("replydata")},o&&s!=o&&f.closest(".nav-hd").length&&(S.isMobile?p.find(".nav-item").eq(o-1).children().eq(1).css("height",0).prev().find("i").removeClass("up").addClass("down"):p.find(".nav-item").eq(o-1).children().eq(1).slideUp("fast").end().find("i").removeClass("icon-arrow-up").addClass("icon-arrow-down")),u.action){case 1:In.normal.render("b2c",{avatar:m.eLogo,name:m.eName,data:u.data,date:r,type:3===u.type?5:u.type,isNavGet:3===u.type,sortseq:r},"autoReply",!0,{act:"append",singleSeqs:r+""+(3===u.type?5:u.type)},!1,!0);break;case 2:Fe(u.data);break;case 3:S.inRegProcess||($.extend(S.getSigTData,{kfuin:g.kfUin,roleValue:u.type,roleData:u.data,NavClick:{menuname:f.text(),menutp:c}}),delete S.wpaDetail.extUin,$("body").removeClass("regsuccess").addClass("reconnect"),Un(S.getSigTData,null,null,!0));break;case 4:S.isMobile?"0px"==n.css("height")?(p.data("openIndex",s),a.addClass("up"),n.css("height",46*n.find("li").length+"px")):(p.removeData("openIndex"),a.removeClass("up"),n.css("height","0px")):(n.css("display")&&"none"!=n.css("display")?(a.removeClass("icon-arrow-up").addClass("icon-arrow-down"),p.removeData("openIndex")):(a.removeClass("icon-arrow-down").addClass("icon-arrow-up"),p.data("openIndex",s)),n.slideToggle("fast"));break;default:BJ_REPORT.report("Menu Action Type Error"+u.action)}var l={menuname:f.text(),menutp:c},d=f.attr("data-origin-replytype");"1"===d?(l.replyType=d,l.replyText=f.data("origin-replytext")):"2"===d&&(l.replyType=d,l.materialId=f.data("origin-materialid")),u.action&&_(l)}),p.on("expired",function(){$(this).attr("data-oldver",1).addClass("menu-expired").children().append(ye(T.CHAT_MSG_TPL.menuMsgExpired))})}return{render:s,bindEvents:n,actRpt:_}};function at(e){var t;w.chatBody.append('<div class="mod-fullscreen"><div class="overlay"></div></div>'),t=$(".mod-fullscreen"),S.isMobile&&t.on("touchmove",function(e){return e.preventDefault(),!1}),e&&e(t)}var ot=new RegExp("((?:(http|https|Http|Https|rtsp|Rtsp):\\/\\/(?:(?:[a-zA-Z0-9\\$\\-\\_\\.\\+\\!\\*\\'\\(\\)\\,\\;\\?\\&\\=]|(?:\\%[a-fA-F0-9]{2})){1,64}(?:\\:(?:[a-zA-Z0-9\\$\\-\\_\\.\\+\\!\\*\\'\\(\\)\\,\\;\\?\\&\\=]|(?:\\%[a-fA-F0-9]{2})){1,25})?\\@)?)?((?:(?:[a-zA-Z0-9][a-zA-Z0-9\\-]{0,64}\\.)+(?:(?:aero|arpa|asia|a[cdefgilmnoqrstuwxz])|(?:biz|b[abdefghijmnorstvwyz])|(?:cat|com|coop|club|c[acdfghiklmnoruvxyz])|d[ejkmoz]|(?:edu|e[cegrstu])|fun|f[ijkmor]|group|(?:gov|g[abdefghilmnpqrstuwy])|h[kmnrtu]|(?:info|int|ink|i[delmnoqrst])|(?:jobs|j[emop])|kim|k[eghimnrwyz]|ltd|link|l[abcikrstuvy]|(?:mil|mobi|museum|m[acdghklmnopqrstuvwxyz])|(?:name|net|n[acefgilopruz])|(?:org|online|om)|(?:pro|p[aefghklmnrstwy])|qa|red|ren|r[eouw]|store|site|shop|s[abcdeghijklmnortuvyz]|(?:tel|travel|top|tech|t[cdfghjklmnoprtvwz])|u[agkmsyz]|vip|v[aceginu]|xin|xyz|wang|work|w[fs]|y[etu]|z[amw]))|(?:(?:25[0-5]|2[0-4][0-9]|[0-1][0-9]{2}|[1-9][0-9]|[1-9])\\.(?:25[0-5]|2[0-4][0-9]|[0-1][0-9]{2}|[1-9][0-9]|[1-9]|0)\\.(?:25[0-5]|2[0-4][0-9]|[0-1][0-9]{2}|[1-9][0-9]|[1-9]|0)\\.(?:25[0-5]|2[0-4][0-9]|[0-1][0-9]{2}|[1-9][0-9]|[0-9])))(?:\\:\\d{1,5})?)(\\/(?:(?:[a-zA-Z0-9\\;\\/\\?\\:\\@\\&\\=\\#\\~\\-\\.\\+\\!\\*\\'\\(\\)\\,\\_])|(?:\\%[a-fA-F0-9]{2}))*)?(?:\\b|$)","gi"),st=function(e,t,i){var n=i||"http://",a=new RegExp("^("+(t||"http(s)?")+"):\\/\\/","gi");return e.match(a)?e:n+e},rt={get:function(e){var t="kf"+e.kfUin+"vId"+e.visitorId+"red",i=JSON.parse(L.get(t)),n="wId"+e.wpaId,a={};return i&&i.forEach(function(e){e[n]&&(a=e[n])}),a},set:function(t,i,e,n){var a,o=!(3<arguments.length&&void 0!==n)||n,s="kf"+t.kfUin+"vId"+t.visitorId+"red",i="wId"+i,r=JSON.parse(L.get(s)),c=!1,l={name:t.name,number:1},d={},f=l.number;r?(r.forEach(function(e){for(a in e)a==i&&(c=!0,f=e[a].number+1,e[a].number=f,e[a].name=t.name)}),c||(d[i]=l,r.push(d)),o&&L.set(s,JSON.stringify(r))):(d[i]=l,L.set(s,JSON.stringify([d]))),S.isMobile||rt.render("update",f),e&&e(f)},reset:function(e){var i,t="kf"+e.kfUin+"vId"+e.visitorId+"red",n=JSON.parse(L.get(t)),a=[];n&&(n.forEach(function(e){for(i in e){var t={};t[i]={number:0},a.push(t)}}),L.set(t,JSON.stringify(a)))},render:function(e,t,i){var n={page:$(".page"),unReadMsgNum:$(".unread-msg-num")},a=n.unReadMsgNum.parent().find(".name"),o=n.unReadMsgNum.parent().find(".status");0!=t&&("update"==e?(n.unReadMsgNum.hasClass("hidden")&&n.unReadMsgNum.removeClass("hidden"),n.unReadMsgNum.text(9<t?"9+":t)):"reset"==e&&n.unReadMsgNum.addClass("hidden").text(""),i&&(n.page.removeClass("page-inframe").addClass("page-minify"),a.text(i.name),o.text(i.status)))}};function ct(){var e,t={kfuin:S.receptionist.kfUin,kfext:S.receptionist.extUin,wpaId:S.wpaDetail.wpaId,key:S.wpaDetail.wpaKey};e=t,$.ajax({url:T.CGI_URL.GET_RECEPTION_DETAIL+"?kfuin="+e.kfuin,data:e,type:"POST",timeout:2e3,dataType:"json",success:function(e){!function(e){e.avatar||(e.avatar=T.CGI_URL.COMP_SOURCE_URL+"img/default-logo.png");$(".sidebar").html($.tmpl(T.CHAT_MSG_TPL.receptionInfo,e)),S.isShowQidianSign&&$(".sidebar").append(_($('<div class="tencent-cert"></div>')))}(e)},fail:function(e){BJ_REPORT.report("get reception detail error"),BJ_REPORT.report(JSON.stringify(e))}})}function lt(e){this.options={command:"copy",events:{}},$.extend(!0,this.options,e),void 0!==e.data?this.execCopy():this.fail(0)}lt.prototype.isSupport=function(){return!!document.queryCommandSupported&&!!document.queryCommandSupported(this.options.command)},lt.prototype.createElement=function(){var e="clipboard-target-"+ +new Date;return $("body").append('<span class="'+e+'" style="position:absolute;z-index:-1;font-size:0;"></span>'),$("."+e)},lt.prototype.destoryElement=function(e){e&&e.remove()},lt.prototype.fail=function(e,t){this.options.events.fail&&this.options.events.fail(e,t)},lt.prototype.selectText=function(e){var t=window.getSelection(),i=document.createRange();return i.selectNodeContents(e),t.removeAllRanges(),t.addRange(i),t.toString()};var dt={waitRetDelayTime:15e3,waitRetQueue:{},waitRetManage:{add:function(e){var t="kfAccount"+e.kfAccount;dt.waitRetQueue[t]=setTimeout(function(){dt.renderRet({ret:"fail",kfAccount:e.qqNumForPaste}),dt.waitRetManage.destory(e)},dt.waitRetDelayTime)},remove:function(e){var t="kfAccount"+e.kfAccount;dt.waitRetQueue.hasOwnProperty(t)&&clearTimeout(dt.waitRetQueue[t]),dt.waitRetManage.destory(e)},destory:function(e){var t="kfAccount"+e.kfAccount;dt.waitRetQueue.hasOwnProperty(t)&&delete dt.waitRetQueue[t]}},getData:function(e,t){var i=$(t.target).parents(".content").find("dd a").html();Y({text:$.i18n("chat_add_friend_fetching_protocol_msg")},500),$.ajax({url:T.CGI_URL.GET_ADD_FRIEND_SCHEME,data:{kfext:S.receptionist.extUin,kfuin:S.receptionist.kfUin,visitorId:S.receptionist.visitorId,ftype:S.isMobile,kfaccount:e,clickid:r()},type:"GET",timeout:2e3,dataType:"jsonp",jsonp:"cb",error:function(){dt.renderRet({ret:"fail",kfAccount:i}),BJ_REPORT&&BJ_REPORT.report("GET ADD FRIEND SCHEME ERROR")},success:function(e){var t;0==e.r&&void 0!==e.data.sign?(t=e.data.sign,Pe(t)):(dt.renderRet({ret:"fail",extUin:i}),BJ_REPORT&&BJ_REPORT.report("GET ADD FRIEND SCHEME RES ERROR: "+JSON.stringify(e)))}})},renderRet:function(e){var t=+new Date,i=e.kfAccount;void 0!==e.originData&&S.chatSocket.emitMsg(T.SOCKET_CMD.SESSION_MSG.EMIT,{csrf:e.originData.csrf,seq:e.originData.seq,type:e.originData.type,time:e.originData.time}),"fail"==e.ret?(I({type:"addFriendFail",act:"new",seq:t}),$('[data-guid="'+t+'"]').find(".btn-paste").on("click",function(){new lt({data:i,events:{success:function(){Y({text:$.i18n("chat_add_friend_copy_success_msg")},1e3)},fail:function(e,t){var i;switch(e){case 0:i=$.i18n("chat_add_friend_fail_text")+": "+$.i18n("chat_add_friend_fail_get_number_fail_text");break;case 1:i=$.i18n("chat_add_friend_fail_text")+": "+$.i18n("chat_add_friend_fail_no_text_selected_text");break;case 2:i=$.i18n("chat_add_friend_fail_text")+": "+$.i18n("chat_add_friend_fail_browser_not_support_text");break;default:i=$.i18n("chat_add_friend_fail_text")+": "+t}Y({text:i},1e3)}}})})):dt.waitRetManage.remove({kfAccount:i})}},ft={sendAck:function(e){S.chatSocket.emitMsg(T.SOCKET_CMD.SESSION_MSG.EMIT,{csrf:e.csrf,seq:e.seq,type:e.type,time:e.time})},render:function(e,t,i){var n,a,o=e.sortseq||e.time,s=e.data,r=i.msgName||e.data.msgName,c=i.isNeedStore?"msg":"welcome",l=void 0!==i.isFromHistory&&i.isFromHistory,d=!i.isNeedStore,f=l?{act:"prepend",singleSeqs:o+"4"}:{act:"append",singleSeqs:o+"4"},p=P.setType(o,4);i.isNeedAck&&ft.sendAck(e),n=i.isNeedWrap?$.tmpl.joinTpl(T.CHAT_MSG_TPL[t+"Wrap"],"msgContent",T.RICH_MSG_TPL[s.type]):T.RICH_MSG_TPL[s.type],$.extend(s,{msgName:r,msgType:"msg-rich",isNeedWrap:i.isNeedWrap,tpl:n,seq:o}),i.isNeedStore&&(d=N(p),f=je(p)),d&&(In.normal.render(t,{data:s,seq:C(T.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PHP),type:4,wordMsgSeq:C(T.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PC),date:o,sortseq:o},c,!0,f,!1),"addfriend"==r&&((a=$('[data-guid="'+o+'"]').find("h2.title")).text($.i18n("common_add_qq_friend_text")),S.isMobile||a.prepend('<i class="icon-qq"></i>')),ft.bindEvent(o,s))},bindEvent:function(e,s){$('[data-guid="'+e+'"]').delegate("a","click",function(e){var t=$(e.currentTarget),i=t.attr("action"),n=t.attr("url"),a=t.attr("actionData"),o=C(T.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PHP);switch(e.preventDefault(),i){case"web":Fe(n);break;case"msg":$.extend(s,{tpl:$.tmpl.joinTpl(T.CHAT_MSG_TPL[a+"Wrap"],"msgContent",T.RICH_MSG_TPL[s.type]),seq:o}),0==s.type&&$.extend(s,{isNeedWrap:!0}),In.normal.render(a,{data:s,seq:o,type:4,wordMsgSeq:C(T.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PC),date:+new Date+S.serverClientTimeDiff},"msg",!0),0==s.type&&ft.bindEvent(o,s);break;case"addFriend":dt.getData(a,e);break;default:BJ_REPORT.report("RichMsg Action Error"+i)}})}},pt={render:function(e,t){var i;return e.isNavGet?(pt.download(e),null):(t.isFromHistory||(e=pt._processData(e)),(i=$($.tmpl(e.tpl,e,ye)))&&pt._bindEvent(i,e),i)},download:function(n){return $.ajax({url:T.CGI_URL.GET_GRAPHIC_MSG,data:{materialId:n.data,kfuin:S.receptionist.kfUin},type:"POST",timeout:3e3,dataType:"json",error:function(){I({type:"graphicMsgFail",seq:C(n.sortseq),act:"new"})},success:function(e){if(0!=e.r)return null;var t=P.setType(n.sortseq,n.type),i=je(t);$.extend(n,{data:e.data,method:"",seq:t,isNavGet:!1}),In.normal.render("b2c",n,"msg",null,i,!1,!1)}}),n},_processData:function(i){var n,a=[],o={};return i.data=JSON.parse(i.data),i.data&&i.data.item&&(i.data.item=i.data.item.filter(function(e){return!e[0]&&!e.more})),n=i.data.item&&1==i.data.item.length,i.data.item&&i.data.item.forEach(function(e,t){e.title&&(o.title=e.title),e.picture&&e.picture["@attributes"].cover&&(o.cover=e.picture["@attributes"].cover),n?(e.summary&&(o.summary=e.summary[1],o.date=e.summary[0]),o.url=i.data["@attributes"].url):o.url=e["@attributes"].url,a.push(o),o={}}),$.extend(i,{data:a,msgType:"msg-graphic",simple:n}),i.tpl=$.tmpl.joinTpl(T.CHAT_MSG_TPL.b2cWrap,"msgContent",T.RICH_MSG_TPL[2][n?"simple":"multiple"]),i},_bindEvent:function(e,t){e.delegate(t.simple?".content.simple":".thumb",S.isMobile?"tap":"click",function(e){var t=$(e.currentTarget),i=t.attr("action"),n=t.attr("actionData");switch(e.preventDefault(),i){case"web":Fe(n);break;default:BJ_REPORT.report(" Action Error"+i)}})},_getImgSize:function(e,t){var i=new Image;i.src=e,i.complete?t(i.width,i.height):i.onload=function(){t(i.width,i.height)}}},ut={key:"message",sendc2b:function(i,e){var n=1<arguments.length&&void 0!==e?e:{},t=i.dom;t&&t.on(S.clickName,function(e){e.preventDefault();var t={type:1,data:i.content,date:+new Date+S.serverClientTimeDiff,seq:C(T.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PHP),wordMsgSeq:C(T.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PC)};In.normal.render("c2b",t),setTimeout(function(){n.isScrollBottom&&h()},200)})}};function gt(e,t,i){var n=document.getElementsByTagName("script"),a=n[n.length-1],o=document.createElement("script"),s=!1;o.src=e,o.async=!0,a.parentNode.insertBefore(o,a),o.onload=o.onreadystatechange=function(){s||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(s=!0,t&&t.apply(i,arguments),o.onload=o.onreadystatechange=null)}}var mt=!(lt.prototype.execCopy=function(){var e;if(this.isSupport()){if((e=this.createElement()).html(this.options.data),0==this.selectText(e.get(0)).length)return void(this.options.events.fail&&this.options.events.fail(1));try{document.execCommand(this.options.command),this.options.events.success&&this.options.events.success()}catch(e){this.options.events.fail&&this.options.events.fail(3,e)}this.destoryElement(e)}else this.options.events.fail&&this.options.events.fail(2)}),_t=["startRecord","stopRecord","onVoiceRecordEnd","playVoice","pauseVoice","stopVoice","onVoicePlayEnd","uploadVoice","downloadVoice","translateVoice"];function ht(e){gt(T.CGI_URL.GET_WX_MP_JSSDK_SOURCE,function(){e&&e()})}function vt(r){var c=$.Deferred();return ht(function(){var e,n,i,t,a,o,s;e=r,n=$.Deferred(),i=J(e.url,"appid"),t=J(e.url,"kfuin"),a=parseInt(new Date/1e3),o="qidianwebim2019",s=location.href.split("#")[0],$.ajax({url:T.CGI_URL.GET_WX_MP_JSSDK_SIGNATURE+"?kfuin="+t,type:"GET",data:{appid:i,timestamp:a,nonceStr:o,url:s},success:function(e){var t;0==e.code||0==e.r?(t={appId:i,timestamp:a,nonceStr:o,signature:e.data.signature},n.resolve(t)):n.reject(e)},error:function(e,t){var i={code:e.status,msg:t};n.reject(i)}}),n.promise().then(function(e){var t,i,n,a=$.extend({},e,{debug:mt,jsApiList:_t});t=a,i=r.callback,n=$.Deferred(),wx&&wx.ready(function(){i&&i(),n.resolve()}),wx&&wx.error(function(e){n.reject({code:-1,msg:e.errMsg})}),wx&&wx.config(t),n.promise().then(function(){S.thirdAppConfig.appid=a.appId,c.resolve()},function(e){c.reject(e)})},function(e){c.reject(e)})}),c.promise()}var qt={key:"launch",miniprogram:function(e,t){var i=this,n=e.dom,a=window.wx;a&&a.miniProgram?this.bindEvents(n,e):ht(function(){i.bindEvents(n,e)})},bindEvents:function(e,t){e&&e.on(S.clickName,function(e){e.preventDefault(),t.url&&(t.url=decodeURIComponent(t.url)),wx.miniProgram[t.interface]&&wx.miniProgram[t.interface](t)})}},yt=/qdweb:\/\//,bt={};bt[ut.key]=ut,bt[qt.key]=qt;var Tt={inject:function(e,c){for(var l=this,t=e.find("a"),i=0,n=t.length;i<n;i++){var d=t.eq(i),f=d.attr("href");yt.test(f)&&function(){var e,t,i,n,a=f.replace(yt,""),o={dom:d},s=a.split("?"),r=s[0].split("/");1<s.length&&s[1].split("&").forEach(function(e){var t=e.split("=");1<t.length?o[t[0]]=t[1]:o[t[0]]=!0}),3<=r.length&&(t=(e=b(r,3))[0],i=e[1],n=e[2],l.invoke({namespace:t,action:i,method:n,params:o,options:c}))}()}},invoke:function(e){var t=e.namespace,i=e.action,n=e.method,a=e.params,o=e.options;"webim"===t&&bt[i]&&bt[i][n]&&bt[i][n]&&bt[i][n](a,o)}},St={render:function(e){var t=e.sortseq||e.time,i=e.data,n=$.tmpl.joinTpl(T.CHAT_MSG_TPL.b2cWrap,"msgContent",T.RICH_MSG_TPL[5]);$.extend(i,{name:e.name,avatar:e.avatar,msgName:"msg-html",tpl:n,seq:t});var a=$($.tmpl(i.tpl,i)),o=i.content;return o=(o=(o=o.replace(/<meta.*?>/gi,"")).replace(/<title>.*?<\/title>/gi,"")).replace(/<style.*?>.*?<\/style>/gi,""),a.find(".html-content").html(o||""),Tt.inject(a,{isScrollBottom:!0}),a}},wt={init:function(e){switch((e=e||{}).type){case"robotSatisfaction":this.initRobotSatisfaction(e)}},initRobotSatisfaction:function(e){var t,i,n=e.msgData,a=e.$el;5===n.type&&n.data&&2===n.data.type||(t=n.date||n.time,i=n&&n.vote&&n.vote.expiredIntervalTime,n.vote&&Date.now()+S.serverClientTimeDiff-t<i&&this.renderRobotSatisfaction(a,n))},renderRobotSatisfaction:function(e,t){var i=t.vote||{},n=$('<div class="b2c-content-tails" data-id="'+i.id+'"></div>'),a="";if(i.active)a='<span class="b2c-content-tails-icon active b2c-content-tails-icon-'+i.active+'"><span class="b2c-content-tails-hand"></span></span>';else for(var o=i.button||[],s=0;s<o.length;s++){var r=o[s].key;~["up","down"].indexOf(r)&&(a+='<span data-key="'+r+'" class="b2c-content-tails-icon b2c-content-tails-icon-'+r+'"><span class="b2c-content-tails-hand"></span></span>')}n.append(a),e.find(".bubble").append(n),this.bindEventRobotSatisfaction(e,t)},bindEventRobotSatisfaction:function(o,s){var r=this,e=o.find(".b2c-content-tails"),t=s.sortseq+""+s.type,c=S.receptionist,l="kf"+c.kfUin+"vId"+c.visitorId+"index"+t,d=!1;e.on("click",".b2c-content-tails-icon",function(e){var t,i,n,a;e.preventDefault(),d||$(this).hasClass("active")||$(this).hasClass("flash")||(d=!0,i="up"===(t=$(this).attr("data-key"))?"1":"0",n=s&&s.vote&&s.vote.robotId,(a=new FormData).append("kfuin",c.kfUin),a.append("visitid",c.visitorId),a.append("robotid",n),a.append("seq",s.seq),a.append("type",i),$.ajax({url:T.CGI_URL.ROBOT_SATISFACTION_REPORT+"?kfuin="+c.kfUin,data:a,type:"POST",processData:!1,contentType:!1,error:function(){d=!1},success:function(e){d=!1,0==e.r?r.robotSatisfactionCb({$el:o,localStorageKey:l,key:t}):BJ_REPORT.report("RobotSatisfaction report fail: "+e.message+l)}}))})},robotSatisfactionCb:function(e){var t=e.$el,i=e.key,n=e.localStorageKey,a=t.find('.b2c-content-tails-icon[data-key="'+i+'"]');a.addClass("flash"),setTimeout(function(){a.removeClass("flash").addClass("active").siblings().remove()},300);var o=JSON.parse(L.get(n));o&&(o.vote.active=i,L.set(n,JSON.stringify(o)))}},Ct={render:function(e){var t,i=e.sortseq||e.time,n=$.tmpl.joinTpl(T.CHAT_MSG_TPL.b2cWrap,"msgContent",T.RICH_MSG_TPL[4]);return $.extend(e,{msgType:"msg-coupon",tpl:n,seq:i}),e&&e.data&&(e.data.url=decodeURIComponent(e.data.url)),t=$($.tmpl(e.tpl,e)),Ct._bindEvent(t),t},_bindEvent:function(e){e.delegate(".content.coupon","click",function(e){var t=$(e.currentTarget),i=t.attr("action"),n=t.attr("url")||"https://oawpa.qidian.qq.com/coupon/deliver?corpUin=2852199351&ticket=Q2JLdU51QzNNaG10SUFaRGI3RXBxZz09&appid=200860315&platform=4";switch(i){case"web":Ct._createIframe(n);break;default:BJ_REPORT.report("QlistMsg Action Error: "+i)}})},_createIframe:function(e,t,i){var n=0<arguments.length&&void 0!==e?e:"https://qidian.qq.com/",a=$("<iframe width='"+(1<arguments.length&&void 0!==t?t:373)+"' height='"+(2<arguments.length&&void 0!==i?i:600)+"' id='coupon-iframe' name='coupon-iframe' style='position:absolute;z-index:12;'  frameborder='no' marginheight='0' marginwidth='0' allowTransparency='true'>                        </iframe>"),o=$("<div id='iframe-close' style='position:absolute;z-index:13;color:#FFF;'>                                <span style='display:inline-block;width:14px;border-top:0.5px solid #FFF;transform:rotate(45deg);vertical-align:middle;'></span>                                <span style='display:inline-block;width:14px;border-top:0.5px solid #FFF;transform:rotate(-45deg);position:relative;right:18px;vertical-align:middle;'></span>                            </div>"),s=$("<div id='coupon-iframeBg' style='background-color: White;display:block;z-index:11;position:absolute;left:0px;top:0px;filter:Alpha(Opacity=0);/* IE */-moz-opacity:0;/* Moz + FF */opacity: 0; '/>");a.prependTo("body"),o.prependTo("body"),s.prependTo("body");var r=document.documentElement.scrollTop||document.body.scrollTop,c=document.documentElement.scrollLeft||document.body.scrollLeft,l=document.documentElement.clientHeight,d=document.documentElement.clientWidth,f=a.height(),p=a.width(),u=Number(r)+(Number(l)-Number(f))/2,g=Number(c)+(Number(d)-Number(p))/2;a.css("left",g),a.css("top",u),o.css("left",g+355),o.css("top",u+10),a.css("background","#FFF"),a.css("border","solid 1px #dadee6").css("overflow","hidden"),a.css("border-radius","4px"),o.on("click",function(){$("#coupon-iframe").remove(),a.remove(),s.remove(),o.remove(),o=s=a=null}),S.isMobile||o.hover(function(){o.css("cursor","pointer")}),a.attr("src",n);var m=Math.max($("body").width(),d),_=Math.max($("body").height(),l);s.css({width:m,height:_})}};var xt=/(<a.*?>)(.*?)(<\/a>)/g,kt={renderMsg:function(e){var t=this.parseMsg(e&&e.data&&e.data.content),i=$.extend(t,{name:e.name,avatar:e.avatar,msgName:"msg-robot-qlist",seq:e.sortseq||e.time}),n=$.tmpl.joinTpl($.tmpl('\n<div class="qlist-content">\n    <div class="qlist-title"><%= o.title %></div>\n    <div class="qlist-list">listContent</div>\n</div>\n ',i),"listContent",t.list.join("")),a=$.tmpl.joinTpl(T.CHAT_MSG_TPL.b2cWrap,"msgContent",n),o=$($.tmpl(a,i));return this.bindEvents(o),o},parseMsg:function(e){for(var t={title:"",list:[]},i=0,n=null;n=xt.exec(e);)0===i&&(i=n.index),4<=n.length&&t.list.push(n[1]+'<span title="'+n[2]+'">'+n[2]+"</span>"+n[3]);return i&&(t.title=e.slice(0,i)),t},bindEvents:function(e){Tt.inject(e,{isScrollBottom:!0})}},Et={render:function(e,t){var i=1<arguments.length&&void 0!==t?t:{},n=e.sortseq||e.time,a=e.data,o=a.content||"",s=a.msgType||1,r=$.tmpl.joinTpl(T.CHAT_MSG_TPL.b2cWrap,"msgContent",T.RICH_MSG_TPL[5]);if(1===s){$.extend(a,{name:e.name,avatar:e.avatar,msgName:"msg-free",tpl:r,seq:n});var c=$($.tmpl(a.tpl,a)),o=Et.replaceHtml(o);return o=Et.replaceWrap(o),o=Et.replaceUrl(o),o=Et.replaceFace(o),c.find(".html-content").html(o||""),i.isGoBot&&Et.checkImgLoad(c),Et.viewLargeImg(c),Tt.inject(c,{isScrollBottom:!0}),c}if(2===s||3===s)return kt.renderMsg(e)},checkImgLoad:function(e){for(var t=e.find(".html-content img"),i=t.length,n=0,a=0;a<i;a++)t.eq(a).load(function(){++n===i&&h()})},viewLargeImg:function(e){for(var t,i,n=e.find(".html-content img"),a=n.length,o=0;o<a;o++)i=(t=n.eq(o)).attr("src"),(S.isMobile?function(e){t.off("tap").on("tap",function(){at(function(t){t.append('<img class="big-image" src="'+e+'"/>'),t.on("touchend",function(e){t.remove()})})})}:function(d){t.off("click").on("click",function(){S.isInIframe?y.send({act:"OPEN_IMG",data:{url:d}}):at(function(t){var e,i,n,a,o,s,r,c,l;t.append('<div class="img-wrap"><img class="" src=""/><a href="javascript:;" class="btn-close"></a></div>'),e=t,i=d,n=new Image,a=$(window),s={width:1,height:1},r={width:o=0,height:0},c={width:a.innerWidth()-160,height:a.innerHeight()},l={width:0,height:0},n.onload=function(){return r={width:n.width,height:n.height},o=Math.max(r.width,r.height),s={width:r.width/r.height,height:r.height/r.width},r.width<=c.width&&r.height<=c.height?l={width:r.width,height:r.height}:r.width==o?(l.width=c.width,l.height=Math.floor(l.width*s.height)):(l.height=c.height,l.width=Math.floor(l.height*s.width)),e.find("img").attr({width:l.width,height:l.height,src:i}).css({"margin-top":0-l.height/2,"margin-left":0-l.width/2}),l},n.src=i,t.on("click","a.btn-close",function(e){e.preventDefault(),t.remove()})})})})(i)},replaceUrl:function(e){var t,i,n=void 0;return e=(n=Et.keepImgTag(e)).content,t=n.imgList,e=(n=Et.keepLinkTag(e)).content,i=n.linkList,e=e.replace(ot,function(e){return'<a href="'+st(e)+'" target="_blank" class="text-link">'+e+"</a>"}),e=Et.resetImgTag(t,e),e=Et.resetLinkTag(i,e)},replaceFace:function(e){var t,i,n=void 0,s=S.isMobile?T.CGI_URL.QQ_FACE:T.CGI_URL.COMP_SOURCE_URL+"img/qq/";return e=(n=Et.keepImgTag(e)).content,t=n.imgList,e=(n=Et.keepLinkTag(e)).content,i=n.linkList,e=e.replace(/\[(.*?)\]/g,function(e,t){var i=void 0;if(0===t.indexOf("f"))for(var n=t.match(/\d+/g),a=0,o=W.index.length;a<o;a++)if(W.index[a]==n){i=a;break}return i||0===i?'<img src="'+s+i+'.png" class="face"/>':e}),e=Et.resetImgTag(t,e),e=Et.resetLinkTag(i,e)},replaceWrap:function(e){return e.replace(/\r\n/g,"<br/>").replace(/\n/g,"<br/>")},replaceHtml:function(e){var t,i,n=void 0;return e=(n=Et.keepImgTag(e)).content,t=n.imgList,e=(n=Et.keepLinkTag(e)).content,i=n.linkList,e=e.replace(/[<>'"&]/g,function(e){switch(e){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39"}}),e=Et.resetImgTag(t,e),e=(e=Et.resetLinkTag(i,e)).replace(/&amp;nbsp;/g,"&nbsp;")},keepImgTag:function(e){var t=/<img[^>]*src=['"]([^'"]+)['"][^>]*>/gi,i=e.match(t)||[],n=0;return{content:e=e.replace(t,function(){return"$$$img"+ ++n+"$$$"}),imgList:i}},resetImgTag:function(e,t){for(var i=0,n=e.length;i<n;i++)t=t.replace("$$$img"+(i+1)+"$$$",e[i]);return t},keepLinkTag:function(e){var t=/<a.*?>.*?<\/a>/gi,i=e.match(t)||[],n=0;return{content:e=e.replace(t,function(){return"$$$link"+ ++n+"$$$"}),linkList:i}},resetLinkTag:function(e,t){for(var i=0,n=e.length;i<n;i++)t=t.replace("$$$link"+(i+1)+"$$$",e[i]);return t}},It={renderMsg:function(e){var t=$($.tmpl('\n <div class="msg-b2c msg-robotnav">\n    <div class="nav-content">\n        <div class="nav-title"><%= o.tit %></div>\n        <div class="nav-list">\n            <%for(var i = 0, len = o.list.length; i < len; i++){%>\n            <div class="nav-item"><a class="nav-link" href="qdweb://webim/message/sendc2b?content=<%= o.list[i].name %>"><%= o.list[i].name %></a></div>\n            <%}%>\n        </div>\n    </div>\n </div>\n ',e.data.robotNav));return this.bindEvents(t),t},bindEvents:function(e){Tt.inject(e,{isScrollBottom:!0})}};function Rt(){function e(e){var t=document.createElement("b");return t.innerHTML="\x3c!--[if IE "+e+"]><i></i><![endif]--\x3e",1===t.getElementsByTagName("i").length}function t(e,t){return""!==e?e+t.slice(0,1).toUpperCase()+t.slice(1):t}var i,n=void 0,a=null,o=e(),s=e(9),r=s?"":null,c=(i=!1,"number"==typeof window.screenX&&["webkit","moz","ms","o",""].forEach(function(e){0==i&&null!=document[t(e,"hidden")]&&(r=e,i=!0)}),i);function l(){n=!1,s?document.dispatchEvent(a):document.documentElement.visibilitychange=1}function d(){n=!0,s?document.dispatchEvent(a):document.documentElement.visibilitychange=0}o&&!c&&(document.addEventListener?(window.addEventListener("focus",l,!0),window.addEventListener("blur",d,!0)):(document.attachEvent("onfocusin",l),document.attachEvent("onfocusout",d)),void 0===document.createEvent||a?document.documentElement.visibilitychange=0:(a=document.createEvent("HTMLEvents")).initEvent("visibilitychange",!0,!0));function f(){return c?document[t(r,"hidden")]:void 0!==n?n:void 0}function p(){return c?document[t(r,"visibilityState")]:void 0!==n?n?"hidden":"visible":void 0}return{hidden:f(),isHidden:f,isPageVisibilitySupport:c,visibilityState:p(),visibilitychange:function(t){if("function"==typeof t){if(c||s)return document.addEventListener(r+"visibilitychange",function(e){t.call(this,e,f(),p())},!1);document.documentElement.attachEvent("onpropertychange",function(e){"visibilitychange"==event.propertyName&&t.call(this,e,f(),p())})}}}}var $t=function(e){var t={title:document.title,message:"common_new_message_text",dynamicTitle:!1,interval:200};this.opts=$.extend({},t,e),this.opts.dynamicTitle&&delete this.opts.title};$t.prototype={changeTitle:function(){document.title=this.opts.title===document.title?$.i18n(this.opts.message):this.opts.title},addTimer:function(){var e=this;return void 0===this.timer&&(this.timer=setInterval(function(){e.changeTitle()},this.opts.interval)),this},clearTimer:function(){return this.timer&&(clearInterval(this.timer),delete this.timer,document.title=this.opts.title),this},setTitle:function(){return this.opts.dynamicTitle&&void 0===this.opts.title&&(this.opts.title=document.title),this},twinkling:function(){this.setTitle().addTimer()}};var Ot={observationTargets:[],unreadBtnClassName:"unread-msg-btn",bindEvent:function(){var e,t,i,n=this;$("body").on(S.clickName,"."+n.unreadBtnClassName,function(){var e=n.observationTargets[0];e&&(w.chatListWrap.scrollTop(e.offsetTop),n.handleObservationTargets())}),w.chatListWrap.on("scroll",(e=function(){n.handleObservationTargets()},t=150,i=null,function(){i=i||setTimeout(function(){e(),i=null},t)}))},handleObservationTargets:function(){var t,i,n;this.observationTargets.length&&(t=w.chatListWrap.scrollTop(),i=w.chatListWrap.height(),n=[],this.observationTargets.forEach(function(e){t+i<e.offsetTop&&n.push(e)}),n.length!==this.observationTargets.length&&(this.observationTargets=n,this.renderUnreadTip()))},renderUnreadTip:function(){var e,t=w.chatList,i=this.observationTargets.length;t.find("."+this.unreadBtnClassName).remove(),i&&(e=$(k(T.CHAT_MSG_TPL.msgLoad.numTip,i)).addClass(this.unreadBtnClassName),t.append(e))},main:function(e,t){!e||!e.offsetHeight||e.parentNode.scrollTop+e.offsetHeight>e.offsetTop||(this.observationTargets.push(e),this.renderUnreadTip(),this.handleObservationTargets(),BJ_REPORT.report("Unread B2C Msg"+JSON.stringify(t)))}};Ot.bindEvent();function At(e){if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?Kt(192|t>>>6)+Kt(128|63&t):Kt(224|t>>>12&15)+Kt(128|t>>>6&63)+Kt(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return Kt(240|t>>>18&7)+Kt(128|t>>>12&63)+Kt(128|t>>>6&63)+Kt(128|63&t)}function Mt(e){return e.replace(Vt,At)}function Lt(e){var t=[0,2,1][e.length%3],i=e.charCodeAt(0)<<16|(1<e.length?e.charCodeAt(1):0)<<8|(2<e.length?e.charCodeAt(2):0);return[Wt.charAt(i>>>18),Wt.charAt(i>>>12&63),2<=t?"=":Wt.charAt(i>>>6&63),1<=t?"=":Wt.charAt(63&i)].join("")}function Pt(e){return"[object Uint8Array]"===Object.prototype.toString.call(e)?e.toString("base64"):zt(Mt(String(e)))}function Dt(e,t){return t?Pt(String(e)).replace(/[+\/]/g,function(e){return"+"==e?"-":"_"}).replace(/=/g,""):Pt(e)}function Nt(e){switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return Kt(55296+(t>>>10))+Kt(56320+(1023&t));case 3:return Kt((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return Kt((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}}function Bt(e){return e.replace(Qt,Nt)}function Ut(e){var t=e.length,i=t%4,n=(0<t?Jt[e.charAt(0)]<<18:0)|(1<t?Jt[e.charAt(1)]<<12:0)|(2<t?Jt[e.charAt(2)]<<6:0)|(3<t?Jt[e.charAt(3)]:0),a=[Kt(n>>>16),Kt(n>>>8&255),Kt(255&n)];return a.length-=[0,0,2,1][i],a.join("")}function Gt(e){return Xt(String(e).replace(/[-_]/g,function(e){return"-"==e?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))}var Ht,Ft=Ft||{},jt=Ft.Base64,Wt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Jt=function(e){for(var t={},i=0,n=e.length;i<n;i++)t[e.charAt(i)]=i;return t}(Wt),Kt=String.fromCharCode,Vt=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,zt=Ft.btoa?function(e){return Ft.btoa(e)}:function(e){return e.replace(/[\s\S]{1,3}/g,Lt)},Qt=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,Yt=Ft.atob?function(e){return Ft.atob(e)}:function(e){return e.replace(/\S{1,4}/g,Ut)},Xt=function(e){return Bt(Yt(e))};Ft.Base64={VERSION:"2.5.2",atob:function(e){return Yt(String(e).replace(/[^A-Za-z0-9\+\/]/g,""))},btoa:zt,fromBase64:Gt,toBase64:Dt,utob:Mt,encode:Dt,encodeURI:function(e){return Dt(e,!0)},btou:Bt,decode:Gt,noConflict:function(){var e=Ft.Base64;return Ft.Base64=jt,e},__buffer__:Ht};var Zt=Ft.Base64;function ei(t){var e,n,i=$.Deferred();return e={urlKey:T.AUTH_TYPE[t.authType].getVidUrlKey,auth:T.AUTH_TYPE[t.authType].appType,redirectUrl:t.redirectUrl||T.AUTH_TYPE[t.authType].redirectUrl,visitorId:t.visitorId,kfuin:t.kfuin,appid:t.appid,openid:t.openid,authDomain:t.authDomain,code:t.code},n=$.Deferred(),(e.kfuin||e.openid||e.appid?($.ajax({url:T.CGI_URL[e.urlKey],type:"GET",data:{kfuin:e.kfuin,auth:e.auth,visitorId:e.visitorId,appid:e.appid,openid:e.openid,code:e.code,authDomain:e.authDomain,redirectUrl:e.redirectUrl},success:function(e){var t;0==(e=e||{}).code?n.resolve(e):(50101===e.r&&(t=$.i18n(T.SYS_MSG.getThirdVisitorIdError),w.chatBody.hasClass("regsuccess")||w.chatBody.hasClass("reconnect")?I({msgType:"serverResp",data:t,act:"new"}):w.chatListWrap.find(".tencent-certification").before(['<section class="msg-sys">','<div class="text">'+t+"</div>","</section>"].join(""))),n.reject(e))},error:function(e,t){var i={code:e.status,msg:t};n.reject(i)}}),n.promise()):n.reject({code:-1,msg:"参数错误"})).then(function(e){i.resolve({kfuin:t.kfuin,appid:t.appid,openid:t.openid,visitorId:e.data.visitorId,secretKey:e.data.secretKey,isRoamMessage:e.data.isRoamMessage})},function(e){i.reject(e)}),i.promise()}function ti(a){var e,t,o,s,r=$.Deferred(),i=J(a.url,"kfuin")||0,n=J(a.url,"openid"),c=J(a.url,"code"),l=J(a.url,"appid"),d=J(a.url,"authDomain"),f=ce(),p=decodeURIComponent(J(a.url,"userinfo")),u={userinfo:p,visitorId:f,authType:a.authType};i&&(u.kfuin=i),n&&(u.openid=n),c&&(u.code=c),l&&(u.appid=l),(d||T.AUTH_TYPE[a.authType].authDomain)&&(u.authDomain=d||T.AUTH_TYPE[a.authType].authDomain);try{p=JSON.parse(p),S.thirdAppConfig.userInfo=p}catch(e){S.thirdAppConfig.userInfo={}}return T.AUTH_TYPE[a.authType].needGetOpenid?function(e){var n=$.Deferred();if(!e.kfuin||!e.code||!e.appid)return n.reject({code:-1,msg:"参数错误"});var t="WXMP_OPENID_"+e.appid,i=L.get(t);return i?n.resolve({code:0,msg:"",data:{openid:i}}):($.ajax({url:T.CGI_URL.GET_WX_MP_OPENID+"?kfuin="+e.kfuin,type:"GET",dataType:"json",data:e,success:function(e){0==(e=e||{}).code?(e&&e.data&&e.data.openid&&L.set(t,e.data.openid),n.resolve(e)):n.reject(e)},error:function(e,t){var i={code:e.status,msg:t};n.reject(i)}}),n)}(u).then(function(e){0==e.code&&(u.openid=e.data.openid,ei(u).then(function(e){r.resolve(e)},function(e){r.reject(e)}))},function(e){r.reject(e)}):T.AUTH_TYPE[a.authType].ssoIframe?u.code?(e=L.get("QIDIAN_MESSAGE_INFO"),u.redirectUrl=L.get("CURRENT_REDIRECT_URL")||T.AUTH_TYPE[u.authType].redirectUrl,window.history&&window.history.replaceState&&(t=window.location.href,t=K(t,"code"),t=K(t,"response_type"),t=K(t,"session_state"),t=K(t,"scope"),t=K(t,"nonce"),e&&"null"!==e&&(t=t+"&msgInfo="+e,L.remove("QIDIAN_MESSAGE_INFO")),window.history.replaceState({},"",t)),ei(u).then(function(e){r.resolve(e)},function(e){r.reject(e)})):((o=Me({src:"https://"+u.authDomain+T.AUTH_TYPE[a.authType].ssoIframeUrl})).style.cssText="position: fixed; width: 0; height: 0; top: 0; left: 0; z-index: 999; border: none; background: none;",s=null,y.receive(S.win,function(e){var t,i,n;s||("AUTH"===e.QD_PM&&(u.code=e.code,o&&o.parentNode&&o.parentNode.removeChild(o),ei(u).then(function(e){r.resolve(e)},function(e){r.reject(e)})),"checkCookie"===e.id&&("1"===e.state?o.style.cssText="position: fixed; width: 100%; height: 100%; top: 0; left: 0; z-index: 999; border: none; background: none;":(t=J(a.url,"msginfo"),L.set("QIDIAN_MESSAGE_INFO",t),i=K(window.location.href,"msgInfo"),n="https://"+u.authDomain+T.AUTH_TYPE[a.authType].ssoIframeUrl+encodeURIComponent("?queryString="+encodeURIComponent(i)),L.set("CURRENT_REDIRECT_URL",T.AUTH_TYPE[u.authType].redirectUrl+"?queryString="+i),window.location.href=n))),s=!0})):ei(u).then(function(e){r.resolve(e)},function(e){r.reject(e)}),r.promise()}var ii=function(e){var t="other";return/(ipad|iphone|ipod).*? (ipad)?qq\/([\d.]+)|\bv1_and_sqi?_([\d.]+)(.*? qq\/([\d.]+))?/i.test(e)?t="mqq":/micromessenger/i.test(e)&&(t="wechat"),t};function ni(){var e=navigator.userAgent||navigator.vendor||window.opera;return/windows phone/i.test(e)?"Windows Phone":/android/i.test(e)?"Android":/iPad|iPhone|iPod/.test(e)&&!window.MSStream?"iOS":"unknown"}var ai=150,oi=1e3,si=100,ri=5e4,ci=2592e5,li=ni(),di=0,fi={},pi=0,ui=0,gi=null,mi="init",_i=null,hi=null,vi=!1,qi=null,yi=null,bi=null,Ti={};function Si(e,t){var i=void 0,n=void 0;switch(e){case"countdown":void 0!==t.text&&(i=qi.find(".voice-icon")).length&&i.removeClass().addClass("voice-icon").text(t.text);break;case"recording":case"cancel":(i=qi.find(".voice-icon")).length&&(i.text(""),i.removeClass().addClass("voice-icon").addClass(e))}void 0!==t.tip&&(n=qi.find(".voice-tip"),"cancel"===e?n.addClass("voice-tip--cancel"):n.removeClass("voice-tip--cancel"),n.find("span").text(t.tip))}function wi(){qi&&qi.length&&qi.remove()}function Ci(){mi="init",ui=pi=di=0,vi=!(fi={}),clearTimeout(gi),clearTimeout(_i),clearInterval(hi),wi(),yi&&yi.length&&yi.remove(),bi&&bi.length&&bi.remove(),w.btnRecord.text($.i18n("common_voicebtn_hold_text"))}function xi(e){var t=+new Date+S.serverClientTimeDiff,i={seq:e.seq,date:t,type:7,data:{date:t,channel:1,appId:S.thirdAppConfig.appid,mediaId:e.serverId,duration:e.duration,recordTime:+new Date,fileType:"amr",isTranslate:e.isTranslate,content:e.translateResult}};In.normal.render("c2b",i,"msg",!0,null,!0,!0,!1)}function ki(e){var t=$.Deferred();return wx&&wx.uploadVoice({localId:e,isShowProgressTips:0,success:function(e){t.resolve(e.serverId)},fail:function(e){t.reject(e),emonitorIns&&emonitorIns.log("error","wxvoice|upload voice fail: "+e.errMsg)}}),t.promise()}function Ei(){wi(),function(e){switch(e){case"uploading":yi.find("i").addClass("loading loading-s")}}(mi),bi&&bi.length&&bi.remove(),"Android"===li&&(bi=$('<span class="btn-toast"><span class="btn-toast__content">语音发送中</span></span>'),w.btnRecord.append(bi));var e,t,i=C(T.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PHP),n=parseInt((ui-pi)/1e3),a=yi;yi&&yi.length&&(yi.attr("data-guid",i),yi.attr("data-duration",n),yi=null),S.receptionist.isRobot?$.when(ki(Ti.localId),(e=Ti.localId,t=$.Deferred(),wx&&wx.translateVoice({localId:e,isShowProgressTips:0,success:function(e){t.resolve(e.translateResult)},fail:function(e){t.resolve(e),emonitorIns&&emonitorIns.log("error","wxvoice|translate voice fail: "+e.errMsg)}}),t.promise())).then(function(e,t){return"Android"===li&&Ci(),t?(xi({seq:i,serverId:e,duration:n,isTranslate:1,translateResult:t}),void(emonitorIns&&emonitorIns.log("info","wxvoice|translate and upload voice success"))):(a.remove(),void Y({text:"没有检测到语音内容，请重试"},1500))},function(e){"Android"===li&&Ci(),a.remove(),Y({text:e.errMsg},1500),emonitorIns&&emonitorIns.log("error","wxvoice|upload voice fail: "+e.errMsg)}):$.when(ki(Ti.localId)).then(function(e){"Android"===li&&Ci(),xi({seq:i,serverId:e,duration:n,isTranslate:0,translateResult:""}),emonitorIns&&emonitorIns.log("info","wxvoice|upload voice success")},function(e){"Android"===li&&Ci(),a.remove(),Y({text:e.errMsg},1500),emonitorIns&&emonitorIns.log("error","wxvoice|upload voice fail: "+e.errMsg)}),"iOS"===li&&Ci()}function Ii(){w.btnVoice.on("tap",function(e){var t,i,n;e.preventDefault(),emonitorIns&&emonitorIns.log("info","wxvoice|tap switch wxvoice button"),t=$.Deferred(),i="WXMP_JSSDK_ENABLE_RECORD_VOICE_"+S.thirdAppConfig.appid,!(n=L.get(i))||+n<new Date-ci?wx&&wx.startRecord({success:function(){setTimeout(function(){wx&&wx.stopRecord({success:function(){L.set(i,Date.now()),t.resolve()},fail:function(e){Y({text:e.errMsg},1500),t.reject()}})},1500)},fail:function(e){emonitorIns&&emonitorIns.log("error","wxvoice|try record voice fail: "+e.errMsg),t.reject()},cancel:function(e){emonitorIns&&emonitorIns.log("error","wxvoice|try record voice cancel: "+e.errMsg),t.reject()}}):t.resolve(),t.promise().then(function(){emonitorIns&&emonitorIns.log("info","wxvoice|show record wxvoice button"),w.chatPost.removeClass("off-voice").addClass("on-voice"),w.chatPost.find("textarea").trigger("slideDown")})}),w.btnVoice.on("contextmenu",function(e){e.preventDefault()}),w.btnKeyboard.on("tap",function(e){e.preventDefault(),w.chatPost.removeClass("on-voice").addClass("off-voice"),w.chatPost.find("textarea").trigger("slideDown")}),w.btnKeyboard.on("contextmenu",function(e){e.preventDefault()})}function Ri(){wx&&wx.onVoiceRecordEnd({complete:function(e){mi="uploading",ui=+new Date,Ti.localId=e.localId,Ei(),w.btnRecord.text($.i18n("common_voicebtn_hold_text"))}}),w.btnRecord.on("touchstart",function(e){e.preventDefault();var t=e.touches[0];fi.x1=t.pageX,fi.y1=t.pageY,w.btnRecord.text($.i18n("common_voicebtn_release_text")),new Date,"init"===mi&&(mi="starting",gi=setTimeout(function(){mi="invoking",wx&&wx.startRecord({success:function(){pi=+new Date,function(e){switch(qi&&qi.length&&qi.remove(),e){case"recording":qi=$($.tmpl(T.CHAT_MSG_TPL.voiceTip,{icon:e,tip:"手指上滑，取消发送"}))}w.chatList.append(qi)}(mi="recording"),function(e){switch(yi&&yi.length&&yi.remove(),e){case"recording":yi=$($.tmpl(T.CHAT_MSG_TPL.c2bVoiceRecording,{}))}w.chatListWrap.find(".tencent-certification").before(yi),w.chatListWrap[0].scrollTop=w.chatListWrap[0].scrollHeight-w.chatListWrap.height()}(mi);var e=10;_i=setTimeout(function(){if(vi=!0,qi&&qi.length){if(Math.abs(fi.y1-fi.y2)>si)return;Si("countdown",{text:e,tip:"即将发送语音"})}hi=setInterval(function(){if(--e<0)clearInterval(hi);else if(qi&&qi.length){if(Math.abs(fi.y1-fi.y2)>si)return;Si("countdown",{text:e})}},1e3)},ri)},fail:function(e){Ci(),Y({text:e.errMsg},1500),emonitorIns&&emonitorIns.log("error","wxvoice|record voice fail: "+e.errMsg)},cancel:function(e){Ci(),Y({text:e.errMsg},1500),emonitorIns&&emonitorIns.log("error","wxvoice|record voice cancel: "+e.errMsg)}})},ai))}),w.btnRecord.on("touchend",function(e){var t;if((e.preventDefault(),w.btnRecord.text($.i18n("common_voicebtn_hold_text")),di=+new Date,"starting"===mi||"invoking"===mi||"recording"===mi)&&("starting"===mi&&(Ci(),emonitorIns&&emonitorIns.log("info","wxvoice|touchend|"+mi)),"invoking"===mi&&(t=setInterval(function(){"recording"==mi?wx&&wx.stopRecord({success:function(){clearInterval(t),Ci(),emonitorIns&&emonitorIns.log("info","wxvoice|touchend|"+mi)},fail:function(e){Ci(),Y({text:e.errMsg},1500),emonitorIns&&emonitorIns.log("error","wxvoice|"+mi+"|stop voice fail: "+e.errMsg)}}):(Ci(),emonitorIns&&emonitorIns.log("info","wxvoice|touchend|"+mi))},500)),"recording"===mi)){if(Math.abs(fi.y1-fi.y2)>si)return void(wx&&wx.stopRecord({success:function(){Ci(),emonitorIns&&emonitorIns.log("info","wxvoice|touchend|user cancel|"+mi)},fail:function(e){Ci(),emonitorIns&&emonitorIns.log("error","wxvoice|"+mi+"|user cancel|stop voice fail: "+e.errMsg)}}));di-pi<oi?wx&&wx.stopRecord({success:function(){Y({text:"说话时间太短"},1500),Ci(),emonitorIns&&emonitorIns.log("info","wxvoice|touchend|min voice time|"+mi)},fail:function(e){Y({text:"说话时间太短"},1500),Ci(),emonitorIns&&emonitorIns.log("error","wxvoice|"+mi+"|min voice time|stop voice fail: "+e.errMsg)}}):wx&&wx.stopRecord({success:function(e){mi="uploading",ui=+new Date,Ti.localId=e.localId,Ei()},fail:function(e){Y({text:e.errMsg},1500),Ci(),emonitorIns&&emonitorIns.log("error","wxvoice|"+mi+"|user touchend|stop voice fail: "+e.errMsg)}})}}),w.btnRecord.on("touchmove",function(e){e.preventDefault();var t,i=e.touches[0];fi.x2=i.pageX,fi.y2=i.pageY,"recording"===mi&&(t=Math.abs(fi.y1-fi.y2),si<t?(w.btnRecord.text($.i18n("common_voicebtn_cancel_text")),qi&&qi.length&&Si("cancel",{tip:"松开手指，取消发送"})):(w.btnRecord.text($.i18n("common_voicebtn_release_text")),qi&&qi.length&&(vi?Si("countdown",{tip:"即将发送语音"}):Si("recording",{tip:"手指上滑，取消发送"}))))}),w.btnRecord.on("touchcancel",function(){"recording"===mi&&wx&&wx.stopRecord({success:function(){Ci()},fail:function(){Ci()}}),Ci()}),w.btnRecord.on("contextmenu",function(e){e.preventDefault()}),document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&"recording"===mi&&wx&&wx.stopRecord({success:function(){Ci()},fail:function(){Ci()}})})}var $i=function e(t){t.platform,t.app,t.uin;var i,n,a,o=t.flag1,s=t.flag2,r=t.flag3,c=window.performance||window.webkitPerformance||window.msPerformance,l=["navigationStart","unloadEventStart","unloadEventEnd","redirectStart","redirectEnd","fetchStart","domainLookupStart","domainLookupEnd","connectStart","connectEnd","requestStart","responseStart","responseEnd","domLoading","domInteractive","domContentLoadedEventStart","domContentLoadedEventEnd","domComplete","loadEventStart","loadEventEnd"],d=[],f=null!=t.points&&"[object Object]"==toString.apply(t.points)?t.points:null;if(null!=f){for(var p in f)d.push(p+"="+f[p]);if(0!=d.length)return void m()}if(c&&(i=c.timing)){n=i[l[0]];for(var u=1,g=l.length;u<g;u++)void 0!==i[l[u]]&&0<i[l[u]]&&0<(a=i[l[u]]-n)?d[u]=u+"="+a:d[u]=u+"=0";m()}function m(){t.reportUrl,encodeURIComponent("flag1="+o+"&flag2="+s+"&flag3="+r+"&"+d.join("&"))}t.points&&e(t)},Oi='<?xml version="1.0" encoding="utf-8"?><msg brief="广交会商品" flag="55" serviceID="21" action="web" action.web="browser" action.pc="browser" actionData="<%= o.pLink || o.productLink %>">\n    <linear width="-1" width.pc="400" height="-2" background.web="#FFFFFFFF">\n    \t<linear width="-1" height="-2" margin="20,20,20,20" orientation="vertical">\n\t        <linear width="-1" width.pc="-2" height="-2" margin="0,0,0,0" orientation="horizontal">\n\t            <image name="ShowIcon" width="144" width.pc="72" height="144" height.pc="72" cornerRadius="6" cornerRadius.android="0" src="<%= o.pImg || o.productImage %>"/>\n\t            <linear width="0" weight="1" height="-1" width.pc="-2" height.pc="-2" margin="20,0,0,0" orientation="vertical">\n\t                <text width="-1" width.pc="270" height="-2" margin="0,0,0,0" text="<%= o.pName || o.productName %>" size="28" size.pc="12" style="bold" lineSpace.web="8" maxLine="2"/>\n\t                <text width="-1" width.pc="270" height="-2" margin="0,5,0,0" text="$$$xml_product_exhibition_area$$$: <%= o.pExArea || o.productArea %>" size="24" size.pc="12" color="#FF666666" color.pc="0xFF666666" lineSpace.web="8" maxLine="2"/>\n\t            </linear>\n\t        </linear>\n\t    \t<divider width="-1" height="1" margin="0,20,0,15"/>\n            <image width="-1" height="1" src="" margin="3,7,3,7" icon="divider" platform="pc"/>\n            <text width="-1" height="-2" margin="0,5,0,0" text="$$$xml_buyer_name$$$: <%= o.bName || o.buyerName %>" size="28" size.pc="12" color="#FF666666" color.pc="0xFF666666"/>\n            <text width="-1" height="-2" margin="0,5,0,0" text="$$$xml_buyer_location$$$: <%= o.bLoc || o.buyerLoc %>" size="28" size.pc="12" color="#FF666666" color.pc="0xFF666666"/>\n            <text width="-1" height="-2" margin="0,5,0,0" text="$$$xml_buyer_tag$$$: <%= o.bTag || o.buyerTag %>" size="28" size.pc="12" color="#FF666666" color.pc="0xFF666666"/>\n    \t</linear>\n    </linear>\n</msg>',Ai='<?xml version="1.0" encoding="utf-8"?><msg brief="广交会意向单" flag="55" serviceID="21">\n    <linear width="-1" width.pc="400" height="-2" background.web="#FFFFFFFF">\n        <linear width="-1" height="-2" margin="20,20,20,20" orientation="vertical">\n            <text width="-1" height="-2" margin="0,0,0,15" text="<%= o.sn %>" size="32" size.pc="14" style="bold"/>\n            <text width="-1" height="-2" margin="0,5,0,0" text="$$$xml_buyer_name$$$: <%= o.bName || o.buyerName %>" size="28" size.pc="12" color="#FF666666" color.pc="0xFF666666"/>\n            <text width="-1" height="-2" margin="0,5,0,0" text="$$$xml_buyer_location$$$: <%= o.bLoc || o.buyerLoc %>" size="28" size.pc="12" color="#FF666666" color.pc="0xFF666666"/>\n            <text width="-1" height="-2" margin="0,5,0,0" text="$$$xml_buyer_tag$$$: <%= o.bTag || o.buyerTag %>" size="28" size.pc="12" color="#FF666666" color.pc="0xFF666666"/>\n            <divider width="-1" height="1" margin="0,20,0,15" style="dot"/>\n            <image width="-1" height="1" src="" margin="3,7,3,7" icon="divider" platform="pc"/>\n            <text width="-1" height="-2" margin="0,5,0,0" text="$$$xml_product_exhibition_area$$$: <%= o.pExArea || o.productArea %>" size="28" size.pc="12" color="#FF666666" color.pc="0xFF666666"/>\n            <text width="-1" height="-2" margin="0,5,0,0" text="$$$xml_product_category$$$: <%= o.pCategory || o.productCategory %>" size="28" size.pc="12" color="#FF666666" color.pc="0xFF666666"/>\n            <%if(o.pName || o.productName){%><text width="-1" height="-2" margin="0,5,0,0" text="$$$xml_product_name$$$: <%= o.pName || o.productName %>" size="28" size.pc="12" color="#FF666666" color.pc="0xFF666666"/><%}%>\n            <%if(o.pQuantity || o.purchaseQuantity){%><text width="-1" height="-2" margin="0,5,0,0" text="$$$xml_purchase_quantity$$$: <%= o.pQuantity || o.purchaseQuantity %>" size="28" size.pc="12" color="#FF666666" color.pc="0xFF666666"/><%}%>\n            <%if(o.pUnit || o.purchaseUnit){%><text width="-1" height="-2" margin="0,5,0,0" text="$$$xml_purchase_unit$$$: <%= o.pUnit || o.purchaseUnit %>" size="28" size.pc="12" color="#FF666666" color.pc="0xFF666666"/><%}%>\n        </linear>\n    </linear>\n</msg>';function Mi(){var e,n,t,i,a,o,s,r=S.isInIframe,c=S.win.location.href,l=void 0;if(r||(l=J(c,"msginfo")),l)try{l=decodeURIComponent(l),l=JSON.parse(l);var d=(s=1,((o=l).itemId&&(o.buyerId||o.userId)||o.orderId&&(o.buyerId||o.userId))&&(s=2),s);1===d?l&&l.msgId&&Li(l,$.tmpl(Pi(l.msgId),l,null,{ignoreStyleRender:!0})):2===d&&l&&l.msgId&&(e=l,n=$.Deferred(),t=S.receptionist.kfUin,i=S.win.location.href,a={type:"31",kfuin:t,apiDomain:J(i,"apiDomain")||"openapi.cantonfair.org.cn",authDomain:J(i,"authDomain")||"auth.cantonfair.org.cn",msgId:e.msgId,itemId:e.itemId,buyerId:e.buyerId,orderId:e.orderId,userId:e.userId,lang:S.lang,isMsite:!!S.isMobile},$.ajax({url:T.CGI_URL.GET_MSG_INFO_DATA+"?kfuin="+t,type:"GET",data:a,success:function(e){0==+e.r&&n.resolve(e.msgInfo)},error:function(e,t){var i={code:e.status,msg:t};n.reject(i)}}),n.promise().then(function(e){Li(l,$.tmpl(Pi(l.msgId),e,null,{ignoreStyleRender:!0}))}))}catch(e){BJ_REPORT&&BJ_REPORT.report(e)}}function Li(e,t){var i,n=+new Date+S.serverClientTimeDiff,a=[C(T.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PHP),e.msgId].join(""),o=function(e){{if(1==+e)return"[其他消息]";if(2==+e)return"[其他消息]"}}(e.msgId);In.normal.render("c2b",{brief:o,data:t,type:8,date:n,seq:a}),S.isInIframe||(i=window.location.href,i=K(i,"msginfo"),window.history&&window.history.replaceState&&window.history.replaceState({},"",i))}function Pi(e){return 1==+e?ye(Oi):2==+e?ye(Ai):void 0}var Di=r();function Ni(t){var e,i,n=S.win.location.href,a=(ii(S.userAgent),J(n,"auth")),o=J(n,"code"),s=J(n,"userinfo");try{s=JSON.parse(decodeURIComponent(s))}catch(e){s={}}if(("wx_mp"===a||"wx_mix"===a)&&(S.wxConfig.enableVoice=!0,e={url:n,callback:function(){S.wxConfig.enableVoice&&(w.chatPost.addClass("enable-voice off-voice"),w.btnRecord=$(".voice-area .btn-record"),w.btnRecord.text($.i18n("common_voicebtn_hold_text")),emonitorIns&&emonitorIns.log("info","wxvoice|render switch wxvoice button"),Ii(),Ri())}},i=$.Deferred(),vt(e).then(function(){i.resolve()},function(e){i.reject(e)}),i.promise().then(function(){},function(e){Y({text:e&&e.msg||"未知错误，请重试"},1e3)}),!o))return s&&(S.thirdAppConfig.enable=!0,S.thirdAppConfig.authType=a,S.thirdAppConfig.type=T.AUTH_TYPE[a].name,S.thirdAppConfig.appType=T.AUTH_TYPE[a].appType,S.thirdAppConfig.userInfo=s),Bi(t),0;"31"===a?($(".chat-post").addClass("chat-post--no-upload"),$(".chat-post .btn-upload").remove()):$(".chat-post .btn-upload").show(),T.AUTH_TYPE[a]?T.AUTH_TYPE[a].getVidUrlKey?ti({url:n,authType:a}).then(function(e){S.thirdAppConfig.enable=!0,S.thirdAppConfig.authType=a,S.thirdAppConfig.type=T.AUTH_TYPE[a].name,S.thirdAppConfig.appType=T.AUTH_TYPE[a].appType,S.thirdAppConfig.appId=e.appid,S.thirdAppConfig.openId=e.openid,S.thirdAppConfig.secretKey=e.secretKey,S.thirdAppConfig.visitorId=e.visitorId,S.receptionist.visitorId=e.visitorId,S.thirdAppConfig.isRoamMessage=e.isRoamMessage,le(e.visitorId),Bi(t)},function(e){}):(delete s.avatar,S.thirdAppConfig.enable=!0,S.thirdAppConfig.authType=a,S.thirdAppConfig.type=T.AUTH_TYPE[a].name,S.thirdAppConfig.appType=T.AUTH_TYPE[a].appType,S.thirdAppConfig.userInfo=s,Bi(t)):Bi(t)}function Bi(e){var t,i=S.win.location.href,n=ce({active:!!J(i,"visitorId"),url:S.win.location.href}),a={visitorId:n,cate:7,type:10,pid:Di,qid:Di,clickType:6,tptype:9,eptype:S.isMobile?2:1,tpForm:2},o={},s={};["kfuin","roleValue","roleData","fid","clickid","waitTime","callImType","wpaShowItemId","qidian_track_id","qidian_src_desc","qidian_ex1","qidian_ex2","qidian_ex3","qidian_ex4","qidian_ex5","guestId","qidian_lang"].forEach(function(e){a[e]=J(i,e)}),a.kfuin||(a.kfuin=0),t=a.kfuin+"-"+n,$.extend(S.htReportOpts,{uin:t}),BJ_REPORT&&BJ_REPORT.init({uin:S.htReportOpts.uin}),$i(S.htReportOpts),void 0!==a.clickid&&a.clickid?S.wpaDetail.clickid=a.clickid:S.wpaDetail.clickid=a.clickid=Di,o.visitorId=n,o.kfUin=a.kfuin,s.wpaId=J(i,"fid"),s.wpaKey=J(i,"key"),$.extend(S.receptionist,o),$.extend(S.wpaDetail,s),S.getSigTData=a,S.originRoleValue=a.roleValue,e&&e(),Mi(),Un(a)}var Ui,Gi,Hi={startTime:"SESSION_ROAM_START_TIME",endTime:"SESSION_ROAM_END_TIME",data:"SESSION_ROAM_DATA",isEnd:"SESSION_ROAM_END"},Fi=void 0,ji=0,Wi=10,Ji=!0,Ki=0,Vi=0,zi=0;function Qi(s,r){var c=$.Deferred();return Fi||(Fi="_"+S.thirdAppConfig.visitorId+"_"+S.receptionist.kfUin,Hi={startTime:Hi.startTime+Fi,endTime:Hi.endTime+Fi,data:Hi.data+Fi,isEnd:Hi.isEnd+Fi},Ki=window.parseInt(L.get(Hi.isEnd))||0),function(e){var i=$.Deferred(),t=function(e){var t=e.endTime,i=e.startIndex,n=e.pageSize,a=e.roamingIsEnd,o=Xi(),s=[],r=o.length,c=0,l={list:s,needFetch:!1,startIndex:i};if(l.needFetch=function(e){var t=e.endTime,i=e.list,n=e.startIndex,a=e.pageSize,o=e.roamingIsEnd,s=!1;if(0===t)return!0;var r=i.length;if(0===r)return!0;if((r-n+1)/a<.7&&!o)return!0;for(var c=n;c<n+a&&c<r;c++)if(i[c].breakpoint){s=!0;break}return s}({endTime:t,list:o,startIndex:i,pageSize:n,roamingIsEnd:a}),l.needFetch)return l;for(var d=i,f=i+n;d<f;d++){if(d===r&&1===a){c=1;break}if(!o[d])break;s.push(o[d]),i+=1}return l.list=s,l.isEnd=c,l.startIndex=i,l}({endTime:e,startIndex:Vi,pageSize:Wi,roamingIsEnd:Ki});Vi=t.startIndex,t.needFetch?function(e){var n=$.Deferred();return $.ajax({url:T.CGI_URL.GET_ROAMING_LIST+"?kfuin="+S.receptionist.kfUin,type:"GET",data:{secretKey:S.thirdAppConfig.secretKey,visitorId:S.thirdAppConfig.visitorId,startTime:0,endTime:0===e?(new Date).getTime():e,direction:1},dataType:"json",success:function(e){var t=e||{};0==t.code&&t.data&&t.data.data?n.resolve(t.data):n.reject(t)},error:function(e,t){var i={code:e.status,msg:t};n.reject(i)}}),n.promise()}(e).then(function(e){var t;0<e.data.length&&(t=e.data[e.data.length-1].date,L.set(Hi.endTime,t),function(e){var t,i=Xi(),n=e.length;if(i.length){Ji&&(i[0].breakpoint=!0,Ji=!1);for(var a=0;a<n;a++){var o=e[a];i[Vi]&&o.date===i[Vi].date?i[Vi].breakpoint&&delete i[Vi].breakpoint:i.splice(Vi,0,o),Vi+=1}}else i=i.concat(e),Vi=n;t=Zt.encode(JSON.stringify(i));try{L.set(Hi.data,t)}catch(e){}}(e.data),i.resolve(e))},function(e){i.reject(e)}):i.resolve({data:t.list,lastTime:t.list[t.list.length-1].date,isEnd:t.isEnd});return i.promise()}(s).then(function(e){var t=0;if(e.data&&e.data.length){for(var i=function(e){var t=[];if(e&&e.length)for(var i=0,n=e.length;i<n;i++){var a=e[i],o={avatar:"https://webpage.qidian.qq.com/qidian/chatClient/release/comp/img/default-avatar.png",data:a.data,date:a.date,img_type:a.img_type,seq:a.seq,time:a.time,type:a.type,vote:a.vote};2===a.dir?(o.dir="b2c",o.name=a.u_info?a.u_info.name:"",o.avatar=a.u_info?a.u_info.face:"https://webpage.qidian.qq.com/qidian/chatClient/release/comp/img/default-avatar.png"):(o.dir="c2b",o.singleSeqs=a),t.push(o)}return t}(e.data),n=i.length,a=0;a<n;a++){var o=i[a];o?(t=o.date,r(o,"up"),o.time&&4!=o.type&&w.chatListWrap.prepend(k(T.CHAT_MSG_TPL.time,tt(o.time)))):BJ_REPORT.report("History RenderRoaming Msg Error")}0===s&&(ji=w.chatListWrap[0].scrollHeight+60),1===e.isEnd&&(L.set(Hi.isEnd,1),Ki=1),c.resolve({data:e,lastTime:t,isEnd:e.isEnd})}},function(e){c.reject(e)}),c.promise()}function Yi(e,t,i){var n=void 0,n="fail"===t?$(k(T.CHAT_MSG_TPL.msgLoad.getMsg,$.i18n(T.VIEW_OPTS.HISTORY_MSG.GET_MSG_ERROR))):$(k(T.CHAT_MSG_TPL.msgLoad.getMsg,$.i18n(T.VIEW_OPTS.HISTORY_MSG.GET_MSG)));return w.chatListWrap.prepend(n),n.find("a").one(S.clickName,function(){n.html(k(T.CHAT_MSG_TPL.msgLoad.loading,$.i18n(T.VIEW_OPTS.HISTORY_MSG.LOADING))),ji=w.chatListWrap[0].scrollHeight,function i(n,a,o){Qi(a,o).then(function(e){var t=w.chatListWrap[0].scrollHeight;zi=0,setTimeout(function(){w.chatListWrap[0].scrollTop=t-ji,ji=t},20),n.remove(),0===e.isEnd&&Yi(e.lastTime,"success",o)},function(e){var t;e&&50073===e.r&&zi<3?(t=S.win.location.href,zi+=1,ti({url:t,authType:S.thirdAppConfig.authType}).then(function(e){S.thirdAppConfig.secretKey=e.secretKey,i(n,a,o)},function(e){zi=0,n.remove(),Yi(a,"fail",o)})):(zi=0,n.remove(),Yi(a,"fail",o))})}(n,e,i)}),n}function Xi(){var t=L.get(Hi.data);try{t=JSON.parse(Zt.decode(t))}catch(e){t=[]}return t||[]}function Zi(e){return"function"==typeof e||"[object Function]"===Ui.call(e)}function en(e){var t,i=(t=Number(e),isNaN(t)?0:0!==t&&isFinite(t)?(0<t?1:-1)*Math.floor(Math.abs(t)):t);return Math.min(Math.max(i,0),Gi)}function tn(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new nn,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];this.tag=e,this.props=t,this.children=i}function nn(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{};this.name=e,this.platform=t,this.style=i,this.action=n,this.attrs=a}Array.from||(Array.from=(Ui=Object.prototype.toString,Gi=Math.pow(2,53)-1,function(e,t,i){var n=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var a,o=1<arguments.length?t:void 0;if(void 0!==o){if(!Zi(o))throw new TypeError("Array.from: when provided, the second argument must be a function");2<arguments.length&&(a=i)}for(var s,r=en(n.length),c=Zi(this)?Object(new this(r)):new Array(r),l=0;l<r;)s=n[l],c[l]=o?void 0===a?o(s,l):o.call(a,s,l):s,l+=1;return c.length=r,c})),Array.prototype.reduce||Object.defineProperty(Array.prototype,"reduce",{value:function(e){if(null===this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof e)throw new TypeError(e+" is not a function");var t,i=Object(this),n=i.length>>>0,a=0;if(2<=arguments.length)t=arguments[1];else{for(;a<n&&!(a in i);)a++;if(n<=a)throw new TypeError("Reduce of empty array with no initial value");t=i[a++]}for(;a<n;)a in i&&(t=e(t,i[a],a,i)),a++;return t}}),tn.prototype.addChild=function(){this.children||(this.children=[]),this.children.push(child)};var an={all:"",pc:"pc",mobile:"mobile",ios:"ios",android:"android",web:"web",mac:"mac"},on=["width","height","gravity","weight","padding","paddingLeft","paddingRight","paddingTop","paddingBottom","margin","marginLeft","marginRight","marginTop","marginBottom","aspectRatio","background","backgroundIcon","alpha","cornerRadius","borderWidth","borderColor","borderStyle","hidden"],sn=["click","change","blur","focus","action","actionData"],rn={H:{left:"flex-start",right:"flex-end",centerHorizontal:"center"},V:{top:"flex-start",bottom:"flex-end",centerVertical:"center"}},cn={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15};S.isMobile;function ln(e){var t=+e;return isNaN(t)||0==t?"0px":1==t?t+"px":t/2+"px"}function dn(e){function t(e){var n=Array.from(e);return Array.from(n).reduce(function(e,t,i){return e+cn[t]*Math.pow(16,n.length-i-1)},0)}var i=t(e.slice(1,3))/255;return"rgba("+t(e.slice(3,5))+", "+t(e.slice(5,7))+", "+t(e.slice(7,9))+", "+i+")"}function fn(e){var t,i=[];for(var n in e)i.push(("_"===(t=(t=n).replace(/[A-Z]/g,function(e){return"-"+e.toLowerCase()})).slice(0,1)&&(t=t.slice(1)),t+": "+e[n]));return i.join(";")}function pn(e){return"true"===e||"false"!==e&&e}function un(e,t){for(var i,n,a,o=e.attributes,s=e.children,r=e.childNodes,c=t.props,l=0,d=o.length;l<d;l++){var f=o[l],p=f.name;if(p.indexOf(".")){var u=p.split(".");if(2===u.length){if(u[1]!==an.web)continue;p=u[0]}}"name"!==p&&"platform"!==p?-1===on.indexOf(p)?-1===sn.indexOf(p)?c.attrs[p]=pn(f.value):c.action=$.extend(c.action,(i=p,n=f.value,a=c.action,"action"===i?a.actionCmd=n:"actionData"===i&&(a.actionData=n),a)):c.style=$.extend(c.style,function(e,t){var i,n,a,o,s={},r=void 0;function c(e,t){return rn[e][t]}switch(e){case"width":"-1"===t?(s.display="block",s.width="100%"):"-2"===t?(s.display="inline-block",s.width="auto"):(s.display="block",s.width=ln(t));break;case"height":s.height="-1"===t?"100%":"-2"===t?"auto":ln(t);break;case"paddingLeft":case"paddingRight":case"paddingTop":case"paddingBottom":case"marginLeft":case"marginRight":case"marginTop":case"marginBottom":s[e]=ln(t);break;case"padding":case"margin":var l=(r=t.split(",")).shift();r.push(l),s[e]=r.map(ln).join(" ");break;case"gravity":s.display="flex";1<(r=t.split("|")).length?(n=(i=b(r,2))[0],a=i[1],s.justifyContent=c("H",n),s.alignItems=c("V",a)):(o=b(r,1)[0],~["left","right","centerHorizontal"].indexOf(o)&&(s.justifyContent=c("H",o)),~["top","bottom","centerVertical"].indexOf(o)&&(s.alignItems=c("V",o)),"center"===o&&(s.justifyContent=rn.H.centerHorizontal,s.alignItems=rn.V.centerVertical));break;case"weight":s.flexGrow=Number(t);break;case"background":s.backgroundColor=dn(t);break;case"alpha":s.opacity=Number(t);break;case"cornerRadius":s.borderRadius=ln(t);break;case"borderWidth":s.borderWidth=ln(t);break;case"borderColor":s.borderColor=dn(t);break;case"borderStyle":s.borderStyle=t;break;case"hidden":var d=pn(t);s.display=d?"none":"block"}return s}(p,f.value)):c[p]=f.value}var g=s;if(void 0===g){g=[];for(var m=0,_=r.length;m<_;m++)r[m]&&3!==r[m].nodeType&&g.push(r[m])}if(g&&g.length)for(var h=0,v=g.length;h<v;h++){var q=g[h],y=new tn(q.tagName);un(q,y),y.props.platform&&y.props.platform!==an.web||t.children.push(y)}}"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(e),n=1;n<arguments.length;n++){var a=arguments[n];if(null!=a)for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(i[o]=a[o])}return i},writable:!0,configurable:!0});var gn={msg:{render:function(e,t){var i=e.props.action;return"browser"!==i.actionCmd&&"web"!==i.actionCmd?'<div class="msg-xml-container"><i></i>'+t+"</div>":'<a target="_blank" href="'+(/^http(s)?/.test(i.actionData)?i.actionData:"javascript:;")+'" class="msg-xml-container"><i></i>'+t+"</a>"}},text:{render:function(e){var t,i,n,a,o,s,r=e.props,c=r.attrs,l=r.style,d=c.color,f=c.size,p=c.style,u=c.overflow,g=void 0===u?"dot":u,m=c.maxLine,_=void 0===m?0:m,h=c.lineSpace,v=$.extend({},l);return d&&(v.color=dn(d)),f&&(v.fontSize=ln(f)),p&&(v=Object.assign({},v,(t={},~(i=p.split("|")).indexOf("bold")&&(t.fontWeight="bold"),~i.indexOf("italic")&&(t.fontStyle="italic"),~i.indexOf("underline")&&(t.textDecoration="underline"),~i.indexOf("delete")&&(t.textDecoration="line-through"),t))),h&&(n=v.fontSize||"14px",a=parseInt(n,10)+parseInt(ln(h),10)+"px",v.lineHeight=a),v.wordWrap="break-word",(g||_)&&(v.overflow="hidden",_&&(o=parseInt(v.fontSize||"14px",10),s=parseInt(v.lineHeight||1.5*o+"px",10)*_+"px",v.maxHeight=s,v.display="-webkit-box",v.WebkitBoxOrient="vertical",v.WebkitLineClamp=_)),'<div title="'+x(c.text)+'" style="'+fn(v)+'">'+x(c.text)+"</div>"}},image:{render:function(e){var t=e.props,i=t.attrs,n=t.style,a=n.width,o=n.height;return'<div style="'+fn(n)+'"><img style="width: '+a+"; height: "+o+';" src="'+i.src+'"/></div>'}},linear:{render:function(e,t){var i=e.props,n=i.attrs,a=i.style,o=i.action,s=$.extend({},a),r=n.orientation,c=void 0===r?"horizontal":r;return s.display="flex","horizontal"===c?s.flexDirection="row":"vertical"===c&&(s.flexDirection="column"),"none"===a.display&&(s.display="none"),"vertical"===c&&(a.justifyContent&&("center"===a.justifyContent?(s.alignItems="center",s.textAlign="center"):"flex-start"===a.justifyContent?(s.alignItems="flex-start",s.textAlign="left"):"flex-end"===a.justifyContent&&(s.alignItems="flex-end",s.textAlign="right"),a.alignItems||delete s.justifyContent),a.alignItems&&("center"===a.alignItems?s.justifyContent="center":"flex-start"===a.alignItems?s.justifyContent="flex-start":"flex-end"===a.alignItems&&(s.justifyContent="flex-end"),a.justifyContent||delete s.alignItems)),"browser"===o.actionCmd||"web"===o.actionCmd?'<a target="_blank" href="'+o.actionData+'" style="'+fn(s)+'">'+t+"</a>":'<div style="'+fn(s)+'">'+t+"</div>"}},divider:{render:function(e,t){var i=e.props.style;return'<div class="msg-xml-divider" style="'+fn($.extend({},i))+'">'+t+"</div>"}}};function mn(e,t){return'<div class="msg-'+(t.dir||"c2b")+" msg-xml "+(t.className||"")+'" data-guid="'+t.seq+'">'+function e(t){for(var i=t.tag,n=t.children,a=[],o=0,s=n.length;o<s;o++)a.push(e(n[o]));var r=gn[i];if(r)return r.render(t,a.join(""));throw new Error("unknown tag")}(e)+"</div>"}var _n={render:function(e,t){var i,n,a=function(e){if(!window.DOMParser)return null;try{return(new DOMParser).parseFromString(e.trim(),"text/xml")}catch(e){return null}}(e.data);if(a)return mn((i=a.querySelector("msg"),n=new tn("msg"),un(i,n),n),t)},handleAck:function(e,t){var i,n,a,o,s,r=e.seq||"",c=w.chatListWrap.find('[data-guid="'+r+'"]');"success"===t&&c&&c.length&&c.hasClass("msg-xml")&&((n=["","sysmsg_send_product_xml_msg","sysmsg_send_sheet_xml_msg"])[i=r[r.length-1]]&&(a=+new Date,I({msgType:"serverResp",data:$.i18n(n[i]),act:"new",seq:a}),s=(o=$('[data-guid="'+a+'"]')).find("a").attr("href"),s+="?f_uin="+S.receptionist.kfUin+"&channel=webim",o.find("a").attr("href",s)))}},hn=Rt(),vn=function(e,t){var i;"0"==S.isRealSendMsg&&(i={},1!==e&&2!==e||(1===(i.replyType=e)?i.replyText=t:i.fileId=t,i.action=5,nt().actRpt(i)))};function qn(e,t){var i=t.code;switch(0!==i&&BJ_REPORT.report("Image Upload Error "+JSON.stringify(t)),i){case 0:Ze("c2b",{data:t.fileId,seq:e.seq,wordMsgSeq:C(T.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PC),date:e.date,type:2,imgSrc:t.uri},"msg"),t._raw&&(e.blobUrl=t.uri,replacePlaceholder(e)),vn(2,t.fileId),$('[data-guid="'+e.seq+'"]').find("i").removeClass();break;case 1:xn().sendFail(e,"overSumLimit");break;case 2:xn().sendFail(e,"notSupport");break;default:xn().sendFail(e,"uploadError")}}function yn(e){return e.replace(ot,function(e){return'<a href="'+st(e)+'" target="_blank" class="text-link">'+e+"</a>"})}function bn(e,i,t){var n,d,a=e.is("img")?e:e.find("p.image");function o(e){y.send({act:"OPEN_IMG",data:{url:e}})}S.isMobile?a.off("tap").on("tap",function(){at(function(t){t.append('<img class="big-image" src="'+i+'"/>'),t.on("touchend",function(e){t.remove()})})}):a.off("click").on("click",function(e){S.isInIframe?t?((n=new FileReader).onload=function(e){o(e.target.result)},n.readAsDataURL(t.content)):o(i):(d=i||t.blobUrl,at(function(t){var e,i,n,a,o,s,r,c,l;t.append('<div class="img-wrap"><img class="" src=""/><a href="javascript:;" class="btn-close"></a></div>'),e=t,i=d,n=new Image,a=$(window),s={width:1,height:1},r={width:o=0,height:0},c={width:a.innerWidth()-160,height:a.innerHeight()},l={width:0,height:0},n.onload=function(){return r={width:n.width,height:n.height},o=Math.max(r.width,r.height),s={width:r.width/r.height,height:r.height/r.width},r.width<=c.width&&r.height<=c.height?l={width:r.width,height:r.height}:r.width==o?(l.width=c.width,l.height=Math.floor(l.width*s.height)):(l.height=c.height,l.width=Math.floor(l.height*s.width)),e.find("img").attr({width:l.width,height:l.height,src:i}).css({"margin-top":0-l.height/2,"margin-left":0-l.width/2}),l},n.src=i,t.on("click","a.btn-close",function(e){e.preventDefault(),t.remove()})}))})}function Tn(t,i,e){var n=t.getAttribute("src"),a=n.replace(/\/720$/g,"/0"),o=$(t).parent(),s=0;t.onload=function(){$(this).parent().css("background-image","none"),t.getAttribute("src")===S.imageLoadFail?BJ_REPORT.report("B2C Image Load Error to Success Src: "+n):(bn($(this),a),i&&h()),o.find("i").removeClass(),o.find("i").remove()},"session"==e&&(t.onerror=function(e){this.setAttribute("src",S.imageLoadFail),o.find("i").removeClass(),o.on(S.clickName,function(){t.setAttribute("src",n),o.append('<i class="loading loading-s"></i>')}),0===s&&i&&h(),BJ_REPORT.report("B2C Image Load Error By "+ ++s+" Src: "+n)})}function Sn(e,a){var e=void 0!==S.win.emoji?S.win.emoji.replace_unified(e):e,o=S.isMobile?T.CGI_URL.QQ_FACE:T.CGI_URL.COMP_SOURCE_URL+"img/qq/";return e.replace(/\[(.*?)\]/g,function(e,t){var i;if(0==t.indexOf("f")){t=t.match(/\d+/g);for(var n=0;n<W.index.length;n++)if(W.index[n]==t){i=n;break}}else if("b2c"!=a)for(n=0;n<W.locale.length;n++)if($.i18n(W.locale[n])==t){i=n;break}return i||0===i?'<img src="'+o+i+'.png" class="face"/>':e})}function wn(t){var e;S.win.FormData&&((e=new FormData).append("media",t.content),e.append("visitId",S.receptionist.visitorId),e.append("receptionUin",S.receptionist[2==S.registerType?"kfUin":"extUin"]),$.ajax({url:T.CGI_URL.UPLOAD_IMG+"?kfuin="+S.receptionist.kfUin,data:e,processData:!1,contentType:!1,type:"POST",timeout:5e4,error:function(){xn().sendFail(t,"uploadError")},success:function(e){qn(t,e)}}))}function Cn(){var g=new $t({dynamicTitle:!0,interval:1e3});function m(e,t){var i,n,a,o,s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"msg",r=arguments[3],c=arguments[4],l=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"true",d=6<arguments.length&&void 0!==arguments[6]?arguments[6]:"true",f=7<arguments.length&&void 0!==arguments[7]?arguments[7]:"true",p=w.chatListWrap[0],u=r,g=c||{act:"append"},m=S.isRealSendMsg;if(~e.indexOf("b2c")&&Math.abs(p.scrollHeight-p.scrollTop-p.offsetHeight)<=5&&(u=!0),a=6==t.type?(n=S.receptionist&&S.receptionist.corpName,$(k(T.CHAT_MSG_TPL.sys,n+$.i18n(T.SYS_MSG.revoke)))):_(e,t,u)){if(wt.init({$el:a,msgData:t,type:"robotSatisfaction"}),f&&("insert"==g.act?(o=L.get("kf"+S.receptionist.kfUin+"vId"+S.receptionist.visitorId+"index"+g.insertSeqs))&&(o=JSON.parse(o),i=$('[data-guid="'+o.seq+'"]'),a.insertBefore(i)):"prepend"==g.act?(w.chatListWrap[g.act](a),it(t.date,g.act)):(it(t.date,g.act),w.chatListWrap.find(".tencent-certification").before(a))),"b2c"===e&&Ot.main(a[0],t),"c2b"!=e&&"c2bImage"!=e||"msg"!=s||!m||(Oe({type:$e.SEND_C2B,requestConsumTime:0}),$('[data-guid="'+t.seq+'"]').find("i").addClass("loading loading-s")),"c2b"==e){try{1==S.registerType&&0==S.menuDetail.defaultConfig.active&&w.chatListWrap.find(".tencent-certification").before(k(T.CHAT_MSG_TPL.sys,{seq:t.seq,msg:S.menuDetail.defaultConfig.roleExtendData||"请点击导航"}))}catch(e){}1==t.type?vn(1,Xe(e,t.originMsgContent||"")):vn(1,t.data)}("open"==S.imStatus&&"c2b"==e||u)&&h(),"c2bImage"!=s&&m&&Ze(e,t,s,g,l,d)}}function _(e,t,i){var n,a="c2b"==e?new RegExp(/\n/g):new RegExp(/(\r|\v)/g),o=t.data;if(void 0!==t.avatar&&0!=t.avatar.length||(t.avatar=S.defaultAvatar),1==t.type&&(t.originMsgContent=o,t.data=yn(x(o))),"b2c"==e&&2==t.type)return 3==t.img_type&&(t.data=t.data.replace(/\/720$/g,"/0")),Tn((n=$(k(T.CHAT_MSG_TPL.b2cImage,t))).find("p.image img")[0],i,"session"),n;if(4==t.type)return $.tmpl(t.data.tpl,t.data);if(5==t.type){var s=t.data.type?t.data.type:1;switch(s){case 1:return pt.render(t,{isFromHistory:!1});case 2:return We.render(t,{isFromHistory:!1});case 3:return Ct.render(t,{isFromHistory:!1});case 4:return Et.render(t,{isGoBot:!0});case 5:return St.render(t,{isGoBot:!0});case 101:return It.renderMsg(t);default:BJ_REPORT&&BJ_REPORT.report("Unknown b2c data.type: "+s)}}else{if(7!=t.type)return 8==t.type?_n.render(t,{seq:t.seq,dir:e}):9==t.type?_n.render(t,{seq:t.seq,dir:e,className:"msg-xml-bcard"}):(t.data=t.data&&"string"==typeof t.data?Sn(t.data,e):t.data,n=$(k(T.CHAT_MSG_TPL[e],t).replace(a,"<br/>")),"b2c"==e&&1==t.type&&Te(n,t),n);switch(t.data.channel?t.data.channel:1){case 1:return Ye.render(t,{isFromHistory:!1})}}}function o(e){var t=S.c2bSeqGroup,i=e.seq,n=e.errcode,a=$('[data-guid="'+i+'"]').find("i");a.removeAttr("class").addClass("icon-fail");for(var o=0;o<t.length;o++)if(t[o].seq===i){$.extend(e,t[o]);break}a.data("reSendData",e),BJ_REPORT.report("C2B Msg Fail Seqs "+e.date+e.type),a.off(S.clickName),a.one(S.clickName,function(e){e.preventDefault();var t=$(this).data("reSendData");S.reSendC2bMsg=t,50011===n&&(S.ioLinkStatus="over",S.registerType="default",delete t.errcode),$(this).removeClass("icon-fail").addClass("loading loading-s"),Ze("c2b",t,"msg")})}return{render:m,conventSigle:_,sendFail:o,sendRet:function(e){var t=e.body&&e.body.seq,i=$('[data-guid="'+t+'"]').find(".loading"),n=S.c2bSeqGroup;if("success"==e.result&&t){Oe({type:$e.SEND_C2B_SUCCESS,requestConsumTime:0}),i.removeClass("loading loading-s"),S.isChangeKF=0,H.removeMsgCache(t);for(var a=0;a<n.length;a++)if(n[a].seq==t){n.splice(a,1),S.c2bSeqGroup=n;break}We.handleC2bReceiveSeq(0,t),Ye.handleAck(e.body,"success"),_n.handleAck(e.body,"success")}else Oe({type:$e.SEND_C2B_FAIL,requestConsumTime:0}),o({data:e.body.data,seq:e.body.seq,wordMsgSeq:e.body.wordMsgSeq,errcode:void 0!==e.errcode?parseInt(e.errcode):1}),We.handleC2bReceiveSeq(1,t),Ye.handleAck(e.body,"fail")},renderB2C:function(e){Oe({type:$e.RECEIVE_B2C,requestConsumTime:0});var t=e.body,i=L.get("offlineSeq")||"[]";if((i=JSON.parse(i)).length)for(var n=0;n<i.length;n++)i[n]==t.sortseq&&6!=t.type&&(t.type=6,t.data="该条消息已经撤回");if(6!=t.type||"该条消息已经撤回"==t.data){var a=P.setType(t.sortseq,t.type),o={face:S.receptionist.avatar,name:S.receptionist.name},s=N(a),r={};t.u_info.face&&$.extend(o,t.u_info),t.u_info.name&&$.extend(o,t.u_info),s||S.chatSocket.emitMsg(T.SOCKET_CMD.B2C.EMIT,{date:t.date,seq:t.seq,sortseq:t.sortseq,csrf:t.csrf}),t.sortseq&&N(a)?(r=je(a),m("b2c",{avatar:o.face,name:o.name,data:t.data,img_type:t.img_type,date:t.date,seq:t.seq,type:t.type,csrf:t.csrf,sortseq:t.sortseq,vote:t.vote,translate_lang:t.translate_lang},"msg",null,r),hn.isHidden()&&g.twinkling(),hn.visibilitychange(function(e,t,i){0==t&&"visible"==i&&g.clearTimer()}),"close"==S.imStatus&&rt.set(S.receptionist,S.wpaDetail.wpaId,function(e){y.send({act:"UNREAD",data:{number:e,onlyOpen:!0}})})):t.sortseq||BJ_REPORT.report("B2C Sortseq Null "+JSON.stringify(e))}else{for(var c=t.sortseq,l=0,n=1;n<=5;n++){var d="kf"+S.receptionist.kfUin+"vId"+S.receptionist.visitorId+"index"+c+n;if(L.get(d)){l=d;break}}if(0!==l){var f=$('[data-guid="'+JSON.parse(L.get(l)).seq+'"]'),p=S.receptionist&&S.receptionist.corpName;f.after(k(T.CHAT_MSG_TPL.sys,p+$.i18n(T.SYS_MSG.revoke))).remove(),L.set(l,JSON.stringify({type:6,data:"该条消息已经撤回"}))}else{for(var u=!0,n=0;n<i.length;n++)t.sortseq==i[n]&&(u=!1);u&&(i.push(t.sortseq),L.set("offlineSeq",JSON.stringify(i)))}S.chatSocket.emitMsg(T.SOCKET_CMD.B2C.EMIT,{date:t.date,seq:t.seq,sortseq:t.sortseq-S.serverClientTimeDiff,csrf:t.csrf})}}}}function xn(){function n(e,t){var i=e.seq,n=$('[data-guid="'+i+'"]'),a=n.find("i");BJ_REPORT.report("Image Msg Send Error Reason "+t),a.removeClass("loading loading-s").addClass("icon-fail").data("reason",t),"uploadError"==t?a.off(S.clickName).on(S.clickName,function(){$(this).removeClass("icon-fail").addClass("loading loading-s"),wn(e)}):(n.find("p.image").addClass(t),n.find(".bubble").addClass(t+"--bubble"),"overSumLimit"===t&&n.find("p.image").append('<div class="overSumLimit__error-txt">'+$.i18n("sysmsg_upload_image_size_msg")+"</div>"),"notSupport"===t&&n.find("p.image").append('<div class="notSupport__error-txt">'+$.i18n("sysmsg_upload_image_supported_msg")+"</div>")),h()}return{render:function(e,t){$.extend(e,{date:+new Date}),Cn().render("c2bImage",{seq:e.seq,date:e.date},"msg"),t&&n(e,t)},replacePlaceholder:function(e){var t=e.seq,i=$('[data-guid="'+t+'"]').find("img");e.blobUrl?(i.attr("src",e.blobUrl),bn(i,e.blobUrl),Tn(i[0],!0),e.size>T.IMG_UPLOAD_OPTS.MAX_SIZE?n(e,"overSumLimit"):wn(e)):e.DataURL&&(i.attr("src",e.DataURL),Tn(i[0],!0),e.size>T.IMG_UPLOAD_OPTS.MAX_SIZE&&n(e,"overSumLimit"))},sendFail:n}}var kn,En,In={getMsgCacheList:(kn={sum:0,pageNum:0,isLoad:0},En=0,{start:function(e,t){var i="kf"+S.receptionist.kfUin,n=JSON.parse(L.get(i));if(0==kn.isLoad&&(kn.isLoad=1,n&&n.forEach(function(e){e.visitorId==S.receptionist.visitorId&&(kn.sum=e.total)}),0<kn.sum&&(function e(t){var i,n,a,o,s=S.receptionist.kfUin,r=S.receptionist.visitorId,c=T.VIEW_OPTS.HISTORY_MSG.PER_NUM,l=S.seqs.data;(a=kn.sum-c)<0&&(a=0);for(var d=kn.sum;a<d;d--)i="kf"+s+"vId"+r+"index"+l[d-1],(n=JSON.parse(L.get(i)))?(Rn(n,"up"),n.time&&4!=n.type&&w.chatListWrap.prepend(k(T.CHAT_MSG_TPL.time,tt(n.time)))):BJ_REPORT.report("History RenderAll Msg Error"),kn.sum--;0==kn.pageNum?En=w.chatListWrap[0].scrollHeight+60:setTimeout(function(){En=w.chatListWrap[0].scrollHeight-En,w.chatListWrap[0].scrollTop=En,En=w.chatListWrap[0].scrollHeight},20),kn.pageNum++,kn.sum<=0?kn.pageNum=1:(o=$(k(T.CHAT_MSG_TPL.msgLoad.getMsg,$.i18n(T.VIEW_OPTS.HISTORY_MSG.GET_MSG))),w.chatListWrap.prepend(o),o.find("a").one(S.clickName,function(){En=t?w.chatListWrap[0].scrollHeight:En,o.html(k(T.CHAT_MSG_TPL.msgLoad.loading,$.i18n(T.VIEW_OPTS.HISTORY_MSG.LOADING))),setTimeout(function(){o.remove(),e()},200)}))}(e),1!=kn.pageNum||e||h()),t)){var a=S.seqs.data,o=L.get("CACHE_"+S.seqs.key);try{o=JSON.parse(o)}catch(e){o=[]}var s=S.receptionist.kfUin,r=S.thirdAppConfig.visitorId;if(a&&a.length)for(var c=0;c<a.length;c++){var l="kf"+s+"vId"+r+"index"+a[c];L.remove(l)}if(o&&o.length)for(c=0;c<o.length;c++)l="kf"+s+"vId"+r+"index"+o[c],L.remove(l);L.set(S.seqs.key,"[]"),L.set("CACHE_"+S.seqs.key,"[]"),L.get(i,"[]"),Qi(0,Rn).then(function(e){0===e.isEnd&&Yi(e.lastTime,"success",Rn),h()},function(){Yi(0,"fail",Rn),h()})}},renderSingle:Rn}),normal:Cn(),image:xn(),renderUploadImgRet:qn};function Rn(e,t){var i,n=e.dir,a=parseInt($.trim(e.type)),t=t||"down",o=H.hasSeqInMsgCache(e.seq);switch(a){case 1:e.originData=e.data,e.data=yn(x(e.data)),e.data=Sn(e.data,n),i=$(k(T.CHAT_MSG_TPL[n],e),n),"b2c"==n&&Te(i,e,{isHistory:!1});break;case 2:n="c2b"==n?"c2bImage":"b2cImage",Tn((i=$(k(T.CHAT_MSG_TPL[n],e))).find("p.image img")[0]);break;case 3:$.extend(e.data,{currentVersion:S.menuDetail.currentVersion}),e.data.config||$.extend(!0,e.data,{config:{menu:0,button:0}}),i=$($.tmpl(T.CHAT_MSG_TPL.menuMsgNormal,e.data)),nt().bindEvents(i);break;case 4:ft.render(e,e.dir,{isNeedStore:!1,isNeedWrap:!0,isFromHistory:!0});break;case 5:switch(a=e.data.type?e.data.type:1){case 1:i=pt.render(e,{isFromHistory:!0});break;case 2:i=We.render(e,{isFromHistory:!0});break;case 3:i=Ct.render(e,{isFromHistory:!0});break;case 4:i=Et.render(e,{isGoBot:!1});break;case 5:i=St.render(e,{isFromHistory:!0});break;case 101:i=It.renderMsg(e)}break;case 7:var s=e.data.channel?e.data.channel:1;switch(s){case s:i=Ye.render(e,{isFromHistory:!0,cacheStatus:o})}break;case 8:i=_n.render(e,{seq:e.seq,dir:n});break;case 9:i=_n.render(e,{seq:e.seq,dir:n,className:"msg-xml-bcard"});break;default:BJ_REPORT.report("History Msg Render Error Type "+a)}switch(i&&("down"==t?w.chatListWrap.find(".tencent-certification").before(i).trigger("graphicMsgLoad",e):w.chatListWrap.prepend(i).trigger("graphicMsgLoad",e)),wt.init({$el:i,msgData:e,type:"robotSatisfaction"}),/Image/g.test(n)&&bn(i,e.data.replace(/\/720$/g,"/0")),o){case"ack":1===a?Cn().sendFail($.extend(e,{data:e.originData})):Cn().sendFail(e);break;case"unconnect":$('[data-guid="'+e.seq+'"]').find("i").addClass("loading loading-s")}}function $n(e,t){var i=1<arguments.length&&void 0!==t&&t,n=e.body||{},a=n.u_info?n.u_info:n.data,o=n.c_info||{};S.menuDetail.active=0,S.registerType=a.type||2,S.queueKey=a.queueKey,S.isRealSendMsg=1,S.reSendC2bMsg&&S.queueKey&&$.extend(S.reSendC2bMsg,{queueKey:S.queueKey}),i&&S.chatSocket.emitMsg(T.SOCKET_CMD.SESSION_MSG.EMIT,{csrf:n.csrf,seq:n.seq,type:n.type,time:n.time}),In.normal.render("b2c",{avatar:o.face||S.defaultAvatar,name:o.name,data:a.queueMsg,date:e.body.date,seq:e.body.seq,type:1},"welcome")}function On(e){var t,i,n,a,o,s,r,c,l,d=e.body.c_info.name,f={},p=S.isMobile?w.header.find("span.title"):w.header.find("span.name"),u=void 0===e.body.u_info.type?"default":e.body.u_info.type;switch(S.registerType=u,S.inRegProcess=0,w.chatBtnSend.hasClass("enabled")||w.chatBtnSend.addClass("enabled"),w.chatBody.hasClass("regsuccess")||(document.title=S.isMobile?d:$.i18n("common_chatting_with_text",d),w.chatBody.hasClass("reconnect")||1==u||(w.chatListWrap.empty(),_(w.chatListWrap)),w.chatBody.removeClass("reconnect").addClass("regsuccess"),p.text(d),p.attr("title",d),w.chatListWrap.removeClass("chat-initial"),w.chatBtnSend.addClass("enabled"),w.btnUpload.addClass("enabled"),S.translate.translateSwitch&&(I({msgType:"serverResp",data:$.i18n(T.SYS_MSG.currentServiceLang)+'<a href="javascript:;" class="btn-lang">'+$.i18n("common_lang_"+S.translate.translateLang)+"</a>",act:"new"}),w.chatListWrap.find(".msg-sys .btn-lang").off(S.clickName).on(S.clickName,function(){Se()}),w.callGroup.find(".btn-lang-setting").length||(t=S.isMobile?"H5":"PC",(i=$(T.HEADER_TPL[t].BTN_LANG_SETTING)).on(S.clickName,function(){Se()}),w.callGroup.append(i))),S.wxConfig.enableVoice&&w.btnVoice.addClass("enabled")),S.isRoamMessage=S.thirdAppConfig.isRoamMessage,In.getMsgCacheList.start(f.offline,S.isRoamMessage),o={welcome:!1,offline:!1},(n=e).body.o_u_info||!n.body.u_info.welcome||n.body.nowelcome||(o.welcome=!0,a=je(P.setType(n.body.date,1)),In.normal.render("b2c",{avatar:S.receptionist.avatar,name:n.body.u_info.name,data:n.body.u_info.welcome,date:n.body.date,seq:n.body.seq,sortseq:n.body.date,type:1},"msg",!0,a)),f=o,r=e.body||{},l=void 0===(c=r.u_info||{}).type?"default":c.type,c.robotNav=c.robotNav&&c.robotNav.content&&c.robotNav.content.menu,"default"===l&&c.robotNav&&(s=je(P.setType(r.date,5)),In.normal.render("b2c",{data:{type:101,robotNav:c.robotNav},date:r.date,sortseq:r.date,type:5},"msg",!0,s)),u){case"default":S.menuDetail.active=0,S.isRealSendMsg=1,S.routePermit.isNeedQQ=void 0===e.body.isNeedQQ?1:e.body.isNeedQQ,S.routePermit.isCorpUin=void 0===e.body.isCorpUin?1:e.body.isCorpUin,1==S.routePermit.isNeedQQ&&(Ce(),Ne(w.callGroup.find(".btn-callqq"),{type:S.routePermit.isCorpUin?"qqCorpUin":"qq"}));break;case 1:S.menuDetail.active=1,S.registerType=u,Ce("remove","qq"),nt().render.start(e.body.u_info);break;case 2:$n(e);break;default:BJ_REPORT.report("UNKNOWN registerType: "+u)}}function An(e){var t=e.body.data,i=e.body.offline||0,n=S.receptionist,a=S.wpaDetail,o=S.chatSocket,s=S.imStatus;1==t&&S.isMobile?t="tel":(2==t?t="qq":5==t&&(t="qqCorpUin"),i&&w.chatListWrap.find(".tencent-certification").before(k(T.CHAT_MSG_TPL.sys,$.i18n(T.SYS_MSG["call"+t]))),w.chatListWrap.find(".tencent-certification").before(k(T.CHAT_MSG_TPL["call"+t],n,ye)),Ne(w.chatListWrap.find(".btn-act"),{type:t}),h(),o.emitMsg(T.SOCKET_CMD.ROUTE.EMIT,{csrf:e.body.csrf,seq:e.body.seq}),"close"==s&&rt.set(n,a.wpaId,function(e){y.send({act:"UNREAD",data:{number:e}})},!1))}var Mn=function(){var v={},q=S.receptionist,y=S.wpaDetail,b=S.isMobile,t=S.chatSocket;return{initialize:function(e){$.extend(v,e),function(){var e=v.data;e.fbKey;t.emitMsg(T.SOCKET_CMD.SESSION_MSG.EMIT,{csrf:v.csrf,seq:v.seq,type:v.type,time:v.time}),$.extend(e,{hasDesc:2==e.style,isMobile:S.isMobile},T.FB_OPTS),w.chatListWrap.find(".tencent-certification").before($.tmpl(T.CHAT_MSG_TPL.feedback,e,ye)),h(),function(a){var t,i,o,s=a.hasDesc,e=a.fbKey,n={avail:T.FB_OPTS.availLetterSum,used:0,remain:T.FB_OPTS.availLetterSum},r={},c=0,l=0,d=T.FB_OPTS.delayTime,f=$('[data-fbkey="'+e+'"]'),p=f.find(".fb-level a"),u=p.eq(2).find("span"),g=p.find("span"),m=f.find(".fb-desc"),_=f.find(".post-text").children().eq(0),h=f.find(".fb-loading");f.data("extUin",a.extUin),Object.defineProperty(r,"seq",{value:a.seq}),Object.defineProperty(r,"level",{set:function(e){var t=e+1;g.text(""),u.addClass("active").text(p.eq(e).data("desc")),f.data("level",t),s||f.trigger("loading")},get:function(){return f.data("level")}}),Object.defineProperty(r,"desc",{set:function(e){l=1,f.data("desc",e).trigger("loading")},get:function(){return f.data("desc")}}),b||p.hover(function(){p.eq($(this).index()).addClass("on")},function(){p.eq($(this).index()).removeClass("on")}),p.on(S.clickName,function(){$(this).parent().hasClass("disabled")||(c=$(this).index(),r.level=c,p.removeClass("active"),p.eq(c).addClass("active"),s&&0!=m.length&&"none"==m.css("display")&&(i=f.find(".num").eq(0),o=f.find(".btn-submit").eq(0),t=m.find("textarea").eq(0),m[b?"show":"slideDown"]("fast",function(){var e=f.position().top+f.height()-w.chatListWrap.height();0<e&&w.chatListWrap.scrollTop(w.chatListWrap.scrollTop()+e+20)}),t.on("input keyup",function(e){var t=$(this).val();n.used=$(this).val().length,n.remain=n.avail-n.used,i.text(n.remain),n.remain<=0&&(i.text(0),$(this).val(t.substring(0,n.avail)),e.preventDefault())}),o.on(S.clickName,function(){var e=$.trim(t.val());l||(r.desc=e,_.text(e))})))}),f.on("loading",function(){h.fadeIn("fast"),function(n,a){n=$.extend({},{fbLevel:n.level,fbDesc:n.desc,seq:n.seq,fbKey:a.data("fbkey"),visitorId:q.visitorId,kfuin:q.kfUin,extUin:a.data("extUin"),wpaId:y.wpaId,session_time:q.time,sessionId:v.sessionId});$.ajax({url:T.CGI_URL.GET_FEEDBACK_RET+"?kfuin="+n.kfuin,data:n,type:"POST",timeout:3e3,dataType:"json",error:function(e,t,i){a.trigger("fail",$.i18n("chat_feedback_error_msg")),BJ_REPORT.report(JSON.stringify({textStatus:t,errorThrown:i,queryData:n}))},success:function(e){0!=e.r?(a.trigger("fail",e.message),BJ_REPORT.report(JSON.stringify(e))):a.trigger("success",n.fbLevel)}})}(r,f)}).on("success",function(e,n){Y({text:$.i18n("chat_feedback_success_msg")},d,function(){h.fadeOut("fast"),p.parent().addClass("disabled"),s&&(o.hide().prev().hide(),0<_.text().length&&_.parent().show());var e=a.reply,t="";for(var i in e)n==i&&(t=e[i]);I({msgType:"feedBack",act:"new",replyContent:t=x(t).replace(ot,function(e){return'<a href="'+st(e)+'" target="_blank" class="text-link">'+e+"</a>"})})})}).on("fail",function(e,t){l=0,Y({text:$.i18n("chat_feedback_fail_msg")+"："+t},d,function(){h.fadeOut("fast")}),BJ_REPORT.report("FeedBackRet GetData Error")})}(e)}()}}},Ln={sendAck:function(e){S.chatSocket.emitMsg(T.SOCKET_CMD.SESSION_MSG.EMIT,{csrf:e.csrf,seq:e.seq,type:e.type,time:e.time})},render:function(e){I({msgType:"serverResp",act:"new",data:e.data}),this.sendAck(e)}};function Pn(e){var t,i,n,a=e.body,o=a.type||"unknown";switch(o){case 1000010:switch((a.data||{}).type||"default"){case"default":n=(t=a).data,S.receptionist,S.chatSocket.emitMsg(T.SOCKET_CMD.SESSION_MSG.EMIT,{csrf:t.csrf,seq:t.seq,type:t.type,time:t.time}),$.extend(S.receptionist,{extUin:n.uin,name:n.name,avatar:n.face||S.defaultAvatar,resign:n.position}),2!=S.externalType||S.isMobile||S.isInIframe||S.receptionist.isRobot||ct(),I({type:"b2cKfChange",msgType:"serverResp",act:"new",data:$.i18n(T.SYS_MSG.b2cKfChange,S.receptionist.name)}),void 0!==n.welcome&&n.welcome&&(i=+new Date+S.serverClientTimeDiff,In.normal.render("b2c",{avatar:S.receptionist.avatar,name:S.receptionist.name,data:n.welcome,seq:C(T.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PHP),type:1,wordMsgSeq:C(T.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PC),date:i,sortseq:i},"msg",!0,{act:"append",singleSeqs:i+"1"}));break;case 2:$n(e,!0)}break;case 1000011:Mn().initialize(a);break;case 1000012:ft.render(a,"b2c",{isNeedStore:!1,isNeedAck:!0,isNeedWrap:!1});break;case 1000013:$.extend(a.data,{name:S.receptionist.name,face:S.receptionist.avatar,extUin:S.receptionist.extUin}),ft.render(a,"b2c",{msgName:"addfriend",isNeedStore:!0,isNeedAck:!0,isNeedWrap:!0});break;case 1000014:dt.renderRet({ret:"success",kfAccount:a.data.kfAccount,originData:a});break;case 1000100:Ln.render(a);break;default:BJ_REPORT.report("Unknown S_msg Type"+o)}}function Dn(e){I({type:"sessionEnd",msgType:"sessionEnd",data:(e.body||{}).prompt_message,act:"new"}),S.kfChangeTip||(Ue.remove(),S.ioLinkStatus="sessionOver",S.wpaDetail.extUin=S.receptionist.extUin,S.isChangeKF=0)}var Nn=S.chatSocket;var Bn=function(){var o,s=S.receptionist,r=S.wpaDetail,c=S.menuDetail,i=(S.kfChangeTip,S.localClickId,S.inRegProcess),l=S.chatSocket,d=0,f=0,p=0;function u(e,t){I({type:e=3*(T.SOCKET_OPTS.OPTS.ReconnectionAttempts+1)-1<=t?"reconnectFail":e,seq:S.inRegProcess,act:"update"}),w.chatBody.hasClass("regsuccess")&&"reconnectFail"==e&&w.chatListWrap.find("loading").remove()}function g(e){d=1,o&&clearInterval(o),Oe({type:4,requestConsumTime:new Date-f,clickid:p}),S.pageLoadStartTime&&Oe({type:7,requestConsumTime:new Date-S.pageLoadStartTime,clickid:p}),("success"==e.result?function(t){var e;S.registerStartTime&&Oe({type:$e.SESSION_START_SUCCESS,requestConsumTime:new Date-S.registerStartTime}),S.ioLinkStatus="normal",S.isRegOK=1,S.seqs.key="kf"+s.kfUin+"vId"+s.visitorId+"seqs",BJ_REPORT.info(S.seqs.key),j.initialize(),delete S.wpaDetail.extUin,function(e){void 0!==e.c_info&&$.extend(S.receptionist,{corpName:e.c_info.name||"",corpAvatar:e.c_info.face||S.defaultAvatar}),$.extend(S.receptionist,{extUin:e.u_info.uin,name:e.u_info.name,avatar:e.u_info.face||S.defaultAvatar,resign:e.u_info.position,qq:e.u_info.qq,isRobot:e.u_info.isCommonRobot,time:e.date});var t=S.externalType=e.externalType||2,i=void 0===e.u_info.type?"default":e.u_info.type;2!=t||"default"!==i||S.isMobile||S.isInIframe||S.receptionist.isRobot||ct()}(t.body),e=L.get(S.seqs.key),D(e),S.seqs.data=JSON.parse(e),Nn.receiveMsg(T.SOCKET_CMD.B2C.RECEIVE,In.normal.renderB2C),Nn.receiveMsg(T.SOCKET_CMD.C2B.RECEIVE,In.normal.sendRet),Nn.receiveMsg(T.SOCKET_CMD.SESSION_MSG.RECEIVE,Pn),Nn.receiveMsg(T.SOCKET_CMD.OVER.RECEIVE,Dn),Nn.receiveMsg(T.SOCKET_CMD.ROUTE.RECEIVE,An),w.chatBody.hasClass("regsuccess")||S.regSuccessCallBack&&S.regSuccessCallBack();t.body.update&&I({type:"autoChangeKF",act:"new"});I({type:"regSuccess",act:"update",seq:S.inRegProcess}),1==t.body.u_info.type?On(t):(function(e){var t=H.getMsgCacheList(),i=S.receptionist,n="kf"+i.kfUin+"vId"+i.visitorId+"index",a=e.body.u_info?e.body.u_info:e.body.data;if(t){for(var o,s=JSON.parse(L.get(S.seqs.key)),r=0;r<t.length;r++){"unconnect"==t[r].cacheType&&(o=JSON.parse(L.get(n+t[r].singleSeqs)),2==e.body.u_info.type&&(o.queueKey=a.queueKey),s.push(t[r].singleSeqs),function(e,t,i){if(!0===S.isRoamMessage)return;var n,a="kf"+e,o=JSON.parse(L.get(a));{if(o&&o.forEach(function(e){e.visitorId==t&&(n=e.total,"set"==i&&(n++,e.total=n))}),"get"==i)return;L.set(a,JSON.stringify(o))}}(i.kfUin,i.visitorId,"set"),function(t){setTimeout(function(){var e;delete t.time,delete t.singleSeqs,delete t.dir,2==t.type&&(e=t.imgSrc,t.imgSrc=t.data,t.data=e),S.chatSocket.emitMsg(T.SOCKET_CMD.C2B.EMIT,t)},2)}(o))}!0!==S.isRoamMessage&&L.set(S.seqs.key,JSON.stringify(s)),S.seqs.data=s}}(t),On(t),function(){var e=H.getMsgCacheList();if(e){for(var t=0;t<e.length;t++)"unconnect"==e[t].cacheType&&(e[t].cacheType="ack");H.setMsgCacheList(e)}}());S.inRegProcess=0,S.isChangeKF=void 0!==t.body.isChangeKF?t.body.isChangeKF:0,S.isSessionSilent=void 0!==t.body.isSessionSilent?t.body.isSessionSilent:0,1===S.isSessionSilent&&(S.isSelent=!0,S.ioLinkStatus="over");S.isChangeKF&&(w.chatListWrap.find(".btn-newkf").addClass("disabled"),I({type:"changeKf",seq:S.inRegProcess,act:"new"}),$(".msg-sys .btn-newkf").on(S.clickName,function(e){!function(e,t){var e=e.body,i=$(t.target),n=S.getSigTData,a=S.receptionist,o=parseInt(S.originRoleValue);if(!i.hasClass("disabled")){switch(BJ_REPORT.info("KF Change"),i.addClass("disabled"),S.chatSocket.emitMsg(T.SOCKET_CMD.KF_CHANGE.EMIT,{kf:""}),4==n.invitationType&&(1==S.wpaDetail.reception.type?o=0:2==S.wpaDetail.reception.type&&(o=1)),o){case 0:S.wpaDetail.extUin=n.roleData;break;case 1:S.wpaDetail.extUin="group";break;case 2:case 5:S.wpaDetail.extUin=a.kfUin;break;default:BJ_REPORT.report("Unknown RoleValue"+o)}BJ_REPORT.info("KF Change ReConnect"),Bn().reConnect()}}(t,e)}));Ue.add()}:function(e){S.registerStartTime&&Oe({type:$e.SESSION_START_FAIL,requestConsumTime:new Date-S.registerStartTime});var t=e.errmsg||T.SYS_MSG.reReg;if(BJ_REPORT.report("Register Fail "+JSON.stringify(e)),50080===e.errcode)return;I({msgType:"serverResp",seq:i,act:"update",data:t,empty:!0}),S.inRegProcess=0})(e)}return{prepareRegData:function(e,t){var i,n,a={visitorId:s.visitorId,isMobile:S.isMobile,wpaKey:r.wpaKey,reception:r.reception,signT:e.sigT,kfuin:s.kfUin,qqUin:(n=A("uin"))?Math.floor(n.substring(1)):"",wpaId:r.wpaId,key:r.key,invitationType:r.invitationType,extUin:r.extUin,roleValue:e.roleValue,roleData:e.roleData,wpaShowItemId:e.wpaShowItemId,qidian_track_id:e.qidian_track_id,qidian_src_desc:e.qidian_src_desc,qidian_ex1:e.qidian_ex1,qidian_ex2:e.qidian_ex2,qidian_ex3:e.qidian_ex3,qidian_ex4:e.qidian_ex4,qidian_ex5:e.qidian_ex5,guestId:e.guestId,callImType:e.callImType,isChangeKF:S.isChangeKF,NavClick:e.NavClick,date:+new Date+S.serverClientTimeDiff,translateLang:S.translate.translateLang};for(i in S.inRegProcess,c.currentVersion&&$.extend(a,{navVersion:c.currentVersion}),a)void 0!==a[i]&&null!==a[i]||delete a[i];$.extend(a,{clickid:r.clickid}),S.thirdAppConfig.enable&&$.extend(a,{thirdAppInfo:$.extend(!0,{},S.thirdAppConfig)}),S.isSelent&&(a.isSessionSilent=1),S.menuDetail&&1===S.menuDetail.active&&(a.isSessionSilent=1),S.thirdAppConfig.secretKey&&(a.secretKey=S.thirdAppConfig.secretKey),function(e){var t,i={query:"kfuin="+s.kfUin+"&visitorId="+e.visitorId},n=0;p=e.clickid,(t=l.create(T.CGI_URL.SOCKET_CHAT,$.extend(T.SOCKET_OPTS.OPTS,i))).emitMsg(T.SOCKET_CMD.REG.EMIT,e,function(){o=Re({isGet:d,timeout:T.SOCKET_OPTS.REG_TIMEOUT,text:"Register Ack Timeout ",callback:function(){I({type:"regTimeout",empty:!0}),BJ_REPORT.report(this.text)}}),f=+new Date},this).receiveMsg(T.SOCKET_CMD.REG.RECEIVE,g,this,null,!0),S.registerStartTime=+new Date,Oe({type:$e.SESSION_START,requestConsumTime:0}),t.ioLink.once("connect_error",function(e){BJ_REPORT.report("Connect Error sid "+t.ioLink.id),u("connectError",++n)}),t.ioLink.once("reconnect_attempt",function(e){Oe({type:$e.SESSION_START_RETRY,requestConsumTime:0}),"undefined"!=typeof WebSocket&&void 0!==WebSocket.prototype.send||(t.ioLink.io.opts.path="/polling_session",t.ioLink.io.opts.transports=["polling","websocket"])}),t.ioLink.once("reconnecting",function(e){Oe({type:$e.RECONNECT,requestConsumTime:0}),BJ_REPORT.report("Reconnecting sid "+t.ioLink.id),u("reconnectIng",++n)}),t.ioLink.once("reconnect_error",function(e){Oe({type:$e.RECONNECT_ERROR,requestConsumTime:0}),BJ_REPORT.report("Reconnect Error sid "+t.ioLink.id),u("reconnectError",++n)}),t.ioLink.once("reconnect_failed",function(e){BJ_REPORT.report("Reconnect Fail sid "+t.ioLink.id),n++,S.ioLinkStatus="over",u("reconnectFail",n)}),t.ioLink.once("connect",function(e){n=0,S.ioLinkStatus="normal",u("connect")}),t.ioLink.once("disconnect",function(e){Ue.remove(),"sessionOver"!=S.ioLinkStatus&&(S.ioLinkStatus="over")})}(a)},reConnect:function(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],e=S.thirdAppConfig.authType;"sessionOver"!=S.ioLinkStatus||S.isChangeKF||(delete S.wpaDetail.extUin,delete S.menuDetail.currentVersion,delete S.wpaDetail.invitationType),S.isGetSignT=0,d=0,S.isInIframe?y.send({act:"SMS_SM_FORCE_CONNECT"}):window.__STATUS_MANAGER.forceConnect(),BJ_REPORT.info("ReConnect"),w.chatBody.removeClass("regsuccess").addClass("reconnect"),e&&T.AUTH_TYPE[e]&&""!==T.AUTH_TYPE[e].name&&T.AUTH_TYPE[e].reconnectDoSso?ti({url:S.win.location.href,authType:e}).then(function(e){S.thirdAppConfig.secretKey=e.secretKey,S.thirdAppConfig.visitorId=e.visitorId,S.receptionist.visitorId=e.visitorId,le(e.visitorId),Un(S.getSigTData,null,null,t)},function(e){}):Un(S.getSigTData,null,null,t)}}};function Un(i,e,t,n){var a,o=t||"chatStart",s=e||T.CGI_URL.GET_SIGT,r=C(T.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PHP),c="wpaShowItemId",l=0;if(void 0===i.visitorId)return I({type:"noVisitorId",empty:!0}),void BJ_REPORT.report("noVisitorId");void 0===i.reqSrc&&(i.kfuin&&xe(i.kfuin),Ie()),$.extend(i,{ftype:S.isMobile,rolekey:"roleQQ",cb:o}),void 0!==i[c]&&(ke.get(c)?delete i[c]:ke.set(c,"true")),S.win.chatStart=function(e){var t={sigT:e.data.sigT,roleValue:i.roleValue,roleData:i.roleData,callImType:i.callImType,wpaShowItemId:i.wpaShowItemId,qidian_track_id:i.qidian_track_id,qidian_src_desc:i.qidian_src_desc,qidian_ex1:i.qidian_ex1,qidian_ex2:i.qidian_ex2,qidian_ex3:i.qidian_ex3,qidian_ex4:i.qidian_ex4,qidian_ex5:i.qidian_ex5,guestId:i.guestId};void 0!==i.NavClick&&$.extend(t,{NavClick:i.NavClick}),S.isGetSignT=1,clearInterval(a),0==e.r?Bn().prepareRegData(t):I({type:"sigTfail",empty:!0})},a=Re({isGet:S.isGetSignT,timeout:T.SOCKET_OPTS.SIGT_TIMEOUT,text:"Get SigT Timeout ",callback:function(){I({type:"sigTtimeOut",empty:!0}),BJ_REPORT.report(this.text)}}),$.ajax({type:"get",url:s,data:i,dataType:"jsonp",timeout:T.SOCKET_OPTS.SIGT_TIMEOUT,beforeSend:function(){l=+new Date},complete:function(){Oe({type:3,requestConsumTime:new Date-l,clickid:i.clickid})},error:function(){}}),(w.chatBody.hasClass("regsuccess")||w.chatBody.hasClass("reconnect"))&&n&&(I({type:"startGetSigT",seq:r,act:"new"}),S.inRegProcess=r)}var Gn=$.extend(!0,{},T,{CHAT_MSG_TPL:{corpInfo:'<div class="mod-desc">\n                    <p class="logo"><img src="<%=o.eLogo%>" width="100" alt="<%=o.eName%>" title="<%=o.eName%>" height="100"/></p>\n                    <p class="name" title="<%=o.eName%>"><%=o.eName%></p>\n                    <div class="desc"><div class="desc__content"><%=o.eDesc%></div><div class="desc__arrow"></div></div>\n                </div>\n                <div class="mod-connect">\n                    <ul>\n                        <% if(o.eAddressDetail) { %><li title="<%=o.eAddressDetail%>"><i class="icon-address"></i><%=o.eAddressDetail%></li><% } %>\n                        <% if(o.eEmail) { %><li><i class="icon-email"></i><a href="mailto:<%=o.eEmail%>" title="<%=o.eEmail%>"><%=o.eEmail%></a></li><% } %>\n                        <% if(o.eHome) { %><li><i class="icon-link"></i><a href="<%=o.eLink%>"  title="<%=o.eHome%>" target="_blank"><%=o.eHome%></a></li><% } %>\n                        <% if(o.ePhone) { %><li><i class="icon-tel"></i><a href="tel:<%=o.ePhone%>" title="<%=o.ePhone%>"><%=o.ePhone%></a></li><% } %>\n                    </ul>\n                </div>'},FLASH_TIP:{NO_FLASH:"请安装flash，发送图片消息需要使用flash",LOW_VERSION:"请升级您的flash版本，现版本太低无法发送图片消息"}}),Hn=85;function Fn(e,t){w.sidebar.html($.tmpl(e,t)),setTimeout(function(){var e,t,i;(i=w.sidebar.find(".desc")).height()>Hn&&(e=i.find(".desc__content"),t=i.find(".desc__arrow"),i.addClass("collapse"),t.on("click",function(){i.hasClass("collapse")?i.removeClass("collapse").addClass("expand"):(i.removeClass("expand").addClass("collapse"),e.scrollTop(0))}))},0)}var jn=function(e,t){for(var i in e)for(var n in e[i][t]&&(e[i]=e[i][t]),e[i]){var a;"backgroundImage"===n&&(void 0===(void 0===(a=e[i][n])?"undefined":v(a))||""===a?delete e[i][n]:/^url/.test(a)||(e[i][n]="url("+a+")"))}return e};function Wn(){w.btnBusinessCard.show();var n,e,t="";n=$.Deferred(),e={kfuin:S.receptionist.kfUin,visitId:S.receptionist.visitorId},$.ajax({url:T.CGI_URL.GET_BUSINESS_CARD_DATA+"?kfuin="+e.kfuin,type:"POST",data:e,success:function(e){0==+e.r&&n.resolve(e.cardInfo)},error:function(e,t){var i={code:e.status,msg:t};n.reject(i)}}),n.promise().then(function(e){t=e,w.btnBusinessCard.click(function(e){In.normal.render("c2b",{data:t,seq:C(T.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PHP),type:9,date:+new Date})})})}var Jn=function(){var a={skinColor:function(e){var t,i,n=e.theme;e&&e.styleConfig&&e.styleConfig.detail?(S.styleRenderConfig={styleConfig:jn(e.styleConfig.detail,"pc"),keepEvents:!0},f(".main",S.styleRenderConfig)):(i="skin-"+["blue","default","orange","red","green"][n])!=(t="skin-default")&&u.page.removeClass(t).addClass(i)},success:function(e){var t,i,n=e.corpInfo.eHome;void 0!==e.corpInfo.eLogo&&0!=e.corpInfo.eLogo&&e.corpInfo.eLogo||(e.corpInfo.eLogo=Gn.CGI_URL.COMP_SOURCE_URL+"img/default-logo.png"),e&&e.suportInfo&&(S.suportInfo=e.suportInfo),e&&e.topNotice&&(S.topNotice=e.topNotice),n&&$.extend(e.corpInfo,{eLink:st(n)}),this.skinColor(e),Fn(Gn.CHAT_MSG_TPL.corpInfo,e.corpInfo),e.showInfo&&(e.showInfo.isShowQidianSign&&(_(u.chatListWrap),$(".sidebar").append(_($('<div class="tencent-cert"></div>'))),$(".page").addClass("page-certification"),S.isShowQidianSign=e.showInfo.isShowQidianSign),1==e.showInfo.isShowBusinessCard&&(S.isShowBusinessCard=e.showInfo.isShowBusinessCard,Wn())),t=e,i=te[S.lang],t.showInfo.isShowTopNotice&&t.topNotice&&(window.localStorage?1!=window.localStorage.getItem("QIDIAN_WEBIM_CLOSE_TOP_NOTICE")&&($(".chat-list").append($.tmpl(T.CHAT_MSG_TPL.privacyTips_b2c_base,{tips:t.topNotice[i]})),$(".im-tips__close-btn").click(function(){window.localStorage.setItem("QIDIAN_WEBIM_CLOSE_TOP_NOTICE",1),$(".im-tips--b2c-base").remove()})):($(".chat-list").append($.tmpl(T.CHAT_MSG_TPL.privacyTips_b2c_base,{tips:t.topNotice[i]})),$(".im-tips__close-btn").click(function(){$(".im-tips--b2c-base").remove()})))},fail:function(e){$(".sidebar").find("i").remove().end().find(".text").html($.i18n("sysmsg_load_corpinfo_fail_msg")),BJ_REPORT.report("CorpSkin GetData Error"),BJ_REPORT.report(JSON.stringify(e))}};return{getData:function(n){var e=0;$.support.cors=!0,$.ajax({url:Gn.CGI_URL.GET_SKIN_CORP_INFO+"?kfuin="+n.kfuin,data:n,type:"POST",timeout:2e3,dataType:"json",error:function(e,t,i){a.fail({textStatus:t,errorThrown:i,queryData:n})},beforeSend:function(){e=+new Date},complete:function(){Oe({type:6,requestConsumTime:new Date-e,clickid:S.getSigTData.clickid,addon:JSON.stringify({key:n.key})})},success:function(e){S.isGetSkin=1,a[e.code?"fail":"success"](e)}})},skinColor:a.skinColor}};var Kn,Vn,zn,Qn,Yn,Xn,Zn,ea,ta,ia,na,aa,oa,sa,ra,ca,la,da,fa,pa,ua,ga,ma,_a,ha,va,qa=(Kn=0,function(){return Kn+=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0});function ya(e){var t=e.act,i={},n={},a=S.wpaDetail,o=S.chatSocket,s=Jn();if(1===e.auth&&(S.authUrl=Ae(e)),"base"===e.auth){var r="base";if(e.userInfo)try{var c=JSON.parse(decodeURIComponent(e.userInfo));delete c.avatar,S.thirdAppConfig.userInfo=c}catch(e){}S.thirdAppConfig.enable=!0,S.thirdAppConfig.authType=r,S.thirdAppConfig.type=T.AUTH_TYPE[r].name,S.thirdAppConfig.appType=T.AUTH_TYPE[r].appType}switch(t){case"INIT":$(window).resize(function(){610<$(window).height()?u.page.removeClass("middle").addClass("big"):u.page.removeClass("big").addClass("middle")});var l={kfUin:e.kfuin,visitorId:e.visitorid,wpaId:e.wpaId};e.kfuin||(e.kfuin=0),$.extend(S.htReportOpts,{uin:e.kfuin+"-"+e.visitorid}),BJ_REPORT&&BJ_REPORT.init({uin:S.htReportOpts.uin}),$i(S.htReportOpts),S.imStatus="close",i=rt.get(l);S.lang=e.qidian_lang||"zh-cn",X.init(function(){void 0!==i.number&&0<i.number&&($.extend(n,e,{type:"unReadMsg"}),u.statusBar.data("virtualWPAData",n),qa(i.number),rt.render("update",i.number,{name:i.name,status:$.i18n("common_leave_message_text")}),y.send({act:"SHOW"}),$.extend(!0,e,{act:"UNREAD",data:{number:i.number,onlyOpen:!1}}),y.send(e))}),$.extend(S.receptionist,{visitorId:e.visitorid,kfUin:e.kfuin});break;case"OPEN":var d;if($.extend(S.receptionist,{visitorId:e.visitorid,kfUin:e.kfuin}),BJ_REPORT&&BJ_REPORT.init({uin:e.visitorid}),S.isGetSkin||s.getData({kfuin:e.kfuin,wpaId:e.wpaId,key:e.wpaKey}),u.page.removeClass("page-minify").addClass("page-inframe"),rt.reset(S.receptionist),rt.render("reset"),S.imStatus="open",e.onlyOpen)return;1==e.invitationType||2==e.invitationType?$.extend(e,{roleData:e.receptionUin,roleValue:0}):4==e.invitationType?$.extend(e,{roleData:e.reception.cuin,roleValue:e.reception.type-1}):3==e.invitationType&&$.extend(e,{roleData:e.receptionUin,roleValue:0,extUin:e.receptionUin}),d={kfuin:e.kfuin,visitorId:e.visitorid,roleValue:e.roleValue,roleData:e.roleData,invitationType:e.invitationType,wpaShowItemId:e.wpaShowItemId,qidian_track_id:e.qidian_track_id,qidian_src_desc:e.qidian_src_desc,qidian_ex1:e.qidian_ex1,qidian_ex2:e.qidian_ex2,qidian_ex3:e.qidian_ex3,qidian_ex4:e.qidian_ex4,qidian_ex5:e.qidian_ex5,guestId:e.guestId},S.originRoleValue=e.roleValue,e.isClickWpa&&$.extend(d,{cate:e.cate,type:e.type,clickid:e.clickid,fid:e.wpaId,pid:e.pid,qid:e.qid,clickType:e.clickType,tptype:e.tptype,eptype:e.eptype,tpForm:e.tpForm});S.lang=e.qidian_lang||"zh-cn",X.init(function(){(!(a.wpaKey||a.wpaId||u.chatBody.hasClass("regsuccess"))||a.wpaKey!=e.wpaKey&&a.wpaId!=e.wpaId)&&(S.wpaDetail=e,Un(S.getSigTData=d))},e);break;case"UPDATE_UNREAD":var f=parseInt(e.number),p=void 0!==e.theme?e.theme:null;null!==p&&s.skinColor({theme:p}),0<f&&(n=a={type:"offlineMsg",roleData:e.receptionUin,roleValue:e.roleValue,extUin:e.receptionUin,kfuin:e.kfuin,visitorid:S.receptionist.visitorId,invitationType:3},u.statusBar.data("virtualWPAData",n),rt.render("update",qa()+parseInt(e.number),{name:e.receptionName,status:$.i18n("common_chatting_text")}),y.send({act:"SHOW"}));break;case"DISCONNECT":void 0!==o.ioLink&&o.ioLink.disconnect();break;case"SM_MANUAL_INVITE":5==e.data.type&&($.extend(S.getSigTData,{roleData:e.receptionUin||e.data.receptionUin,roleValue:0}),S.wpaDetail.extUin=e.receptionUin||e.data.receptionUin,S.wpaDetail.invitationType=e.data.type,S.registerType=0,Bn().reConnect());break;case"SM_READY":case"SM_INIT":case"SM_UNREAD":break;default:BJ_REPORT.report("Unknown Message["+JSON.stringify(e)+"]")}}function ba(){$("body").delegate('a[href^="javascript:"]',"click",function(e){e.preventDefault()}),$(window).bind("beforeunload",function(){})}function Ta(e,t){this.el=e,this.options=t,Yn=Yn||pa(),this.$el=Vn(this.el),this.doc=Vn(this.options.documentContext||Qn),this.win=Vn(this.options.windowContext||zn),this.body=this.doc.find("body"),this.$content=this.$el.children("."+this.options.contentClass),this.$content.attr("tabindex",this.options.tabIndex||0),this.content=this.$content[0],this.previousPosition=0,this.options.iOSNativeScrolling&&null!=this.el.style.WebkitOverflowScrolling?this.nativeScrolling():this.generate(),this.createEvents(),this.addEvents(),this.reset()}Vn=jQuery,zn=window,Qn=document,fa={paneClass:"nano-pane",sliderClass:"nano-slider",contentClass:"nano-content",enabledClass:"has-scrollbar",flashedClass:"flashed",activeClass:"active",iOSNativeScrolling:!1,preventPageScrolling:!1,disableResize:!1,alwaysVisible:!1,flashDelay:1500,sliderMinHeight:20,sliderMaxHeight:null,documentContext:null,windowContext:null},ra="scroll",ea="mousedown",ta="mouseenter",ia="mousemove",aa="mousewheel",na="mouseup",sa="resize",la="up",Xn="DOMMouseScroll",Zn="down",ca="touchmove",Yn=null,ma=zn.requestAnimationFrame,da=zn.cancelAnimationFrame,ha=Qn.createElement("div").style,va=function(){for(var e,t=["t","webkitT","MozT","msT","OT"],i=e=0,n=t.length;e<n;i=++e)if(t[i],t[i]+"ransform"in ha)return t[i].substr(0,t[i].length-1);return!1}(),_a=function(e){return!1!==va&&(""===va?e:va+e.charAt(0).toUpperCase()+e.substr(1))}("transform"),ua=!1!==_a,pa=function(){var e,t=Qn.createElement("div"),i=t.style;return i.position="absolute",i.width="100px",i.height="100px",i.overflow=ra,i.top="-9999px",Qn.body.appendChild(t),e=t.offsetWidth-t.clientWidth,Qn.body.removeChild(t),e},ga=function(){var e,t=zn.navigator.userAgent,i=/(?=.+Mac OS X)(?=.+Firefox)/.test(t);return!!i&&(e=(e=/Firefox\/\d{2}\./.exec(t))&&e[0].replace(/\D+/g,""),i&&23<+e)},Ta.prototype.preventScrolling=function(e,t){if(this.isActive)if(e.type===Xn)(t===Zn&&0<e.originalEvent.detail||t===la&&e.originalEvent.detail<0)&&e.preventDefault();else if(e.type===aa){if(!e.originalEvent||!e.originalEvent.wheelDelta)return;(t===Zn&&e.originalEvent.wheelDelta<0||t===la&&0<e.originalEvent.wheelDelta)&&e.preventDefault()}},Ta.prototype.nativeScrolling=function(){this.$content.css({WebkitOverflowScrolling:"touch"}),this.iOSNativeScrolling=!0,this.isActive=!0},Ta.prototype.updateScrollValues=function(){var e,t=this.content;this.maxScrollTop=t.scrollHeight-t.clientHeight,this.prevScrollTop=this.contentScrollTop||0,this.contentScrollTop=t.scrollTop,e=this.contentScrollTop>this.previousPosition?"down":this.contentScrollTop<this.previousPosition?"up":"same",this.previousPosition=this.contentScrollTop,"same"!=e&&this.$el.trigger("update",{position:this.contentScrollTop,maximum:this.maxScrollTop,direction:e}),this.iOSNativeScrolling||(this.maxSliderTop=this.paneHeight-this.sliderHeight,this.sliderTop=0===this.maxScrollTop?0:this.contentScrollTop*this.maxSliderTop/this.maxScrollTop)},Ta.prototype.setOnScrollStyles=function(){var e,t;ua?(e={})[_a]="translate(0, "+this.sliderTop+"px)":e={top:this.sliderTop},ma?(da&&this.scrollRAF&&da(this.scrollRAF),this.scrollRAF=ma((t=this,function(){return t.scrollRAF=null,t.slider.css(e)}))):this.slider.css(e)},Ta.prototype.createEvents=function(){var i,n,t,a,o,s,r,c;this.events={down:function(e){return c.isBeingDragged=!0,c.offsetY=e.pageY-c.slider.offset().top,c.slider.is(e.target)||(c.offsetY=0),c.pane.addClass(c.options.activeClass),c.doc.bind(ia,c.events.drag).bind(na,c.events.up),c.body.bind(ta,c.events.enter),!1},drag:function(e){return r.sliderY=e.pageY-r.$el.offset().top-r.paneTop-(r.offsetY||.5*r.sliderHeight),r.scroll(),r.contentScrollTop>=r.maxScrollTop&&r.prevScrollTop!==r.maxScrollTop?r.$el.trigger("scrollend"):0===r.contentScrollTop&&0!==r.prevScrollTop&&r.$el.trigger("scrolltop"),!1},up:function(e){return s.isBeingDragged=!1,s.pane.removeClass(s.options.activeClass),s.doc.unbind(ia,s.events.drag).unbind(na,s.events.up),s.body.unbind(ta,s.events.enter),!1},resize:function(e){o.reset()},panedown:function(e){return a.sliderY=(e.offsetY||e.originalEvent.layerY)-.5*a.sliderHeight,a.scroll(),a.events.down(e),!1},scroll:function(e){t.updateScrollValues(),t.isBeingDragged||(t.iOSNativeScrolling||(t.sliderY=t.sliderTop,t.setOnScrollStyles()),null!=e&&(t.contentScrollTop>=t.maxScrollTop?(t.options.preventPageScrolling&&t.preventScrolling(e,Zn),t.prevScrollTop!==t.maxScrollTop&&t.$el.trigger("scrollend")):0===t.contentScrollTop&&(t.options.preventPageScrolling&&t.preventScrolling(e,la),0!==t.prevScrollTop&&t.$el.trigger("scrolltop"))))},wheel:function(e){var t;if(null!=e)return(t=e.delta||e.wheelDelta||e.originalEvent&&e.originalEvent.wheelDelta||-e.detail||e.originalEvent&&-e.originalEvent.detail)&&(n.sliderY+=-t/3),n.scroll(),!1},enter:(i=n=t=a=o=s=r=c=this,function(e){var t;if(i.isBeingDragged)return 1!==(e.buttons||e.which)?(t=i.events).up.apply(t,arguments):void 0})}},Ta.prototype.addEvents=function(){var e;this.removeEvents(),e=this.events,this.options.disableResize||this.win.bind(sa,e[sa]),this.iOSNativeScrolling||(this.slider.bind(ea,e[Zn]),this.pane.bind(ea,e.panedown).bind(aa+" "+Xn,e.wheel)),this.$content.bind(ra+" "+aa+" "+Xn+" "+ca,e[ra])},Ta.prototype.removeEvents=function(){var e=this.events;this.win.unbind(sa,e[sa]),this.iOSNativeScrolling||(this.slider.unbind(),this.pane.unbind()),this.$content.unbind(ra+" "+aa+" "+Xn+" "+ca,e[ra])},Ta.prototype.generate=function(){var e,t,i=this.options,n=i.paneClass,a=i.sliderClass;return i.contentClass,(t=this.$el.children("."+n)).length||t.children("."+a).length||this.$el.append('<div class="'+n+'"><div class="'+a+'" /></div>'),this.pane=this.$el.children("."+n),this.slider=this.pane.find("."+a),0===Yn&&ga()?e={right:-14,paddingRight:+zn.getComputedStyle(this.content,null).getPropertyValue("padding-right").replace(/[^0-9.]+/g,"")+14}:Yn&&(e={right:-Yn},this.$el.addClass(i.enabledClass)),null!=e&&this.$content.css(e),this},Ta.prototype.restore=function(){this.stopped=!1,this.iOSNativeScrolling||this.pane.show(),this.addEvents()},Ta.prototype.reset=function(){var e,t,i,n,a,o,s,r,c,l,d;if(!this.iOSNativeScrolling)return this.$el.find("."+this.options.paneClass).length||this.generate().stop(),this.stopped&&this.restore(),a=(n=(e=this.content).style).overflowY,t=e.scrollHeight+Yn,0<(c=parseInt(this.$el.css("max-height"),10))&&(this.$el.height(""),this.$el.height(e.scrollHeight>c?c:e.scrollHeight)),s=(o=this.pane.outerHeight(!1))+(r=parseInt(this.pane.css("top"),10))+parseInt(this.pane.css("bottom"),10),(d=Math.round(s/t*o))<this.options.sliderMinHeight?d=this.options.sliderMinHeight:null!=this.options.sliderMaxHeight&&d>this.options.sliderMaxHeight&&(d=this.options.sliderMaxHeight),a===ra&&n.overflowX!==ra&&(d+=Yn),this.maxSliderTop=s-d,this.contentHeight=t,this.paneHeight=o,this.paneOuterHeight=s,this.sliderHeight=d,this.paneTop=r,this.slider.height(d),this.events.scroll(),this.pane.show(),this.isActive=!0,e.scrollHeight===e.clientHeight||this.pane.outerHeight(!0)>=e.scrollHeight&&a!==ra?(this.pane.hide(),this.isActive=!1):this.el.clientHeight===e.scrollHeight&&a===ra?this.slider.hide():this.slider.show(),this.pane.css({opacity:this.options.alwaysVisible?1:"",visibility:this.options.alwaysVisible?"visible":""}),"static"!==(i=this.$content.css("position"))&&"relative"!==i||(l=parseInt(this.$content.css("right"),10))&&this.$content.css({right:"",marginRight:l}),this;this.contentHeight=this.content.scrollHeight},Ta.prototype.scroll=function(){if(this.isActive)return this.sliderY=Math.max(0,this.sliderY),this.sliderY=Math.min(this.maxSliderTop,this.sliderY),this.$content.scrollTop(this.maxScrollTop*this.sliderY/this.maxSliderTop),this.iOSNativeScrolling||(this.updateScrollValues(),this.setOnScrollStyles()),this},Ta.prototype.scrollBottom=function(e){if(this.isActive)return this.$content.scrollTop(this.contentHeight-this.$content.height()-e).trigger(aa),this.stop().restore(),this},Ta.prototype.scrollTop=function(e){if(this.isActive)return this.$content.scrollTop(+e).trigger(aa),this.stop().restore(),this},Ta.prototype.scrollTo=function(e){if(this.isActive)return this.scrollTop(this.$el.find(e).get(0).offsetTop),this},Ta.prototype.stop=function(){return da&&this.scrollRAF&&(da(this.scrollRAF),this.scrollRAF=null),this.stopped=!0,this.removeEvents(),this.iOSNativeScrolling||this.pane.hide(),this},Ta.prototype.destroy=function(){return this.stopped||this.stop(),!this.iOSNativeScrolling&&this.pane.length&&this.pane.remove(),this.$content.removeAttr("tabindex"),this.$el.hasClass(this.options.enabledClass)&&(this.$el.removeClass(this.options.enabledClass),this.$content.css({right:""})),this},Ta.prototype.flash=function(){var e;if(!this.iOSNativeScrolling&&this.isActive)return this.reset(),this.pane.addClass(this.options.flashedClass),setTimeout(function(){e.pane.removeClass(e.options.flashedClass)},(e=this).options.flashDelay),this},oa=Ta,Vn.fn.nanoScroller=function(i){return this.each(function(){var e,t;if((t=this.nanoscroller)||(e=Vn.extend({},fa,i),this.nanoscroller=t=new oa(this,e)),i&&"object"===(void 0===i?"undefined":v(i))){if(Vn.extend(t.options,i),null!=i.scrollBottom)return t.scrollBottom(i.scrollBottom);if(null!=i.scrollTop)return t.scrollTop(i.scrollTop);if(i.scrollTo)return t.scrollTo(i.scrollTo);if("bottom"===i.scroll)return t.scrollBottom(0);if("top"===i.scroll)return t.scrollTop(0);if(i.scroll&&i.scroll instanceof Vn)return t.scrollTo(i.scroll);if(i.stop)return t.stop();if(i.destroy)return t.destroy();if(i.flash)return t.flash()}return t.reset()})},Vn.fn.nanoScroller.Constructor=oa;var Sa={get:function(e){var t,i=0;return document.selection?(e.focus(),(t=document.selection.createRange()).moveStart("character",-e.value.length-1),i=t.text.length):!e.selectionStart&&"0"!=e.selectionStart||(i=e.selectionStart),i},set:function(e,t){var i;e.setSelectionRange?(e.focus(),e.setSelectionRange(t,t)):e.createTextRange&&((i=e.createTextRange()).collapse(!0),i.moveEnd("character",t),i.moveStart("character",t),i.select())}},wa={render:function(){var e,t=u.faceList.find("ul"),i=140;if(S.win.innerWidth,t.html(""),0==t.children().length){for(var n=0;n<i;n++)e=$('<li title="'+$.i18n(W.locale[n])+'" data-index="['+$.i18n(W.locale[n])+']"></li>'),t.append(e);$(".nano").nanoScroller(),u.faceList.off("click").on("click","li",function(e){var t=$(e.currentTarget).data("index"),i=t.length,n=u.chatPostArea.val(),a=n.length,o=Sa.get(u.chatPostArea[0]);u.faceList.trigger("hide"),n=a?n.substring(0,o)+t+n.substr(o,a):t,u.chatPostArea.val(n),o+=i,Sa.set(u.chatPostArea[0],o)})}}};function Ca(){window.emoji=!1;var e=~S.userAgent.indexOf("mac os");u.faceList.on("show",function(){u.faceList.addClass("slideup"),wa.render()}),u.faceList.on("hide",function(){u.faceList.removeClass("slideup")}),$("body").on("click",function(e){var t=$(e.target);0==t.parents(".chat-face").length&&0==t.parents(".btn-face").length&&u.faceList.trigger("hide")}),S.isInIframe||ba(),e&&u.chatPostArea.prop("placeholder",$.i18n("common_postarea_pc_placeholder")),u.chatPostArea.on("init",function(){u.chatPostArea.val(""),u.chatPostArea.trigger("input")}),u.btnFace.on("click",function(){u.faceList.trigger(u.faceList.hasClass("slideup")?"hide":"show")}),void 0!==S.win.EmojiConvertor&&(S.win.emoji=new EmojiConvertor,S.win.emoji.img_sets.apple.path=Gn.CGI_URL.COMP_SOURCE_URL+"img/emoji/")}var xa=ni();var ka,Ea,Ia,Ra,$a,Oa,Aa;ka=window,Ia=ka.Uint8Array,Ra=ka.HTMLCanvasElement,$a=Ra&&Ra.prototype,Oa=/\s*;\s*base64\s*(?:;|$)/i,Aa="toDataURL",Ia&&(Ea=new Ia([62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51])),!Ra||$a.toBlob&&$a.toBlobHD||($a.toBlob||($a.toBlob=function(e,t){var i,n,a,o,s,r;t=t||"image/png",this.mozGetAsFile?e(this.mozGetAsFile("canvas",t)):this.msToBlob&&/^\s*image\/png\s*(?:$|;)/i.test(t)?e(this.msToBlob()):(i=Array.prototype.slice.call(arguments,1),a=(n=this[Aa].apply(this,i)).indexOf(","),o=n.substring(a+1),s=Oa.test(n.substring(0,a)),Blob.fake?((r=new Blob).encoding=s?"base64":"URI",r.data=o,r.size=o.length):Ia&&(r=s?new Blob([function(e){for(var t,i,n=e.length,a=new Ia(n/4*3|0),o=0,s=0,r=[0,0],c=0,l=0;n--;)i=e.charCodeAt(o++),255!==(t=Ea[i-43])&&void 0!==t&&(r[1]=r[0],r[0]=i,l=l<<6|t,4===++c&&(a[s++]=l>>>16,61!==r[1]&&(a[s++]=l>>>8),61!==r[0]&&(a[s++]=l),c=0));return a}(o)],{type:t}):new Blob([decodeURIComponent(o)],{type:t})),e(r))}),!$a.toBlobHD&&$a.toDataURLHD?$a.toBlobHD=function(){Aa="toDataURLHD";var e=this.toBlob();return Aa="toDataURL",e}:$a.toBlobHD=$a.toBlob);var Ma=S.mobileSysType,La=ii(S.userAgent),Pa=S.userAgent;function Da(e){this.options={},$.extend(this.options,e),this.initialize()}Da.prototype.initialize=function(){var t=this,e=this.options.$trigger,i=this.options.$inputTrigger,n=this.options.triggerEvent||"click",a=this.options.isNeedWifiTip,o=this.options.initializeCallBack;"iOS"==Ma&&"mqq"==La&&/uiwebview/.test(Pa)?(e.addClass("btn-upload--mqq"),i.off("change").on("change",function(e){t.checkImgFilesLen(this.files),i.prop("value","")})):e&&e.off(n).on(n,function(){t[a?"wifiTip":"bindUploadEvent"](),"function"==typeof o&&o()})},Da.prototype.wifiTip=function(){var t,i,n,a,o;(function(){if("iOS"===xa)return 1;var e=window.navigator.connection||window.navigator.webkitConnection||null,t=window.navigator.userAgent.toLocaleLowerCase();return!!(e&&e.type&&"wifi"==e.type||-1!==t.indexOf("wifi"))})()||window.sessionStorage.getItem("wifiTip")?this.bindUploadEvent():(t=$.i18n("sysmsg_upload_image_wifi_warning_msg"),i=function(){window.sessionStorage.setItem("wifiTip","1"),this.bindUploadEvent()},n=this,at(function(e){e.append('<div class="confirm"><p class="text">'+t+'</p><p class="btn-wrap"><a href="javascript:;">'+$.i18n("common_confirm_text")+'</a><a href="javascript:;">'+$.i18n("common_cancel_text")+"</a></p></div>"),e.find(".btn-wrap a").eq(0).on("tap",function(){e.remove(),i&&i.call(n)}),e.find(".btn-wrap a").eq(1).on("tap",function(){e.remove(),a&&a.call(o)})}))},Da.prototype.bindUploadEvent=function(){var t=this,i=this.options.$inputTrigger;i.trigger("click"),i.off("change").on("change",function(e){t.checkImgFilesLen(this.files),i.prop("value","")})},Da.prototype.checkImgFilesLen=function(e){e.length>T.IMG_UPLOAD_OPTS.MAX_SUM?Y({text:$.i18n("sysmsg_upload_image_max_msg",T.IMG_UPLOAD_OPTS.MAX_SUM)},1e3):this.checkImgTypeLocal(e)},Da.prototype.checkImgTypeLocal=function(e){for(var t={},i=0,n=e.length;i<n;i++){var a=e[i],o=window.URL.createObjectURL(a),t=$.extend(!0,{},{seq:C(T.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PHP),type:a.type,size:a.size,blobUrl:o,content:a});-1!=$.inArray(a.type,T.IMG_UPLOAD_OPTS.ACCEPT_TYPE)?(this.options.events.preview(t),this.compressImgFiles(t)):this.options.events.preview(t,"notSupport")}},Da.prototype.compressImgFiles=function(e){switch(e.type){case"image/jpeg":case"image/jpg":this.compressQuality(e);break;case"image/png":this["pc"===this.options.platform?"compressQuality":"compressSize"](e);break;default:this.options.events.replacePlaceholder(e)}},Da.prototype.compressQuality=function(r){var c=this,e=new FileReader;e.onload=function(e){var t,i,n,a,o,s=function(e){for(var t=new DataView(e),i=2,n=t.byteLength;i<n;){if(225==t.getUint8(i+1)){var a,o=i+10;if(18761==t.getUint16(o))a=!1;else{if(19789!=t.getUint16(o))return!1;a=!0}if(42!=t.getUint16(o+2,!a))return!1;var s=t.getUint32(o+4,!a);if(s<8)return!1;for(var r,c=o+s,l=t.getUint16(c,!a),d=0;d<l;d++)if(r=c+12*d+2,274==t.getUint16(r,!a))return parseInt(t.getUint16(r+8,!a),10);return!1}i+=2+t.getUint16(i+2)}return null}(e.target.result);t=s,n=new Image,a=document.createElement("canvas"),o=a.getContext("2d"),n.src=r.blobUrl,n.onload=function(){if(i={width:n.naturalWidth,height:n.naturalHeight},a.width=i.width,a.height=i.height,t&&1!=t)switch(t){case 2:o.translate(i.width,0),o.scale(-1,1);break;case 3:o.rotate(Math.PI),o.translate(-i.width,-i.height);break;case 4:o.translate(0,i.height),o.scale(1,-1);break;case 5:a.width=i.height,a.height=i.width,o.rotate(Math.PI/2),o.scale(1,-1);break;case 6:a.width=i.height,a.height=i.width,o.rotate(90*Math.PI/180),o.translate(0,-i.height);break;case 7:a.width=i.height,a.height=i.width,o.rotate(Math.PI/2),o.translate(i.width,-i.height),o.scale(-1,1);break;case 8:a.width=i.height,a.height=i.width,o.rotate(3*Math.PI/2),o.translate(-i.width,0)}o.drawImage(n,0,0);a.toBlob(function(e){r.content=e,r.size=e.size,c.options.events.replacePlaceholder(r)},r.type,T.IMG_UPLOAD_OPTS.JPG_COMPRESS_RATIO/100)}},e.readAsArrayBuffer(r.content)},Da.prototype.compressSize=function(t){var e,i,n,a=this,o=new Image,s=document.createElement("canvas"),r=s.getContext("2d");o.src=t.blobUrl,o.onload=function(){(e={width:o.naturalWidth,height:o.naturalHeight}).width>T.IMG_UPLOAD_OPTS.MAX_WIDTH||e.height>T.IMG_UPLOAD_OPTS.MAX_HEIGHT?(i=Math.floor(e.width*(T.IMG_UPLOAD_OPTS.MAX_HEIGHT/e.height)),n=Math.floor(e.height*(T.IMG_UPLOAD_OPTS.MAX_WIDTH/e.width)),i>T.IMG_UPLOAD_OPTS.MAX_WIDTH?i=T.IMG_UPLOAD_OPTS.MAX_WIDTH:n>T.IMG_UPLOAD_OPTS.MAX_HEIGHT&&(n=T.IMG_UPLOAD_OPTS.MAX_HEIGHT),s.width=i,s.height=n,r.drawImage(o,0,0,e.width,e.height,0,0,i,n),s.toBlob(function(e){t.content=e,t.size=e.size,a.options.events.replacePlaceholder(t)},t.type)):a.options.events.replacePlaceholder(t)}};var Na,Ba,Ua,Ga,Ha,Fa,ja,Wa,Ja,Ka,Va,za,Qa,Ya,Xa,Za,eo,to=function(e){var t,i={},n=!0;for(t in i.len=function(e){var t=e.length;0==t?n=!1:t>=T.MAX_POST_LIMIT.LENGTH&&(Y({text:$.i18n(T.MAX_POST_LIMIT.TIP_TEXT)},1e3),n=!1)},i)i[t](e);return n},no=function(){var e,t=0,i=0;try{(e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))&&(t=1,i=e.GetVariable("$version").match(/\d+/g))}catch(e){BJ_REPORT&&BJ_REPORT.report("getIEFlashVersion fail")}return{hasFlash:t,flashVersion:parseFloat(i[0]+"."+i[1],10)}};function ao(){var n,a;n=Ka.$el,a=void 0,n.on("input propertychange",function(){var e,t,i=(e=Na.trim(n.val()),t=new RegExp("["+Ba+Ua+Ga+"]","g"),0===e.length?e:(e.match(t)||[]).join(""));i!==a&&(so(),a=i,Za=setTimeout(function(){!function(e){var t=e.length,i=!0;i=(i=0!==!t)&&Ha<=t,(null!==e.match(Wa)&&e.match(Wa).length>=Fa&&e.length>Fa||null!==e.match(Ja)&&e.match(Ja).length>ja&&e.length>ja)&&(i=!1);return i}(a)?oo(Va):function(e){if(0===e.length)return;if(!S.receptionist.kfUin)return;var t={keywords:e,wpaId:S.wpaDetail&&S.wpaDetail.wpaId,visitorId:S.receptionist&&S.receptionist.visitorId};Ya=e,Qa=Na.ajax({url:Ka.cgi+"?kfuin="+S.receptionist.kfUin,data:t,type:"POST",timeout:3e3,dataType:"json",error:function(){},success:function(e){var t=e&&e.code;e.list=e.list||[],0===t&&oo(e)}})}(a)},Ka.delay))}),Ka.$container.delegate("li","click",function(e){var t=ro(Na(e.currentTarget));oo(Va),Ka.events.click&&Ka.events.click(e,t)}),"PC"===Ka.platform&&(Ka.$container.delegate("li","mouseover",function(e){var t=Na(e.currentTarget),i=t.index(),n=ro(t);Ka.events.mouseover&&Ka.events.mouseover(e,n),Ka.$container.find("li").eq(za).removeClass("hover"),t.addClass("hover"),za=i}),Ka.$container.delegate("li","mouseout",function(e){Na(e.currentTarget).removeClass("hover"),Ka.events.enter&&Ka.events.enter(e)}),Ka.$el.on("keydown",function(e){var t=e.keyCode;38!==t&&40!==t&&13!==t||(e.preventDefault(),function(e,t){var i=Ka.$container.find("li");if(0===i.length)return;switch(t){case 38:za=(za<0?Xa:za)-1;break;case 40:za=(za===Xa?-1:za)+1;break;case 13:return so(),Ka.events.enter&&Ka.events.enter(e)}{var n,a;i.removeClass("hover"),0<=za&&za<=i.length-1?(n=i.eq(za),a=ro(n),n.addClass("hover"),Ka.events.mouseover&&Ka.events.mouseover(e,a),Ka.$inputArea.val(n.text())):(Ka.$inputArea.val(Ya),Ka.events.mouseover&&Ka.events.mouseover(e,null))}}(e,t))})),"H5"===Ka.platform&&Ka.$submitTrigger.on("tap",function(){so()}),eo="H5"===Ka.platform?Ka.$container.parent():null}function oo(e){var t,i,n;Ka.$container.html(Na.tmpl(Ka.tpl,e)),za=Xa=e.list.length,e.queryid,"H5"===Ka.platform&&(t=e.list,i=Ka.$container.height(),n=eo.height(),Ka.$container[n<i&&0<t.length?"addClass":"removeClass"]("scrollable"))}function so(){Qa&&Qa.abort(),Za&&clearTimeout(Za),oo(Va)}function ro(e){return{queryid:Ka.$container.find("ul").data("queryid"),reply_docid:e.data("docid"),order:e.data("order"),msg:e.text()}}function co(){var a,e,t,i=0,n=~S.userAgent.indexOf("mac os"),o={};u.chatBtnSend.on("click",function(e){lo(o),o={}}),u.chatPostArea.on("keydown",function(e){1!=e.ctrlKey&&1!=e.metaKey||(i=1),13!=e.which||1!=i||n||u.chatPostArea.val(u.chatPostArea.val()+"\r\n").scrollTop(u.chatPostArea.prop("scrollHeight")-u.chatPostArea.outerHeight()),13==e.which&&1==i&&n&&u.chatPostArea.val(u.chatPostArea.val()+"\r\n").scrollTop(u.chatPostArea.prop("scrollHeight")-u.chatPostArea.outerHeight()),13==e.which&&0==i&&(e.preventDefault(),lo(o),o={})}).on("keyup",function(e){0!=e.ctrlKey&&0!=e.metaKey||(i=0)});var s,r=!1;S.isInIframe||31!=J(window.location.href,"auth")||(r=!0),u.chatPostArea.msgAutoComplete({$container:$(".msg-autocomplete"),$inputArea:u.chatPostArea,tpl:Gn.MSG_AUTO_COMPLETE_TPL,cgi:Gn.CGI_URL.GET_RELATED_MESSAGE,ignore:r,events:{mouseover:function(e,t){o=null!==t?$.extend(o,{data:t.msg,robot:{queryid:t.queryid,reply_docid:t.reply_docid,order:t.order}}):{}},click:function(e,t){lo({data:t.msg,robot:{queryid:t.queryid,reply_docid:t.reply_docid,order:t.order}}),o={}},enter:function(){o={}}}}),window.FormData?a=new Da({$trigger:u.btnUpload,$inputTrigger:u.uploadInput,isNeedWifiTip:!1,platform:"pc",initializeCallBack:function(){u.chatPostArea.trigger("slideDown")},events:{preview:function(e,t){In.image.render(e,t)},replacePlaceholder:function(e){In.image.replacePlaceholder(e)}}}):(1!=(e=no()).hasFlash?t=Gn.FLASH_TIP.NO_FLASH:e.flashVersion<=11.4&&(t=Gn.FLASH_TIP.LOW_VERSION),t?u.btnUpload.on("click",function(){Y({text:t},1e3)}):window.WebUploader&&(s=WebUploader.create({auto:!0,swf:Gn.CGI_URL.COMP_SOURCE_URL+"swf/Uploader.swf",server:Gn.CGI_URL.UPLOAD_IMG+"?kfuin="+S.receptionist.kfUin,formData:{visitId:S.receptionist.visitorId,receptionUin:S.receptionist.extUin},fileVal:"media",pick:"#btn-swfupload",fileNumLimit:Gn.IMG_UPLOAD_OPTS.MAX_SUM,fileSingleSizeLimit:Gn.IMG_UPLOAD_OPTS.MAX_SIZE,accept:{title:"图片文件",extensions:Gn.IMG_UPLOAD_OPTS.ACCEPT_TYPE_SWFUPLOAD,mimeTypes:"image/*"},thumb:{width:200,height:200,quality:90,allowMagnify:!1,crop:!1,type:""},compress:!1}),$(".upload-placeholder").hover(function(){u.btnUpload.addClass("hover")},function(){u.btnUpload.removeClass("hover")}),s.on("fileQueued",function(e){var i={seq:C(Gn.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PHP),date:+new Date};In.normal.render("c2bImage",{seq:i.seq,date:i.date},"msg"),$.extend(e,i),s.makeThumb(e,function(e,t){i.DataURL=t,$.extend(i,{DataURL:t}),In.image.replacePlaceholder(i)},200,200)}),s.on("uploadSuccess",function(e,t){var i={seq:e.seq,date:e.data};In.renderUploadImgRet(i,t)}),s.on("uploadError",function(e,t){In.image.sendFail(e,"notSupport")}),s.on("error",function(e){"Q_EXCEED_NUM_LIMIT"==e&&In.image.sendFail(file,"overSumLimit")}))),c(u.chatPostArea[0],"paste",function(e){var t,i;if(!S.thirdAppConfig||"31"!==S.thirdAppConfig.authType)try{i=(t=(e.clipboardData||e.originalEvent.clipboardData).items).length;for(var n=0;n<i;n++)"file"==t[n].kind&&t[n].type.match("^image/")&&a.checkImgTypeLocal([t[n].getAsFile()])}catch(e){}})}function lo(e){var t,i=$.trim(u.chatPostArea.val());u.chatBtnSend.hasClass("enabled")&&to(i)&&S.receptionist.kfUin&&S.receptionist.visitorId&&(t={data:i,seq:C(Gn.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PHP),type:1,wordMsgSeq:C(Gn.SOCKET_OPTS.SEQ_RANGE.C2B_FOR_PC),date:+new Date+S.serverClientTimeDiff},$.isEmptyObject(e)||$.extend(t,e),In.normal.render("c2b",t),u.chatPostArea.trigger("init"))}Na=$,Ba="一-龥",Ua="A-Za-z",Ga="0-9",Ha=2,Fa=10,ja=20,Wa=new RegExp("["+Ba+"]","g"),Ja=new RegExp("["+Ua+Ga+"]","g"),Ka={platform:"PC",delay:200},Va={queryid:null,list:[]},eo=Za=Xa=Ya=Qa=void(za=0),Na.fn.msgAutoComplete=function(e){e.ignore||(e&&Na.extend(Ka,e),Ka.$el=this,ao())},Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var i,n;if(null==this)throw new TypeError(" this is null or not defined");var a,o=Object(this),s=o.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(1<arguments.length&&(i=t),n=0;n<s;){n in o&&(a=o[n],e.call(i,a,n,o)),n++}});var fo,po,uo=function(){var r=S.receptionist;S.ioLinkStatus,S.chatSocket;return{start:function(){var e="kf"+r.kfUin,t=JSON.parse(L.get(e)),i=S.seqs.data.length;t&&t.forEach(function(e){e.visitorId==r.visitorId&&e.total>i&&function(e){var t,i,n,a=r.kfUin,o=r.visitorId;S.seqs.data=JSON.parse(L.get(S.seqs.key)),n=S.seqs.data.slice(0-e);for(var s=0;s<n.length;s++)t="kf"+a+"vId"+o+"index"+n[s],i=JSON.parse(L.get(t)),In.getMsgCacheList.renderSingle(i,"down"),h()}(e.total-i)})}}}(),go=Rt();go.isPageVisibilitySupport&&go.visibilitychange(function(e,t,i){var n,a,o,s,r,c,l=S.receptionist,d=S.ioLinkStatus,f=S.chatSocket;0==t&&"visible"==i?(S.isInIframe&&(a="kf"+l.kfUin+"vId"+l.visitorId+"red",(o=JSON.parse(L.get(a)))&&o.forEach(function(e){for(s in e)c=e[s],r=s.replace("wId",""),0<c.number&&(S.isMobile?y.send({visitorid:l.visitorId,kfuin:l.kfUin,wpaId:r,act:"UNREAD",data:{number:c.number}}):rt.render("update",c.number))})),n="show",S.isRegOK&&uo.start(n),f.ioLink&&f.ioLink.disconnected&&d&&"sessionOver"!=d&&-1==d.indexOf("over")&&(S.ioLinkStatus="over")):n="hide",S.pageStatus=n}),fo=$,(po=function(e,t,i,n){var a=3<arguments.length&&void 0!==n?n:{},o=/[^\w\-\.:]/.test(e)?new Function(po.arg+",tmpl","var _e=tmpl.encode"+po.helper+",_s='"+e.replace(po.regexp,po.func)+"';return _s;"):po.cache[e]=po.cache[e]||e,s=t?i?i(o(t,po)):o(t,po):function(e){return i?i(o(e,po)):o(e,po)};if(S.styleRenderConfig&&!a.ignoreStyleRender){for(var r=[],c=0;c<fo(s).length;c++){var l=fo(s).get(c);1===l.nodeType?(l=f(l,S.styleRenderConfig),r.push(function(e){var t=document.createElement("div");t.appendChild(e.cloneNode(!0));var i=t.innerHTML;return t=e=null,i}(l))):3===l.nodeType&&r.push(l.nodeValue)}s=r.join("")}return s}).cache={},po.load=function(e){return document.getElementById(e).innerHTML},po.regexp=/([\s'\\])(?!(?:[^<]|\<(?!%))*%\>)|(?:\<%(=|#)([\s\S]+?)%\>)|(\<%)|(%\>)/g,po.func=function(e,t,i,n,a,o){return t?{"\n":"\\n","\r":"\\r","\t":"\\t"," ":" "}[t]||"\\"+t:i?"="===i?"'+_e("+n+")+'":"'+("+n+"==null?'':"+n+")+'":a?"';":o?"_s+='":void 0},po.encReg=/[<>&"'\x00]/g,po.encMap={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#39;"},po.encode=function(e){return(null==e?"":""+e).replace(po.encReg,function(e){return po.encMap[e]||""})},po.joinTpl=function(e,t,i){return e.replace(t,i)},po.arg="o",po.helper=",print=function(s,e){_s+=e?(s==null?'':s):_e(s);},include=function(s,d){_s+=tmpl(s,d);}",fo.tmpl=po;var mo,_o;(_o=window.performance||window.webkitPerformance||window.msPerformance)&&$(window).load(function(){mo=_o.timing,S.pageLoadStartTime=mo.navigationStart,setTimeout(function(){Oe({type:1,subType:S.isInIframe?1:2,requestConsumTime:mo.loadEventEnd-mo.navigationStart,addon:JSON.stringify({domLoad:mo.domContentLoadedEventEnd-mo.navigationStart})})},20)});(new function(){this.version="2.0.0",_(u.chatListWrap),this.start=function(){var e;$.extend(S.htReportOpts,{platform:"pc",app:"other",flag3:1}),Ca(),co(),S.isInIframe?(y.receive(S.win,ya),e={},u.page.removeClass("page-popup").addClass("page-minify"),$(".btn-back").on("click",function(e){y.send({act:"CLOSE",kfuin:S.receptionist.kfUin}),S.imStatus="close",u.page.removeClass("page-inframe").addClass("page-minify"),u.statusBar.find(".name").text(S.receptionist.name).end().find(".status").text($.i18n("common_chatting_text"))}),$(document).delegate("div.title-minify","click",function(){e=$(this).data("virtualWPAData"),u.page.hasClass("page-minify")&&(y.send({act:"OPEN",isPost2Parent:!1}),e&&($.extend(e,{act:"OPEN",isPost2Parent:!0}),window.postMessage(e,"*")),u.page.removeClass("page-minify").addClass("page-inframe"))})):X.init(function(){Ni(function(){var e;e=ya,gt(T.CGI_URL.STATUS_MANAGER,function(){void 0!==e&&y.receive(S.win,e)}),S.isGetSkin||Jn().getData({kfuin:S.receptionist.kfUin,wpaId:S.wpaDetail.wpaId,key:S.wpaDetail.wpaKey})})}),u.chatBtnSend.hasClass("enabled")||u.chatBtnSend.addClass("enabled")}}).start()}();